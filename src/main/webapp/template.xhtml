<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  template="WEB-INF/facelets/layout.xhtml">

<ui:define name="head">

  <script type="text/javascript">

    var templateId = '#{templateBean.current.id}';

    //<!--
    
    var autosaveTimer = '';
    
    $(function(){
        initJSONRpc();
        startAutosave();
    });
    
    function startAutosave() {
        if (templateId != 'null') {
            if (autosaveTimer == '') {
                autosaveTimer = setInterval(saveContent, AUTOSAVE_TIMEOUT * 1000);
            }
        }
    }
    
    function stopAutosave() {
        if (autosaveTimer != '') {
            clearInterval(autosaveTimer);
            autosaveTimer = '';
        }
    }

    function saveContent() {
        var content = $("textarea").val();
        jsonrpc.templateService.updateContent(function(r) {
            if (r.result == 'success') {
                var now = new Date();
                infoMessage(r.message + " " + now);
            }
            else {
                errorMessage(r.message);
            }            
        },templateId, content);        
    }

    function onAutosave() {
        if ($("#autosave:checked").length > 0) {
            startAutosave(); 
        }
        else {
            stopAutosave();
        }
    }
    
    // -->    
  </script>

</ui:define>

<ui:define name="title">Template</ui:define>

<ui:define name="body">

<h:form>

<h1>Template</h1>

<div class="form-row">
    <label>Title</label>
    <h:inputText value="#{templateBean.current.title}" />
</div>
<div class="form-row">
    <label>URL name</label>
    <h:inputText value="#{templateBean.current.url}" />
</div>
<div class="form-row">
    <div>
        <input id="autosave" type="checkbox" checked="checked" onchange="onAutosave()"> Autosave</input>
    </div>
    <h:inputTextarea rows="20" cols="80" value="#{templateBean.current.content}" />
</div>

<div class="buttons">
    <h:commandButton value="Save" action="#{templateBean.update}" />
    <h:commandButton value="Cancel" action="#{templateBean.cancelEdit}" />
</div>

</h:form>

</ui:define>

</ui:composition>
