<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  template="WEB-INF/facelets/layout.xhtml">

<ui:define name="head">

  <script type="text/javascript" src="/static/ckeditor/ckeditor.js"></script>
  <script type="text/javascript">

    $(function(){
    	CKEDITOR.replace('form:content', {
        	height: 480,
    		filebrowserUploadUrl : '/cms/upload'
        });
        $("#tabs").tabs();
        $(".datepicker").datepicker({dateFormat:'dd.mm.yy'});
    });

    function onTitleChange() {
        if ($(".form-url").length == 1) {
            var url = $(".form-url").val();
            var title = $(".form-title").val();
            if (url == "") {
                $(".form-url").val(urlFromTitle(title));
            }
        }
    }
        
  </script>
    
</ui:define>

<ui:define name="title">Page</ui:define>

<ui:define name="body">

<h:form id="form">

<div id="tabs">
<ul>
    <li><a href="#tab-1">Page</a></li>
    <h:panelGroup rendered="#{pageBean.edit}">
    <li><a href="#tab-2">Content</a></li>
    </h:panelGroup>
    <h:panelGroup rendered="#{pageBean.showChildren}">
    <li><a href="#tab-3">Children pages</a></li>
    </h:panelGroup>    
</ul>

<div id="tab-1">

<div class="form-row">
    <label>Title</label>
    <h:inputText styleClass="form-title" value="#{pageBean.current.title}" size="40" 
        onchange="onTitleChange()"/>
</div>
<div class="form-row">
    <label>Friendly URL &#160;</label>
    <h:panelGroup rendered="#{pageBean.editURL}">    
        <h:outputText value="#{pageBean.current.parentFriendlyURL}/" />
        <h:inputText styleClass="form-url" value="#{pageBean.current.pageFriendlyURL}" size="40"/>
    </h:panelGroup>
    <h:panelGroup rendered="#{!pageBean.editURL}">    
        <h:outputText value="#{pageBean.current.friendlyURL}" />
    </h:panelGroup>
</div>
<div class="form-row">
    <label>Template</label>
    <h:selectOneMenu value="#{pageBean.current.template}">
        <f:selectItems value="#{pageBean.templates}" />
    </h:selectOneMenu>
</div>
<div class="form-row">
    <label>Publication date</label>
    <h:inputText value="#{pageBean.publishDate}" styleClass="datepicker" size="8"/>
</div>

<div class="buttons">
    <h:commandButton value="Save" action="#{pageBean.update}" />
    <h:commandButton value="Preview" action="#{pageBean.preview}" 
        rendered="#{pageBean.edit}"/>
    <h:commandButton value="Cancel" action="#{pageBean.cancelEdit}" />
</div>    

</div>

<h:panelGroup rendered="#{pageBean.edit}">
<div id="tab-2">

<div class="form-row">
    <h:inputTextarea id="content" rows="20" cols="80" value="#{pageBean.current.content}" />
</div>

<div class="buttons">
    <h:commandButton value="Save" action="#{pageBean.update}" />
    <h:commandButton value="Preview" action="#{pageBean.preview}" 
        rendered="#{pageBean.edit}"/>
    <h:commandButton value="Cancel" action="#{pageBean.cancelEdit}" />
</div>    

</div>
</h:panelGroup>

<h:panelGroup rendered="#{pageBean.showChildren}">
<div id="tab-3">

<h:dataTable value="#{pageBean.children}" var="page" styleClass="form-table">
    <h:column>
        <f:facet name="header"></f:facet>    
        <h:selectBooleanCheckbox value="#{pageBean.selected[page.id]}"/>
    </h:column>
    <h:column>
        <f:facet name="header" >Title</f:facet>    
        <a href="/cms/page/edit/#{page.id}"><h:outputText value="#{page.title}"/></a>
    </h:column>
    <h:column>
        <f:facet name="header" >Friendly URL</f:facet>    
        <h:outputText value="#{page.friendlyURL}"/>
    </h:column>
</h:dataTable>
<div class="buttons">
    <h:commandButton value="Add child page" action="#{pageBean.addChild}" />
    <h:commandButton value="Delete pages" action="#{pageBean.delete}" />
</div>    

</div>
</h:panelGroup>

</div>

</h:form>

</ui:define>

</ui:composition>
