<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  template="WEB-INF/facelets/layout.xhtml">

<ui:define name="head">

    <script src="/static/js/jquery.form.js" language="javascript" />

<script type="text/javascript">

function onUpload() {
    $("#file-upload").dialog("open");
    return false;	
}
function onFileUploadCancel() {
	$("#file-upload").dialog("close");
}
$(function() {
    $("#tabs").tabs();
    $("#file-upload").dialog({ width: 400, autoOpen: false });
});

$(document).ready(function() {
    $('#upload').ajaxForm(afterUpload);
/*    $('#upload').ajaxForm({
        dataType:'json',
        success: afterUpload
    });*/ 
});

function afterUpload(result) {
    alert(result);
    if (result.result == 'success') {
        alert('File was successfully uploaded.');
        window.location.reload();
    }
    else {
        alert('Error occured during file upload. ' + result.message);
    }
}

function onTestJSON() {
	var jsonrpc = new JSONRpcClient("/JSON-RPC/")
	var result = jsonrpc.testService.test("Hello from client!");
    alert(result);
	$("#result").text(result);
	return false;
}

</script>

</ui:define>

<ui:define name="title">Folder</ui:define>

<ui:define name="body">

<h:form>

<div id="tabs">
<ul>
    <li><a href="#tab-1">Folder</a></li>
<h:panelGroup rendered="#{folderBean.showFiles}">
    <li><a href="#tab-2">Files</a></li>
</h:panelGroup>
<h:panelGroup rendered="#{folderBean.showChildren}">
    <li><a href="#tab-3">Subfolders</a></li>
</h:panelGroup>
</ul>

<div id="tab-1">

<div class="form-row">
    <label>Title</label>
    <h:inputText value="#{folderBean.current.title}" />
</div>
<div class="form-row">
    <label>Name for URL</label>
    <h:inputText value="#{folderBean.current.name}" />
</div>
<div class="buttons">
    <h:commandButton value="Save" action="#{folderBean.update}" />
    <h:commandButton value="Cancel" action="#{folderBean.cancelEdit}" />
</div>    

</div>

<h:panelGroup rendered="#{folderBean.showFiles}">
<div id="tab-2">

<h:dataTable value="#{folderBean.current.files}" var="r"
    styleClass="form-table">
    <h:column>
        <f:facet name="header"></f:facet>    
        <h:selectBooleanCheckbox value="#{folderBean.fileSelected[r.id]}"/>
    </h:column>
    <h:column>
        <f:facet name="header" >Title</f:facet>    
        <h:outputText value="#{r.title}"/>
    </h:column>
    <h:column>
        <f:facet name="header" >Name</f:facet>    
        <h:outputText value="#{r.file.filename}"/>
    </h:column>
</h:dataTable>
<div class="buttons">
    <input type="button" onclick="onUpload()" value="Upload file" />
    <h:commandButton value="Delete files" action="#{folderBean.deleteFiles}" />
</div>

</div>
</h:panelGroup>

<h:panelGroup rendered="#{folderBean.showChildren}">
<div id="tab-3">

<h:dataTable value="#{folderBean.children}" var="r"
    styleClass="form-table">
    <h:column>
        <f:facet name="header"></f:facet>    
        <h:selectBooleanCheckbox value="#{folderBean.selected[r.id]}"/>
    </h:column>
    <h:column>
        <f:facet name="header" >Title</f:facet>    
        <a href="/cms/folder/edit/#{r.id}"><h:outputText value="#{r.title}"/></a>
    </h:column>
    <h:column>
        <f:facet name="header" >Name</f:facet>    
        <h:outputText value="#{r.name}"/>
    </h:column>
</h:dataTable>
<div class="buttons">
    <h:commandButton value="Add child folder" action="#{folderBean.addChild}" />
    <h:commandButton value="Delete folders" action="#{folderBean.delete}" />
</div>    

</div>
</h:panelGroup>

</div>

</h:form>

<div id="file-upload" title="Upload file to folder" style="display:none">
<form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">
    File upload:
    <input type="hidden" name="fileType" value="resource" />
    <input type="hidden" name="folderId" value="#{folderBean.current.id}" />
    <input type="file" name="uploadFile" />
    <div class="buttons">
        <input type="submit" value="Send" />
        <input type="button" onclick="onFileUploadCancel()" value="Cancel" />
    </div>
    <div>
        Result: <span id="result"></span>
        <a href="#" onclick="onTestJSON()">Test JSON-RPC</a>    
    </div>    
</form>
</div>


</ui:define>

</ui:composition>
