/*!
 * jQuery Form Plugin
 * version: 2.94 (13-DEC-2011)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Dual licensed under the MIT and GPL licenses:
 *	http://www.opensource.org/licenses/mit-license.php
 *	http://www.gnu.org/licenses/gpl.html
 */
function toJSON(a){function e(){var a;while(c)a=c[b].prev,delete c[b],c=a}function h(a,i,j){var k=[],l,m,n,o,p;if(a===null||a===undefined)return"null";if(typeof a=="string")return escapeJSONString(a);if(typeof a=="number")return a.toString();if(typeof a=="boolean")return a.toString();if(a[b]){l=[j],n=i;while(n)m&&m.unshift(n[b].ref),n===a&&(o=n,m=[o[b].ref]),l.unshift(n[b].ref),n=n[b].parent;if(o){if(JSONRpcClient.fixupCircRefs)return l.shift(),m.shift(),d.push([l,m]),f;throw e(),new Error("circular reference detected!")}if(JSONRpcClient.fixupDuplicates){m=[a[b].ref],n=a[b].parent;while(n)m.unshift(n[b].ref),n=n[b].parent;return l.shift(),m.shift(),d.push([l,m]),f}}else a[b]={parent:i,prev:c,ref:j},c=a;if(a.constructor===Date)return a.javaClass?'{javaClass: "'+a.javaClass+'", time: '+a.valueOf()+"}":'{javaClass: "java.util.Date", time: '+a.valueOf()+"}";if(a.constructor===Array){for(p=0;p<a.length;p++)g=h(a[p],a,p),k.push(g===f?null:g);return"["+k.join(", ")+"]"}for(var q in a)q!==b&&(a[q]===null||a[q]===undefined?k.push('"'+q+'": null'):typeof a[q]!="function"&&(g=h(a[q],a,q),g!==f&&k.push(escapeJSONString(q)+": "+g)));return"{"+k.join(", ")+"}"}var b="$_$jabsorbed$813492",c,d=[],f={},g;return g=h(a,null,"root"),e(),d.length?{json:g,fixups:d}:{json:g}}function JSONRpcClient(){var a=0,b,c,d,e,f,g=typeof arguments[0],h=!0;g==="function"?(this.readyCB=arguments[0],a++):arguments[0]&&g==="object"&&arguments[0].length&&(this._addMethods(arguments[0]),a++,h=!1),this.serverURL=arguments[a],this.user=arguments[a+1],this.pass=arguments[a+2],this.objectID=0,h&&(this._addMethods(["system.listMethods"]),b=JSONRpcClient._makeRequest(this,"system.listMethods",[]),this.readyCB&&(e=this,b.cb=function(a,b){b||e._addMethods(a),e.readyCB(a,b)}),this.readyCB?(JSONRpcClient.async_requests.push(b),JSONRpcClient.kick_async()):(d=JSONRpcClient._sendRequest(this,b),this._addMethods(d)))}function JSONRPCCallableProxy(){this.objectID=arguments[0],this.javaClass=arguments[1],this.JSONRPCType="CallableReference"}(function(a){a.extend(a.fn,{swapClass:function(a,b){var c=this.filter("."+a);return this.filter("."+b).removeClass(b).addClass(a),c.removeClass(a).addClass(b),this},replaceClass:function(a,b){return this.filter("."+a).removeClass(a).addClass(b).end()},hoverClass:function(b){return b=b||"hover",this.hover(function(){a(this).addClass(b)},function(){a(this).removeClass(b)})},heightToggle:function(a,b){a?this.animate({height:"toggle"},a,b):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"](),b&&b.apply(this,arguments)})},heightHide:function(a,b){a?this.animate({height:"hide"},a,b):(this.hide(),b&&this.each(b))},prepareBranches:function(a){return a.prerendered||(this.filter(":last-child:not(ul)").addClass(b.last),this.filter((a.collapsed?"":"."+b.closed)+":not(."+b.open+")").find(">ul").hide()),this.filter(":has(>ul)")},applyClasses:function(c,d){this.filter(":has(>ul):not(:has(>a))").find(">span").unbind("click.treeview").bind("click.treeview",function(b){this==b.target&&d.apply(a(this).next())}).add(a("a",this)).hoverClass();if(!c.prerendered){this.filter(":has(>ul:hidden)").addClass(b.expandable).replaceClass(b.last,b.lastExpandable),this.not(":has(>ul:hidden)").addClass(b.collapsable).replaceClass(b.last,b.lastCollapsable);var e=this.find("div."+b.hitarea);e.length||(e=this.prepend('<div class="'+b.hitarea+'"/>').find("div."+b.hitarea)),e.removeClass().addClass(b.hitarea).each(function(){var b="";a.each(a(this).parent().attr("class").split(" "),function(){b+=this+"-hitarea "}),a(this).addClass(b)})}this.find("div."+b.hitarea).click(d)},treeview:function(c){function e(c,d){function e(d){return function(){return f.apply(a("div."+b.hitarea,c).filter(function(){return d?a(this).parent("."+d).length:!0})),!1}}a("a:eq(0)",d).click(e(b.collapsable)),a("a:eq(1)",d).click(e(b.expandable)),a("a:eq(2)",d).click(e())}function f(){a(this).parent().find(">.hitarea").swapClass(b.collapsableHitarea,b.expandableHitarea).swapClass(b.lastCollapsableHitarea,b.lastExpandableHitarea).end().swapClass(b.collapsable,b.expandable).swapClass(b.lastCollapsable,b.lastExpandable).find(">ul").heightToggle(c.animated,c.toggle),c.unique&&a(this).parent().siblings().find(">.hitarea").replaceClass(b.collapsableHitarea,b.expandableHitarea).replaceClass(b.lastCollapsableHitarea,b.lastExpandableHitarea).end().replaceClass(b.collapsable,b.expandable).replaceClass(b.lastCollapsable,b.lastExpandable).find(">ul").heightHide(c.animated,c.toggle)}function g(){function b(a){return a?1:0}var d=[];i.each(function(b,c){d[b]=a(c).is(":has(>ul:visible)")?1:0}),a.cookie(c.cookieId,d.join(""),c.cookieOptions)}function h(){var b=a.cookie(c.cookieId);if(b){var d=b.split("");i.each(function(b,c){a(c).find(">ul")[parseInt(d[b])?"show":"hide"]()})}}c=a.extend({cookieId:"treeview"},c);if(c.toggle){var d=c.toggle;c.toggle=function(){return d.apply(a(this).parent()[0],arguments)}}this.data("toggler",f),this.addClass("treeview");var i=this.find("li").prepareBranches(c);switch(c.persist){case"cookie":var j=c.toggle;c.toggle=function(){g(),j&&j.apply(this,arguments)},h();break;case"location":var k=this.find("a").filter(function(){return this.href.toLowerCase()==location.href.toLowerCase()});if(k.length){var l=k.addClass("selected").parents("ul, li").add(k.next()).show();c.prerendered&&l.filter("li").swapClass(b.collapsable,b.expandable).swapClass(b.lastCollapsable,b.lastExpandable).find(">.hitarea").swapClass(b.collapsableHitarea,b.expandableHitarea).swapClass(b.lastCollapsableHitarea,b.lastExpandableHitarea)}}return i.applyClasses(c,f),c.control&&(e(this,c.control),a(c.control).show()),this}}),a.treeview={};var b=a.treeview.classes={open:"open",closed:"closed",expandable:"expandable",expandableHitarea:"expandable-hitarea",lastExpandableHitarea:"lastExpandable-hitarea",collapsable:"collapsable",collapsableHitarea:"collapsable-hitarea",lastCollapsableHitarea:"lastCollapsable-hitarea",lastCollapsable:"lastCollapsable",lastExpandable:"lastExpandable",last:"last",hitarea:"hitarea"}})(jQuery),define("jquery.treeview",function(){}),function(a){function b(){if(!a.fn.ajaxSubmit.debug)return;var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}a.fn.ajaxSubmit=function(c){function w(b){var d=new FormData;for(var e=0;e<b.length;e++){if(b[e].type=="file")continue;d.append(b[e].name,b[e].value)}g.find("input:file:enabled").each(function(){var b=a(this).attr("name"),c=this.files;if(b)for(var e=0;e<c.length;e++)d.append(b,c[e])});if(c.extraData)for(var f in c.extraData)d.append(f,c.extraData[f]);c.data=null;var h=a.extend(!0,{},a.ajaxSettings,c,{contentType:!1,processData:!1,cache:!1,type:"POST"});h.context=h.context||h,h.data=null;var i=h.beforeSend;h.beforeSend=function(a,b){b.data=d,a.upload&&(a.upload.onprogress=function(a){b.progress(a.position,a.total)}),i&&i.call(b,a,c)},a.ajax(h)}function x(e){function w(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function z(){function h(){try{var a=w(n).readyState;b("state = "+a),a.toLowerCase()=="uninitialized"&&setTimeout(h,50)}catch(c){b("Server abort: ",c," (",c.name,")"),E(v),s&&clearTimeout(s),s=undefined}}var c=g.attr("target"),e=g.attr("action");f.setAttribute("target",l),d||f.setAttribute("method","POST"),e!=j.url&&f.setAttribute("action",j.url),!j.skipEncodingOverride&&(!d||/post/i.test(d))&&g.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),j.timeout&&(s=setTimeout(function(){r=!0,E(u)},j.timeout));var i=[];try{if(j.extraData)for(var k in j.extraData)i.push(a('<input type="hidden" name="'+k+'">').attr("value",j.extraData[k]).appendTo(f)[0]);j.iframeTarget||(m.appendTo("body"),n.attachEvent?n.attachEvent("onload",E):n.addEventListener("load",E,!1)),setTimeout(h,15),f.submit()}finally{f.setAttribute("action",e),c?f.setAttribute("target",c):g.removeAttr("target"),a(i).remove()}}function E(c){if(o.aborted||D)return;try{B=w(n)}catch(d){b("cannot access response document: ",d),c=v}if(c===u&&o){o.abort("timeout");return}if(c==v&&o){o.abort("server abort");return}if(!B||B.location.href==j.iframeSrc)if(!r)return;n.detachEvent?n.detachEvent("onload",E):n.removeEventListener("load",E,!1);var e="success",f;try{if(r)throw"timeout";var g=j.dataType=="xml"||B.XMLDocument||a.isXMLDoc(B);b("isXml="+g);if(!g&&window.opera&&(B.body==null||B.body.innerHTML=="")&&--C){b("requeing onLoad callback, DOM not available"),setTimeout(E,250);return}var h=B.body?B.body:B.documentElement;o.responseText=h?h.innerHTML:null,o.responseXML=B.XMLDocument?B.XMLDocument:B,g&&(j.dataType="xml"),o.getResponseHeader=function(a){var b={"content-type":j.dataType};return b[a]},h&&(o.status=Number(h.getAttribute("status"))||o.status,o.statusText=h.getAttribute("statusText")||o.statusText);var i=(j.dataType||"").toLowerCase(),l=/(json|script|text)/.test(i);if(l||j.textarea){var p=B.getElementsByTagName("textarea")[0];if(p)o.responseText=p.value,o.status=Number(p.getAttribute("status"))||o.status,o.statusText=p.getAttribute("statusText")||o.statusText;else if(l){var q=B.getElementsByTagName("pre")[0],t=B.getElementsByTagName("body")[0];q?o.responseText=q.textContent?q.textContent:q.innerText:t&&(o.responseText=t.textContent?t.textContent:t.innerText)}}else i=="xml"&&!o.responseXML&&o.responseText!=null&&(o.responseXML=F(o.responseText));try{A=H(o,i,j)}catch(c){e="parsererror",o.error=f=c||e}}catch(c){b("error caught: ",c),e="error",o.error=f=c||e}o.aborted&&(b("upload aborted"),e=null),o.status&&(e=o.status>=200&&o.status<300||o.status===304?"success":"error"),e==="success"?(j.success&&j.success.call(j.context,A,"success",o),k&&a.event.trigger("ajaxSuccess",[o,j])):e&&(f==undefined&&(f=o.statusText),j.error&&j.error.call(j.context,o,e,f),k&&a.event.trigger("ajaxError",[o,j,f])),k&&a.event.trigger("ajaxComplete",[o,j]),k&&!--a.active&&a.event.trigger("ajaxStop"),j.complete&&j.complete.call(j.context,o,e),D=!0,j.timeout&&clearTimeout(s),setTimeout(function(){j.iframeTarget||m.remove(),o.responseXML=null},100)}var f=g[0],h,i,j,k,l,m,n,o,p,q,r,s,t=!!a.fn.prop;if(e)if(t)for(i=0;i<e.length;i++)h=a(f[e[i].name]),h.prop("disabled",!1);else for(i=0;i<e.length;i++)h=a(f[e[i].name]),h.removeAttr("disabled");if(a(":input[name=submit],:input[id=submit]",f).length){alert('Error: Form elements must not have name or id of "submit".');return}j=a.extend(!0,{},a.ajaxSettings,c),j.context=j.context||j,l="jqFormIO"+(new Date).getTime(),j.iframeTarget?(m=a(j.iframeTarget),q=m.attr("name"),q==null?m.attr("name",l):l=q):(m=a('<iframe name="'+l+'" src="'+j.iframeSrc+'" />'),m.css({position:"absolute",top:"-1000px",left:"-1000px"})),n=m[0],o={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(c){var d=c==="timeout"?"timeout":"aborted";b("aborting upload... "+d),this.aborted=1,m.attr("src",j.iframeSrc),o.error=d,j.error&&j.error.call(j.context,o,d,c),k&&a.event.trigger("ajaxError",[o,j,d]),j.complete&&j.complete.call(j.context,o,d)}},k=j.global,k&&!(a.active++)&&a.event.trigger("ajaxStart"),k&&a.event.trigger("ajaxSend",[o,j]);if(j.beforeSend&&j.beforeSend.call(j.context,o,j)===!1){j.global&&a.active--;return}if(o.aborted)return;p=f.clk,p&&(q=p.name,q&&!p.disabled&&(j.extraData=j.extraData||{},j.extraData[q]=p.value,p.type=="image"&&(j.extraData[q+".x"]=f.clk_x,j.extraData[q+".y"]=f.clk_y)));var u=1,v=2,x=a("meta[name=csrf-token]").attr("content"),y=a("meta[name=csrf-param]").attr("content");y&&x&&(j.extraData=j.extraData||{},j.extraData[y]=x),j.forceSync?z():setTimeout(z,10);var A,B,C=50,D,F=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&b.documentElement.nodeName!="parsererror"?b:null},G=a.parseJSON||function(a){return window.eval("("+a+")")},H=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f=c==="xml"||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&g.documentElement.nodeName==="parsererror"&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),typeof g=="string"&&(c==="json"||!c&&e.indexOf("json")>=0?g=G(g):(c==="script"||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g}}if(!this.length)return b("ajaxSubmit: skipping submit process - no element selected"),this;var d,e,f,g=this;typeof c=="function"&&(c={success:c}),d=this.attr("method"),e=this.attr("action"),f=typeof e=="string"?a.trim(e):"",f=f||window.location.href||"",f&&(f=(f.match(/^([^#]+)/)||[])[1]),c=a.extend(!0,{url:f,success:a.ajaxSettings.success,type:d||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},c);var h={};this.trigger("form-pre-serialize",[this,c,h]);if(h.veto)return b("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(c.beforeSerialize&&c.beforeSerialize(this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var i=c.traditional;i===undefined&&(i=a.ajaxSettings.traditional);var j,k,l,m=this.formToArray(c.semantic);c.data&&(c.extraData=c.data,j=a.param(c.data,i));if(c.beforeSubmit&&c.beforeSubmit(m,this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[m,this,c,h]);if(h.veto)return b("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var n=a.param(m,i);j&&(n=n?n+"&"+j:j),c.type.toUpperCase()=="GET"?(c.url+=(c.url.indexOf("?")<0?"?":"&")+n,c.data=null):c.data=n;var o=[];c.resetForm&&o.push(function(){g.resetForm()}),c.clearForm&&o.push(function(){g.clearForm(c.includeHidden)});if(!c.dataType&&c.target){var p=c.success||function(){};o.push(function(b){var d=c.replaceTarget?"replaceWith":"html";a(c.target)[d](b).each(p,arguments)})}else c.success&&o.push(c.success);c.success=function(a,b,d){var e=c.context||c;for(var f=0,h=o.length;f<h;f++)o[f].apply(e,[a,b,d||g,g])};var q=a("input:file:enabled[value]",this),r=q.length>0,s="multipart/form-data",t=g.attr("enctype")==s||g.attr("encoding")==s,u=!!(r&&q.get(0).files&&window.FormData);b("fileAPI :"+u);var v=(r||t)&&!u;return c.iframe!==!1&&(c.iframe||v)?c.closeKeepAlive?a.get(c.closeKeepAlive,function(){x(m)}):x(m):(r||t)&&u?(c.progress=c.progress||a.noop,w(m)):a.ajax(c),this.trigger("form-submit-notify",[this,c]),this},a.fn.ajaxForm=function(c){if(this.length===0){var d={s:this.selector,c:this.context};return!a.isReady&&d.s?(b("DOM not ready, queuing ajaxForm"),a(function(){a(d.s,d.c).ajaxForm(c)}),this):(b("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return this.ajaxFormUnbind().bind("submit.form-plugin",function(b){b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}).bind("click.form-plugin",function(b){var c=b.target,d=a(c);if(!d.is(":submit,input:image")){var e=d.closest(":submit");if(e.length==0)return;c=e[0]}var f=this;f.clk=c;if(c.type=="image")if(b.offsetX!=undefined)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if(typeof a.fn.offset=="function"){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)})},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b){var c=[];if(this.length===0)return c;var d=this[0],e=b?d.getElementsByTagName("*"):d.elements;if(!e)return c;var f,g,h,i,j,k,l;for(f=0,k=e.length;f<k;f++){j=e[f],h=j.name;if(!h)continue;if(b&&d.clk&&j.type=="image"){!j.disabled&&d.clk==j&&(c.push({name:h,value:a(j).val(),type:j.type}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}));continue}i=a.fieldValue(j,!0);if(i&&i.constructor==Array)for(g=0,l=i.length;g<l;g++)c.push({name:h,value:i[g]});else i!==null&&typeof i!="undefined"&&c.push({name:h,value:i,type:j.type})}if(!b&&d.clk){var m=a(d.clk),n=m[0];h=n.name,h&&!n.disabled&&n.type=="image"&&(c.push({name:h,value:m.val()}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}))}return c},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(!d)return;var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)c.push({name:d,value:e[f]});else e!==null&&typeof e!="undefined"&&c.push({name:this.name,value:e})}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=this[d],g=a.fieldValue(f,b);if(g===null||typeof g=="undefined"||g.constructor==Array&&!g.length)continue;g.constructor==Array?a.merge(c,g):c.push(g)}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();c===undefined&&(c=!0);if(c&&(!d||b.disabled||e=="reset"||e=="button"||(e=="checkbox"||e=="radio")&&!b.checked||(e=="submit"||e=="image")&&b.form&&b.form.clk!=b||f=="select"&&b.selectedIndex==-1))return null;if(f=="select"){var g=b.selectedIndex;if(g<0)return null;var h=[],i=b.options,j=e=="select-one",k=j?g+1:i.length;for(var l=j?g:0;l<k;l++){var m=i[l];if(m.selected){var n=m.value;n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value);if(j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(a){var b=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var c=this.type,d=this.tagName.toLowerCase();b.test(c)||d=="textarea"||a&&/hidden/.test(c)?this.value="":c=="checkbox"||c=="radio"?this.checked=!1:d=="select"&&(this.selectedIndex=-1)})},a.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return a===undefined&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return b===undefined&&(b=!0),this.each(function(){var c=this.type;if(c=="checkbox"||c=="radio")this.checked=b;else if(this.tagName.toLowerCase()=="option"){var d=a(this).parent("select");b&&d[0]&&d[0].type=="select-one"&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",function(){}),define("view/page/context",[],function(){return{pageRequest:null,page:null,pages:{},pageId:"",pageParentUrl:"",editMode:!0,currentLanguage:"",isDefault:!1,loadData:function(){alert("Load data was not initialized!")}}}),define("view/page/version",["view/page/context"],function(a){function c(){$("#addVersionLink").click(g),$("#versionCancelButton").click(i),$("#versionForm").submit(function(){return h(),!1})}function d(){Vosao.jsonrpc.pageService.getPageRequest(function(b){a.pageRequest=b,a.page=a.pageRequest.page,e()},a.pageId,a.pageParentUrl)}function e(){var c=a.pageRequest.versions;b=[],a.pages={},$.each(c.list,function(c,d){a.pages[String(d.version)]=d,b.push(String(d.version))}),b.sort();var d="";$.each(b,function(c,e){var f=a.pages[e];d+="<div>",a.pageId!=f.id?d+='<a class="button ui-state-default ui-corner-all"               title="'+f.versionTitle+'"               data-version="'+e+'">Version '+e+"</a>":d+='<a class="button ui-state-default ui-state-active                ui-corner-all" title="'+f.versionTitle+'" data-version="'+e+'"                ><span class="ui-icon ui-icon-triangle-1-e"></span>                Version '+e+"</a>",b.length>1&&(d+='<img class="button" src="/static/images/delete-16.png"         \t\tonclick="onVersionDelete(\''+e+"')\"/></div>")}),$("#versions .vertical-buttons-panel").html(d),$("#versions a").click(function(){var a=$(this).attr("data-version");a&&j(a)})}function f(c){if(confirm(messages("are_you_sure"))){var e=a.pages[c];Vosao.jsonrpc.pageService.deletePageVersion(function(e){if(c==String(page.version))if(b.length==1)location.href="#pages";else{var f=b[0];b.indexOf(c)==0?f=b[1]:f=b[b.indexOf(c)-1],a.pageId=a.pages[f].id,a.loadData()}else d()},e.id)}}function g(){$("#version-dialog").dialog("open"),$("#version-title").val("")}function h(){Vosao.jsonrpc.pageService.addVersion(function(b){b.result=="success"?(a.pageId=b.message,a.loadData(),Vosao.info(messages("page.version_success_add"))):Vosao.showServiceMessages(b),$("#version-dialog").dialog("close")},a.page.friendlyURL,$("#version-title").val())}function i(){$("#version-dialog").dialog("close")}function j(b){var c=a.pages[b];a.pageId=c.id,a.loadData()}function k(){$("#pageState").html(a.page.stateString=="EDIT"?messages("edit"):messages("approved")),$("#pageCreateDate").html(a.page.createDateTimeString),$("#pageModDate").html(a.page.modDateTimeString),$("#pageCreateUser").html(a.page.createUserEmail),$("#pageModUser").html(a.page.modUserEmail)}var b=[];return{initVersionDialog:c,loadVersions:e,showAuditInfo:k}}),define("view/page/breadcrumbs",["view/page/context"],function(a){function b(){var b=a.pageParentUrl;b=a.pageRequest.page.friendlyURL;var d="",e=b.substr(1).split("/");if(e.length>0){var f="";$.each(e,function(b,c){f+="/"+c,e.length-1==b&&a.editMode?d+=" "+e[e.length-1]:d+=' <a data-url="'+f+'">'+c+"</a> /"})}$("#crumbs").html(d),$("#crumbs a").click(function(){var a=$(this).attr("data-url");a&&c(a)}),$("#rootPage").click(function(){c("/")})}function c(a){Vosao.jsonrpc.pageService.getPageByUrl(function(a){location.href="#page/content/"+a.id},a)}return{breadcrumbsShow:b}}),function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,d=typeof location!="undefined"&&location.href,e=d&&location.protocol&&location.protocol.replace(/\:/,""),f=d&&location.hostname,g=d&&(location.port||void 0),h=[];define("text",[],function(){var l,m,s;return typeof window!="undefined"&&window.navigator&&window.document?m=function(a,b){var c=l.createXhr();c.open("GET",a,!0),c.onreadystatechange=function(){c.readyState===4&&b(c.responseText)},c.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(s=require.nodeRequire("fs"),m=function(a,b){b(s.readFileSync(a,"utf8"))}):typeof Packages!="undefined"&&(m=function(a,b){var c=new java.io.File(a),d=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(c),"utf-8")),e,f,g="";try{e=new java.lang.StringBuffer,(f=c.readLine())&&f.length()&&f.charAt(0)===65279&&(f=f.substring(1));for(e.append(f);(f=c.readLine())!==null;)e.append(d),e.append(f);g=String(e.toString())}finally{c.close()}b(g)}),l={version:"1.0.0",strip:function(a){if(a){var a=a.replace(b,""),d=a.match(c);d&&(a=d[1])}else a="";return a},jsEscape:function(a){return a.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var b,c,d;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(c=0;c<3;c++){d=a[c];try{b=new ActiveXObject(d)}catch(e){}if(b){a=[d];break}}if(!b)throw Error("createXhr(): XMLHttpRequest not available");return b},get:m,parseName:function(a){var b=!1,c=a.indexOf("."),d=a.substring(0,c),a=a.substring(c+1,a.length),c=a.indexOf("!");return c!==-1&&(b=a.substring(c+1,a.length),b=b==="strip",a=a.substring(0,c)),{moduleName:d,ext:a,strip:b}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(a,b,c,d){var e=l.xdRegExp.exec(a),f;return e?(a=e[2],e=e[3],e=e.split(":"),f=e[1],e=e[0],(!a||a===b)&&(!e||e===c)&&(!f&&!e||f===d)):!0},finishLoad:function(a,b,c,d,e){c=b?l.strip(c):c,e.isBuild&&e.inlineText&&(h[a]=c),d(c)},load:function(a,b,c,h){var j=l.parseName(a),k=j.moduleName+"."+j.ext,m=b.toUrl(k),n=h&&h.text&&h.text.useXhr||l.useXhr;!d||n(m,e,f,g)?l.get(m,function(b){l.finishLoad(a,j.strip,b,c,h)}):b([k],function(a){l.finishLoad(j.moduleName+"."+j.ext,j.strip,a,c,h)})},write:function(a,b,c){if(b in h){var d=l.jsEscape(h[b]);c.asModule(a+"!"+b,"define(function () { return '"+d+"';});\n")}},writeFile:function(a,b,c,d,e){var b=l.parseName(b),f=b.moduleName+"."+b.ext,g=c.toUrl(b.moduleName+"."+b.ext)+".js";l.load(f,c,function(){var b=function(a){return d(g,a)};b.asModule=function(a,b){return d.asModule(a,g,b)},l.write(a,f,b,e)},e)}}})}(),define("text!template/topbar.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="leftmenu">\n    <a href="#index">Vosao CMS <%= Vosao.fullVersion %></a>        \n    <a href="#pages"><%= messages("content") %></a>\n<% if (Vosao.app.user.admin) { %>\n    <a href="#templates"> <%= messages("templates") %></a>\n<% } %>        \n    <a href="#folders"><%= messages("resources") %></a>\n<% if (Vosao.app.user.admin) { %>\n    <a href="#config"><%= messages("configuration") %></a>\n    <a href="#plugins"><%= messages("plugins") %></a>\n<% } %>        \n</div>\n<div id="rightmenu">\n    <%= Vosao.app.user.email %> \n    | <a href="#profile"><%= messages("profile") %></a> \n    | <a href="#logout"><%= messages("logout") %></a>\n    | <%= locale %>\n    | <a href="http://code.google.com/p/vosao/issues/list">\n        <%= messages("support") %>\n      </a>    \n</div>\n<span class="clear">&#160;</span>\n'}),define("text!template/locale.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<a id="languageSelect"><%= messages("language") %></a>\n<div id="languageDiv">\n    <a onclick="Vosao.changeLanguageCall(\'en\')">English</a>\n    <a onclick="Vosao.changeLanguageCall(\'de\')">Deutsch</a>\n    <a onclick="Vosao.changeLanguageCall(\'es\')">Español</a>\n    <a onclick="Vosao.changeLanguageCall(\'sv\')">Swedish</a>\n    <a onclick="Vosao.changeLanguageCall(\'ru\')">Русский</a>\n    <a onclick="Vosao.changeLanguageCall(\'cs\')">Česky</a>\n    <a onclick="Vosao.changeLanguageCall(\'tr\')">Türkçe</a>\n    <a onclick="Vosao.changeLanguageCall(\'pt_BR\')">Brazilian Portuguese</a>\n    <a onclick="Vosao.changeLanguageCall(\'ja\')">日本語</a>\n    <a onclick="Vosao.changeLanguageCall(\'zh_TW\')">中文(繁體)</a>\n    <a onclick="Vosao.changeLanguageCall(\'zh_CN\')">中文(简体)</a>\n</div>'}),define("text!template/login.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="memo">\r\n    <img src="/static/images/login-logo.jpg" />\r\n    <p><%= messages(\'login.sign_in\') %></p>\r\n    <p><%= messages("login.visit") %></p>\r\n    <p><%= messages("login.bug") %></p>\r\n    <p><%= messages("login.forum") %></p>\r\n</div>\r\n\r\n<div id="login-form">\r\n<form id="login">\r\n\r\n<h4><%= messages("login.sign") %></h4>\r\n<h3><%= messages("login.sign_account") %></h3>\r\n\r\n<div class="form-row">\r\n    <label><%= messages("email") %></label>\r\n    <input type="text" id="loginEmail" value=""/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("password") %></label>\r\n    <input type="password" id="loginPassword" value=""/>\r\n</div>\r\n<div id="login-messages"> </div>\r\n<div class="buttons-dlg">\r\n    <input type="submit" value="<%= messages("login") %>" />\r\n    <br/>\r\n    <br/>\r\n    <a id="forgot"><%= messages("forgot_password") %></a>\r\n</div>    \r\n\r\n</form>\r\n</div>\r\n\r\n<div class="clear"> </div>\r\n\r\n<div class="version">\r\n  <span>Vosao CMS <%= messages("version")%> <%= Vosao.fullVersion %></span>\r\n</div>\r\n\r\n\r\n<div class="messages"> </div>\r\n\r\n<div id="forgot-dialog" style="display:none" title="<%= messages("forgot_password") %>">\r\n  <form id="forgotForm">\r\n    <p style="margin-bottom: 20px;"><%= messages("login.forgot_dialog") %></p>\r\n    <div class="form-row">\r\n        <label style="width: 80px;"><%= messages("email") %></label>\r\n        <input type="text" id="email" />\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input type="submit" value="OK" />\r\n        <input id="forgotCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n'}),define("text!template/login-topbar.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="rightmenu" style="margin-right: 30px">\n    <%= locale %>\n</div>\n<span class="clear">&#160;</span>\n'}),define("view/LoginView",["text!template/login.html","text!template/locale.html","text!template/login-topbar.html"],function(a,b,c){function d(a){a.preventDefault();var b=$("#email").val();return b?($("#loading").show(),Vosao.jsonrpc.loginFrontService.forgotPassword(function(b){$("#loading").hide(),b.result=="success"?Vosao.info(messages("login.password_letter_success")):Vosao.error(a.message),$("#forgot-dialog").dialog("close")},b.toLowerCase()),!1):(Vosao.error(messages("email_is_empty")),!1)}return Backbone.View.extend({el:$("#content"),events:{"click #forgot":"forgot_click","submit form#login":"login_submit"},css:"/static/css/login.css",forgot_click:function(){this.$("#email").val(""),$("#forgot-dialog").dialog("open")},login_submit:function(a){a.preventDefault();if(Vosao.app.loggedIn)return Vosao.app.trigger("login"),!1;var b=this.$("#loginEmail").val(),c=this.$("#loginPassword").val();return b==""?Vosao.errorMessage("#login-messages",messages("email_is_empty")):Vosao.jsonrpc.loginFrontService.login(function(a,b){if(Vosao.serviceFailed(b))return!1;a.result=="success"?(Vosao.infoMessage("#login-messages",messages("success_logging_in")),Vosao.app.loggedIn=!0,Vosao.app.trigger("login")):Vosao.errorMessage("#login-messages",a.message)},b,c),!1},render:function(){Vosao.addCSSFile(this.css),this.el.html($.jqote(a,{messages:messages})),$("#forgot-dialog").dialog({width:400,autoOpen:!1}),$("#forgotForm").submit(d),$("#forgotCancelButton").click(function(){$("#forgot-dialog").dialog("close")});var e=_.template(b,{messages:messages});return $("#topbar").html(_.template(c,{messages:messages,locale:e})),$("#languageSelect").click(function(){$("#languageDiv").show(),setTimeout(function(){$("#languageDiv").hide()},5e3)}),this},remove:function(){$("#forgot-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/pages.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">\r\n    <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">\r\n        <li class="ui-corner-top ui-tabs-selected ui-state-active">\r\n            <a href="#tab-1"><%= messages("pages") %></a>\r\n        </li>\r\n        <li id="structuresTab" class="ui-corner-top ui-state-default">\r\n            <a href="#structures"><%= messages("structures") %></a>\r\n        </li>\r\n    </ul>\r\n    <div id="tab-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom">\r\n        <!-- div class="outline-link">\r\n            <a href="outline.vm">Outline editor</a>\r\n        </div-->\r\n        <div id="pageSearch"></div>\r\n        <div style="float:left">\r\n          <div id="showTitleDiv">\r\n            <a id="showTitle"><%= messages(\'show_names\') %></a>\r\n            <a id="invertOrder"><%= messages(\'invert_order\') %></a>\r\n          </div>\r\n          <ul id="pages-tree"><img src="/static/images/ajax-loader.gif" /></ul>\r\n        </div>\r\n        <div style="clear:both"></div>  \r\n    </div>\r\n</div>\r\n\r\n<div id="page-dialog" style="display:none" title="<%= messages("pages.new_page") %>">\r\n  <form id="pageForm">\r\n    <div class="form-row">\r\n        <label><%= messages("pages.page_title") %></label>\r\n        <input id="title"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("pages.page_url") %></label>\r\n        <span id="parentURL"></span> <input id="url"/>\r\n    </div>\r\n    <div id="pageMessages"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n'}),define("text!template/index.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="main-panel">\n    <div>\n        <img src="/static/images/pages.png" />\n        <a href="#pages">\n            <%= messages("index.content_pages") %>\n        </a>\n        <p><%= messages("index.content_pages.description") %></p>\n    </div>\n<% if (user.admin) { %>\n    <div>\n        <img src="/static/images/templates.png" />\n        <a href="#templates">\n            <%= messages("index.design_templates") %>\n        </a>\n        <p><%= messages("index.design_templates.description") %></p>\n    </div>\n<% } %>    \n    <div>\n        <img src="/static/images/folders.png" />\n        <a href="#folders">\n            <%= messages("index.file_resources_storage") %>\n        </a>\n        <p><%= messages("index.file_resources_storage.description") %></p>\n    </div>\n<% if (user.admin) { %>\n    <div>\n        <img src="/static/images/config.png" />\n        <a href="#config">\n            <%= messages("index.site_configuration") %>\n        </a>\n        <p><%= messages("index.site_configuration.description") %></p>\n    </div>\n    <div>\n        <img src="/static/images/plugins.png" />\n        <a href="#plugins"><%= messages("index.plugins") %></a>\n        <p><%= messages("index.plugins.description") %></p>\n    </div>\n<% } %>    \n</div>\n'}),define("view/IndexView",["text!template/index.html"],function(a){return console.log("Loading IndexView.js"),Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{user:Vosao.app.user,messages:messages}))},remove:function(){this.el.html("")}})}),define("text!template/structures.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">\n    <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">\n        <li class="ui-corner-top ui-state-default">\n            <a href="#pages"><%= messages("pages") %></a>\n        </li>\n        <li class="ui-corner-top ui-tabs-selected ui-state-active">\n            <a href="#structures"><%= messages("structures") %></a>\n        </li>\n    </ul>\n    <div class="ui-tabs-panel ui-widget-content ui-corner-bottom">\n        <div id="structures"><img src="/static/images/ajax-loader.gif" /></div>\n        <div class="buttons">\n            <input id="addButton" type="button" value="<%= messages("add") %>"/>\n            <input id="deleteButton" type="button" value="<%= messages("delete") %>"/>\n        </div>    \n    </div>\n</div>\n'}),define("view/StructuresView",["text!template/structures.html"],function(a){function b(){Vosao.jsonrpc.structureService.select(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'" /></td><td><a href="#structure/'+c.id+'">'+c.title+"</a></td></tr>"}),$("#structures").html(b+"</table>"),$("#structures tr:even").addClass("even")})}function c(){location.href="#structure"}function d(){var a=new Array;$("#structures input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.structureService.remove(function(a){Vosao.showServiceMessages(a),b()},Vosao.javaList(a))}return console.log("Loading StructuresView.js"),Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),b(),$("#addButton").click(c),$("#deleteButton").click(d)},remove:function(){this.el.html("")}})}),define("text!template/structure.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2010 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="tabs">\n\n<ul>\n    <li><a href="#tab-1"><%= messages("structure") %></a></li>\n    <li><a href="#tab-2"><%= messages("structure.as_xml") %></a></li>\n    <li><a href="#tab-3"><%= messages("structure.templates") %></a></li>\n</ul>\n\n<div id="tab-1">\n    <div class="form-row">\n        <label><%= messages("title") %></label>\n        <input id="title" type="text" />\n    </div>\n    <div class="form-row">\n        <label><%= messages("fields") %></label>\n        <div id="fields"></div>    \n    </div>\n    <div class="form-row" style="margin-top: 20px;">\n        <span><%= messages("structure.field_title") %></span>\n        <input id="fieldTitle" type="text" /> &nbsp;\n        <span><%= messages("structure.tag_name") %></span> &nbsp;\n        <input id="fieldName" type="text" /> &nbsp;\n        <select id="fieldType"> &nbsp;\n            <option value="TEXT"><%= messages("text") %></option>\n            <option value="TEXTAREA"><%= messages("text_area") %></option>\n            <option value="RESOURCE"><%= messages("resource_link") %></option>\n            <option value="DATE"><%= messages("date") %></option>\n        </select>\n        <a id="addField"> <%= messages("add_field") %></a>\n    </div>\n    <div class="buttons">\n        <input id="saveContinueButton" type="button" value="<%= messages("save_continue")%>" />\n        <input id="saveButton" type="button" value="<%= messages("save")%>" />\n        <input id="cancelButton" type="button" value="<%= messages("cancel")%>" />\n    </div>\n</div>\n\n<div id="tab-2">\n    <div class="form-row">\n        <div>\n            <input id="autosave" type="checkbox" /><label for="autosave"><%= messages("autosave")%></label>\n            <%= messages("editor_size")%>:\n            <a id="bigLink" > <%= messages("big")%></a>\n            <a id="smallLink" > <%= messages("small")%></a>\n        </div>\n        <textarea id="xmlContent" rows="20" cols="80" wrap="off"></textarea>\n    </div>\n    <div class="buttons">\n        <input id="saveContinueXMLButton" type="button" \n            value="<%= messages("save_continue")%>" />\n        <input id="saveXMLButton" type="button" value="<%= messages("save")%>" />\n        <input id="cancelXMLButton" type="button" value="<%= messages("cancel")%>" />\n    </div>\n</div>\n\n<div id="tab-3">\n    <div id="templates"><img src="/static/images/ajax-loader.gif" /></div>\n    <div class="buttons">\n        <input id="addTemplateButton" type="button" value="<%= messages("add")%>"/>\n        <input id="deleteTemplateButton" type="button" value="<%= messages("delete")%>"/>\n    </div></div>\n</div>\n'}),define("view/StructureView",["text!template/structure.html"],function(a){function h(){o(),v(),F()}function i(){r(!0)}function j(){r(!1)}function k(){b!="null"&&e==""&&(e=setInterval(m,Vosao.AUTOSAVE_TIMEOUT*1e3))}function l(){e!=""&&(clearInterval(e),e="")}function m(){r(!0)}function n(){$("#autosave:checked").length>0?k():l()}function o(){d=b!="",d||(c=null,p()),Vosao.jsonrpc.structureService.getById(function(a){c=a,p()},b)}function p(){c!=null?($("#title").val(c.title),$("#xmlContent").val(c.content)):($("#title").val(""),$("#xmlContent").val(""))}function q(){location.href="#structures"}function r(a){var c=Vosao.javaMap({id:b,title:$("#title").val(),content:$("#xmlContent").val()});Vosao.jsonrpc.structureService.save(function(c){c.result=="success"?(Vosao.info(messages("structure.success_save")),a?d||(b=c.message,o(),F()):location.href="#structures"):Vosao.showServiceMessages(c)},c)}function s(){$("#xmlContent").attr("cols","120"),$("#xmlContent").attr("rows","30")}function t(){$("#xmlContent").attr("cols","80"),$("#xmlContent").attr("rows","20")}function u(){var a=$("#fieldName").val(),b=$("#fieldTitle").val();a==""&&$("#fieldName").val(Vosao.nameFromTitle(b))}function v(){d&&Vosao.jsonrpc.structureService.getFields(function(a){f=a.list,x()},b)}function w(a){return a=="TEXT"?messages("text"):a=="TEXTAREA"?messages("text_area"):a=="RESOURCE"?messages("resource_link"):a=="DATE"?messages("date"):"Unknown"}function x(){var a='<table class="form-table"><tr><th>'+messages("title")+"</th><th>"+messages("structure.tag_name")+"</th><th>"+messages("type")+"</th><th></th></tr>";$.each(f,function(b,c){a+="<tr><td>"+c.title+"</td>"+"<td>"+c.name+"</td>"+"<td>"+w(c.type)+"</td>"+'<td><a href="#" onclick="Vosao.app.structureView.onFieldRemove('+b+')"><img src="/static/images/02_x.png"/></a> '+'<a href="#" onclick="Vosao.app.structureView.onFieldUp('+b+')"><img src="/static/images/02_up.png"/></a> '+'<a href="#" onclick="Vosao.app.structureView.onFieldDown('+b+')"><img src="/static/images/02_down.png"/></a> '+"</td></tr>"}),$("#fields").html(a+"</table>"),$("#fields tr:even").addClass("even")}function y(a){var b=!0;return a.name==""?(Vosao.error(messages("structure.field_tag_name_empty")),b=!1):$(f,function(c,d){d.name==a.name&&(Vosao.error(messages("structure.field_exists")),b=!1)}),Vosao.isValidIdentifier(a.name)||(Vosao.error(messages("structure.field_tag_name")+" "+a.name+" "+messages("structure.must_valid_identifier")),b=!1),a.title==""&&(Vosao.error(messages("structure.field_title_empty")),b=!1),b}function z(){$("#fieldTitle").focus();var a={title:Vosao.strip($("#fieldTitle").val()),name:Vosao.strip($("#fieldName").val()),type:$("#fieldType").val()};y(a)&&(f.push(a),x(),$("#fieldTitle").val("").focus(),$("#fieldName").val(""),Vosao.info(messages("structure.field_success_add")))}function A(a,b){var c=f[a];f[a]=f[b],f[b]=c}function B(){var a="<structure>\n";return $.each(f,function(b,c){a+="  <field>\n    <title>"+c.title+"</title>\n"+"    <name>"+c.name+"</name>\n"+"    <type>"+c.type+"</type>\n  </field>\n"}),a+"</structure>"}function C(){E(!1)}function D(){E(!0)}function E(a){$("#xmlContent").val(B()),r(a)}function F(){d&&Vosao.jsonrpc.structureTemplateService.selectByStructure(function(a){g=a.list,G()},b)}function G(){var a='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th>"+"<th>"+messages("name")+"</th>"+"<th>"+messages("type")+"</th></tr>";$.each(g,function(b,c){a+='<tr><td><input type="checkbox" value="'+c.id+'"></td>'+'<td><a href="#structureTemplate/'+c.id+'">'+c.title+"</a></td>"+"<td>"+c.name+"</td>"+"<td>"+H(c.typeString)+"</td></tr>"}),$("#templates").html(a+"</table>"),$("#templates tr:even").addClass("even")}function H(a){return a=="VELOCITY"?"Velocity":a=="XSLT"?"XSLT":"Undefined"}function I(){location.href="#addStructureTemplate/"+b}function J(){var a=new Array;$("#templates input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.structureTemplateService.remove(function(a){Vosao.showServiceMessages(a),F()},Vosao.javaList(a))}console.log("Loading StructureView.js");var b="",c="",d=!1,e="",f=[],g=[];return Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),h(),Vosao.selectTabFromQueryParam($("#tabs").tabs()),$("#autosave").change(n),$("#bigLink").click(s),$("#smallLink").click(t),$("#saveContinueXMLButton").click(i),$("#saveXMLButton").click(j),$("#cancelXMLButton").click(q),$("#saveContinueButton").click(D),$("#saveButton").click(C),$("#cancelButton").click(q),$("#addField").click(z),$("#addTemplateButton").click(I),$("#deleteTemplateButton").click(J),$("#fieldTitle").change(u)},setId:function(a){b=a,d=b!="",d||(c="",f=[],g=[])},remove:function(){this.el.html("")},onFieldUp:function(a){if(a==0)return;A(a,a-1),x()},onFieldDown:function(a){if(a+1<f.length)A(a,a+1),x();else return},onFieldRemove:function(a){confirm(messages("are_you_sure"))&&(f.splice(a,1),x())}})}),define("text!template/structureTemplate.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2010 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="tabs">\n\n<ul>\n    <li><a href="#tab-1"><%= messages("structureTemplate.title") %></a></li>\n</ul>\n\n<div id="tab-1">\n    <div class="form-row">\n        <label><%= messages("title") %></label>\n        <input id="title" type="text" />\n    </div>\n    <div class="form-row">\n        <label><%= messages("name") %></label>\n        <input id="name" type="text" />\n    </div>\n    <div class="form-row">\n        <label><%= messages("structureTemplate.content") %></label>\n        <div id="contentDiv">\n            <input id="autosave" type="checkbox" /> <label for="autosave"><%= messages("autosave") %></label>\n            <%= messages("editor_size") %>:\n            <a id="bigLink" > <%= messages("big") %></a>\n            <a id="smallLink" > <%= messages("small") %></a>\n        </div>\n        <textarea id="vcontent" rows="20" cols="80" wrap="off"></textarea>\n    </div>\n    <div class="form-row">\n        <label><%= messages("structureTemplate.head_content") %></label>\n        <textarea id="headContent" rows="8" cols="80" wrap="off"></textarea>\n    </div>\n    <div class="buttons">\n        <input id="saveContinueButton" type="button" value="<%= messages("save_continue") %>" />\n        <input id="saveButton" type="button" value="<%= messages("save") %>" />\n        <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\n    </div>\n</div>\n\n</div>\n'}),define("view/StructureTemplateView",["text!template/structureTemplate.html"],function(a){function g(){if(e)return;var a=$("#name").val(),b=$("#title").val();a==""&&$("#name").val(Vosao.urlFromTitle(b))}function h(){q(!0)}function i(){q(!1)}function j(){b!="null"&&f==""&&(f=setInterval(l,Vosao.AUTOSAVE_TIMEOUT*1e3))}function k(){f!=""&&(clearInterval(f),f="")}function l(){q(!0)}function m(){$("#autosave:checked").length>0?j():k()}function n(){e=b!="",e||(d=null,o()),Vosao.jsonrpc.structureTemplateService.getById(function(a){d=a,e&&(c=d.structureId),o()},b)}function o(){d!=null?($("#name").val(d.name),$("#title").val(d.title),$("#vcontent").val(d.content),$("#headContent").val(d.headContent)):($("#name").val(""),$("#title").val(""),$("#vcontent").val(""),$("#headContent").val(""))}function p(){location.href="#structure/"+c}function q(a){var d=Vosao.javaMap({id:b,name:Vosao.strip($("#name").val()),title:Vosao.strip($("#title").val()),type:"VELOCITY",structureId:String(c),content:$("#vcontent").val(),headContent:$("#headContent").val()});Vosao.jsonrpc.structureTemplateService.save(function(c){c.result=="success"?(Vosao.info(messages("structureTemplate.success_save")),a?e||(b=c.message,n()):p()):Vosao.showServiceMessages(c)},d)}function r(){$("#vcontent").attr("cols","120"),$("#vcontent").attr("rows","30")}function s(){$("#vcontent").attr("cols","80"),$("#vcontent").attr("rows","20")}console.log("Loading StructureTemplateView.js");var b="",c="",d="",e=b!="",f="";return Backbone.View.extend({css:"/static/css/structureTemplate.css",el:$("#content"),render:function(){Vosao.addCSSFile(this.css),this.el.html(_.template(a,{messages:messages})),n(),$("#tabs").tabs(),$("#autosave").change(m),$("#bigLink").click(r),$("#smallLink").click(s),$("#saveContinueButton").click(h),$("#saveButton").click(i),$("#cancelButton").click(p),$("#title").change(g)},remove:function(){Vosao.removeCSSFile(this.css),this.el.html("")},create:function(a){b="",c=a,d="",e=b!=""},edit:function(a){b=a,c="",d="",e=b!=""}})}),define("text!template/templates.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2010 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="tabs">\n\n<ul>\n    <li><a href="#tab-1"><%= messages("templates") %></a></li>\n</ul>\n\n<div id="tab-1">\n    <div id="templates"><img src="/static/images/ajax-loader.gif" /></div>\n    <div class="buttons">\n        <input id="addButton" type="button" value="<%= messages("add")%>" />\n        <input id="deleteButton" type="button" value="<%= messages("delete")%>" />\n        <input id="exportButton" type="button" value="<%= messages("export")%>" />\n        <input id="importButton" type="button" value="<%= messages("import")%>" />\n    </div>\n</div>\n\n</div>\n\n<div id="import-dialog" title="<%= messages("templates.import_themes")%>" style="display:none">\n<form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\n    <%= messages("file_upload")%>:\n    <input type="hidden" name="fileType" value="import" />\n    <input type="file" name="uploadFile" />\n    <div class="buttons-dlg">\n        <input type="submit" value="<%= messages("send")%>" />\n        <input id="importCancelButton" type="button" value="<%= messages("cancel")%>" />\n    </div>    \n</form>\n</div>\n\n<div id="afterUpload-dialog" style="display:none" title="<%= messages("status_window")%>">\n    <p class="message"></p>\n    <div class="buttons-dlg">\n        <input id="okButton" type="button" value="OK" />\n    </div>\n</div>\n\n<div id="export-dialog" style="display:none" title="<%= messages("export_window")%>">\n  <form id="exportForm">\n    <p><%= messages("templates.export_info")%></p>\n    <div id="exportInfo" class="form-row"></div>    \n    <div id="timer" class="form-row"></div>\n    <div class="buttons-dlg">\n        <input id="exportCancelButton" type="button" value="<%= messages("cancel")%>" />\n    </div>\n  </form>\n</div>\n\n<div id="structures-dialog" style="display:none" title="<%= messages("export_structures")%>">\n  <form id="structuresForm">\n    <p><%= messages("templates.structures_info")%></p>\n    <div id="structures"></div>    \n    <div class="buttons-dlg">\n        <input type="submit" value="<%= messages("export")%>" />\n        <input id="structuresCancelButton" type="button" value="<%= messages("cancel")%>" />\n    </div>\n  </form>\n</div>\n'}),define("view/TemplatesView",["text!template/templates.html","jquery.form"],function(a){function f(){k(),l()}function g(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?d=messages("templates.success_import"):d=messages("error")+". "+d,$("#import-dialog").dialog("close"),$("#afterUpload-dialog .message").text(d),$("#afterUpload-dialog").dialog("open")}function h(){$("#import-dialog").dialog("open")}function i(){$("#import-dialog").dialog("close")}function j(){$("#afterUpload-dialog").dialog("close"),f()}function k(){Vosao.jsonrpc.templateService.getTemplates(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'" /></td><td><a href="#template/'+c.id+'">'+c.title+"</a></td></tr>"}),$("#templates").html(b+"</table>"),$("#templates tr:even").addClass("even")})}function l(){Vosao.jsonrpc.structureService.select(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'" /></td><td>'+c.title+"</td></tr>"}),$("#structures").html(b+"</table>"),$("#structures tr:even").addClass("even")})}function m(){location.href="#template"}function n(){var a=new Array;$("#templates input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.templateService.deleteTemplates(function(a){Vosao.showServiceMessages(a),k()},Vosao.javaList(a))}function o(){$("#structures input:checked").each(function(){this.checked=!1}),$("#structures-dialog").dialog("open")}function p(){$("#structures-dialog").dialog("close"),d=0,r();var a=[],f=[];$("#templates input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}$("#structures input:checked").each(function(){f.push(this.value)}),$("#export-dialog").dialog("open"),Vosao.jsonrpc.configService.startExportThemeTask(function(a){a.result=="success"?($("#templates input:checked").each(function(){this.checked=!1}),e=a.message,Vosao.infoMessage("#exportInfo",messages("creating_export_file")),b=setInterval(q,1e4),c=setInterval(r,1e3)):Vosao.showServiceMessages(a)},Vosao.javaList(a),Vosao.javaList(f))}function q(){Vosao.jsonrpc.configService.isExportTaskFinished(function(a){a&&(clearInterval(b),clearInterval(c),$("#export-dialog").dialog("close"),$("#exportDialogButton").attr("disabled",!1),location.href="/file/tmp/"+e)},"theme")}function r(){$("#timer").html(d++ +" "+messages("sec")+".")}function s(){$("#export-dialog").dialog("close"),clearInterval(b),clearInterval(c)}console.log("Loading TemplatesView.js");var b=null,c=null,d=0,e=null;return Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),$("#import-dialog").dialog({width:400,autoOpen:!1}),$("#export-dialog").dialog({width:400,autoOpen:!1}),$("#structures-dialog").dialog({width:400,autoOpen:!1}),$("#afterUpload-dialog").dialog({autoOpen:!1}),$("#upload").ajaxForm(g),f(),$("#tabs").tabs(),$("#addButton").click(m),$("#deleteButton").click(n),$("#exportButton").click(o),$("#exportCancelButton").click(s),$("#importButton").click(h),$("#importCancelButton").click(i),$("#okButton").click(j),$("#structuresForm").submit(function(){return p(),!1}),$("#structuresCancelButton").click(function(){$("#structures-dialog").dialog("close")})},remove:function(){$("#import-dialog, #export-dialog, #structures-dialog, #afterUpload-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/template.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2011 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">\n\n<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">\n    <li class="ui-corner-top ui-state-active">\n        <a href="#"><%= messages("template") %></a>\n    </li>\n    <li class="ui-corner-top ui-state-default">\n        <a id="resources" href="#"><%= messages("resources") %></a>\n    </li>\n</ul>\n\n<div id="tab-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom">\n<form id="templateForm">\n    <div class="form-row">\n        <label><%= messages("title") %></label>\n        <input id="title" type="text" />\n    </div>\n    <div class="form-row">\n        <label><%= messages("url_name") %></label>\n        <input id="url" type="text" />\n    </div>\n    <div class="form-row">\n        <div>\n            <input id="autosave" type="checkbox" /> <label for="autosave"><%= messages("autosave") %></label>\n            <%= messages("editor_size") %>: &nbsp;\n            <a id="sizeLink"><%= messages("big") %></a>&nbsp;\n            <a id="wrapLink"><%= messages("wrap") %></a>\n        </div>\n        <div id="contentDiv">\n            <textarea id="tcontent" rows="20" cols="80" wrap="off"></textarea>\n        </div>\n    </div>\n    <div class="buttons">\n        <input id="saveContinueButton" type="button" value="<%= messages("save_continue") %>" />\n        <input id="saveButton" type="submit" value="<%= messages("save") %>" />\n        <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\n    </div>\n</form>\n</div>\n\n</div>\n\n'}),define("view/TemplateView",["text!template/template.html","jquery.treeview"],function(a){function g(){n()}function h(){q(!0)}function i(){q(!1)}function j(){b!="null"&&e==""&&(e=setInterval(l,Vosao.AUTOSAVE_TIMEOUT*1e3))}function k(){e!=""&&(clearInterval(e),e="")}function l(){var a=$("#tcontent").val();Vosao.jsonrpc.templateService.updateContent(function(a){if(a.result=="success"){var b=new Date;Vosao.info(a.message+" "+b)}else Vosao.error(a.message)},b,a)}function m(){$("#autosave:checked").length>0?j():k()}function n(){d=b!="",d||(c=null,o()),Vosao.jsonrpc.templateService.getTemplate(function(a){c=a,o()},b)}function o(){c!=null?($("#title").val(c.title),$("#url").val(c.url),$("#tcontent").val(c.content)):($("#title").val(""),$("#url").val(""),$("#tcontent").val(""))}function p(){location.href="#templates"}function q(a){var c=Vosao.javaMap({id:b,title:$("#title").val(),url:$("#url").val(),content:$("#tcontent").val()});Vosao.jsonrpc.templateService.saveTemplate(function(c){c.result=="success"?(Vosao.info(messages("template.success_save")),a?d||(b=c.message,n()):location.href="#templates"):Vosao.showServiceMessages(c)},c)}function r(){f?($("#tcontent").attr("cols","120"),$("#tcontent").attr("rows","30"),$("#sizeLink").text(messages("small")),f=!1):($("#tcontent").attr("cols","80"),$("#tcontent").attr("rows","20"),$("#sizeLink").text(messages("big")),f=!0)}function s(){var a=$("#tcontent").attr("wrap"),b=$("#tcontent").val(),c=$("#tcontent").attr("cols"),d=$("#tcontent").attr("rows");a=="off"&&($("#contentDiv").html('<textarea id="tcontent" cols="'+c+'" rows="'+d+'"></textarea>'),$("#tcontent").val(b),$("#wrapLink").text(" "+messages("unwrap"))),a==undefined&&($("#contentDiv").html('<textarea id="tcontent" cols="'+c+'" rows="'+d+'" wrap="off"></textarea>'),$("#tcontent").val(b),$("#wrapLink").text(" "+messages("wrap")))}function t(){$.cookie("folderReturnPath","#template/"+c.id,{path:"/",expires:10}),Vosao.jsonrpc.folderService.createFolderByPath(function(a){location.href="#folder/"+a.id},"/theme/"+c.url)}console.log("Loading TemplateView.js");var b="",c="",d=b!="",e="",f=!0;return Backbone.View.extend({css:"/static/css/jquery.treeview.css",el:$("#content"),render:function(){Vosao.addCSSFile(this.css),this.el.html(_.template(a,{messages:messages})),g(),$("#autosave").change(m),$("#sizeLink").click(r),$("#wrapLink").click(s),$("#saveContinueButton").click(h),$("#templateForm").submit(function(){return i(),!1}),$("#cancelButton").click(p),$("#resources").click(t)},remove:function(){Vosao.removeCSSFile(this.css),this.el.html("")},create:function(){b="",c="",d=b!=""},edit:function(a){b=a,c="",d=b!=""}})}),define("text!template/page/page.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="versions" class="ui-tabs ui-widget ui-corner-all ui-widget-content">\r\n    <div class="vertical-buttons-panel"> </div>      \r\n    <a id="addVersionLink" class="button ui-state-default ui-corner-all" \r\n        href="#">\r\n        <span class="ui-icon ui-icon-plus"></span> <%= messages("add_version") %>\r\n    </a>\r\n    <div id="auditData">\r\n        <div><%= messages("page.state") %>: <span id="pageState"> </span></div>\r\n        <div><%= messages("page.user_created") %>: <span id="pageCreateUser"> </span></div>\r\n        <div><%= messages("creation_date") %>: <span id="pageCreateDate"> </span></div>\r\n        <div><%= messages("page.user_modified") %>: <span id="pageModUser"> </span></div>\r\n        <div><%= messages("modify_date") %>: <span id="pageModDate"> </span></div>\r\n    </div>\r\n</div>\r\n\r\n<div id="breadcrumbs">\r\n    <span class="button ui-state-default ui-corner-all" style="padding:4px 10px;">\r\n        <a href="#pages"><%= messages("content") %>:</a> \r\n        <a id="rootPage">/</a> \r\n        <span id="crumbs"></span>\r\n    </span>\r\n</div>\r\n\r\n<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all"\r\n    style="margin-top: 14px;">\r\n\r\n<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">\r\n    <li class="pageTab ui-corner-top ui-state-default">\r\n        <a href="#page/<%= id %>"><%= messages("page") %></a>\r\n    </li>\r\n    <li class="contentTab ui-corner-top ui-state-default">\r\n        <a href="#page/content/<%= id %>"><%= messages("content") %></a>\r\n    </li>\r\n    <li class="childrenTab ui-corner-top ui-state-default">\r\n        <a href="#page/children/<%= id %>"><%= messages("page.children_pages") %></a>\r\n    </li>\r\n    <li class="commentsTab ui-corner-top ui-state-default">\r\n        <a href="#page/comments/<%= id %>"><%= messages("comments") %></a>\r\n    </li>\r\n    <li class="securityTab ui-corner-top ui-state-default">\r\n        <a href="#page/security/<%= id %>"><%= messages("security") %></a>\r\n    </li>\r\n    <li class="securityTab ui-corner-top ui-state-default">\r\n        <a href="#page/resources/<%= id %>"><%= messages("resources") %></a>\r\n    </li>\r\n    <li class="securityTab ui-corner-top ui-state-default">\r\n        <a href="#page/attributes/<%= id %>"><%= messages("attributes") %></a>\r\n    </li>\r\n</ul>\r\n\r\n<div id="tab-1" class="contentTab ui-tabs-panel ui-widget-content ui-corner-bottom">\r\n</div>\r\n\r\n<div id="version-dialog" style="display:none" title="<%= messages("page.version_title") %>">\r\n  <form id="versionForm">\r\n    <div class="form-row">\r\n        <label><%= messages("page.version_title") %></label>\r\n        <input id="version-title" type="text" />        \r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="versionSaveButton" type="submit" \r\n            value="<%= messages("add") %>" />\r\n        <input id="versionCancelButton" type="button" \r\n            value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n'}),define("text!template/page/content.html",[],function(){return'<%/*\n Vosao CMS. Simple CMS for Google App Engine.\n \n Copyright (C) 2009-2010 Vosao development team.\n\n This library is free software; you can redistribute it and/or\n modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2.1 of the License, or (at your option) any later version.\n\n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n\n email: vosao.dev@gmail.com\n*/%>\n\n<form id="pageForm">\n\n<div style="padding-right:10px">\n    <div style="float:right">\n        <input id="autosave" type="checkbox" /> <label for="autosave"><%= messages("autosave") %></label>\n    </div>\n    <div id="friendlyUrlDiv" class="form-row">\n        <label><%= messages("page.friendly_url") %></label>\n        <span id="parentFriendlyUrl"></span>\n        <input id="friendlyUrl" type="text" />\n        <span id="friendlyUrlSpan"></span>\n    </div>\n    <div class="form-row">\n        <label><%= messages("page.select_language") %>:</label> \n        <select id="language"></select>\n    </div>\n    <div class="form-row" style="margin-top:10px;">\n        <label><%= messages("title") %></label>\n        <input id="titleLocal" type="text" class="form-title" size="40" />\n    </div>\n    <div class="form-row" id="editorButtons">\n        <a id="ckedit"></a>\n    </div>\n    <div id="page-content"></div>\n</div>\n<div class="buttons">\n    <div id="approveOnContentSaveDiv" class="checkboxes">\n        <input id="approveOnContentSave" type="checkbox" />\n            <label for="approveOnContentSave"><%= messages("page.approve_save") %></label>\n    </div> \n    <input id="saveContinueContentButton" type="button" \n        value="<%= messages("save_continue") %>" />\n    <input id="saveContentButton" type="submit" \n        value="<%= messages("save") %>" />\n    <input id="contentPreviewButton" type="button" \n        value="<%= messages("preview") %>" />\n    <input id="approveButton" type="button" \n        value="<%= messages("approve") %>" />\n    <input id="restoreButton" type="button" \n        value="<%= messages("restore") %>" />\n    <input id="resetCacheButton" type="button" \n        value="<%= messages("page.reset_cache") %>" />\n    <input id="contentCancelButton" type="button" \n        value="<%= messages("cancel") %>" />\n</div>    \n\n</form>\n\n<div id="restore-dialog" style="display:none" title="<%= messages("page.restore_content") %>">\n  <form id="restoreForm">\n    <div class="form-row">\n        <input name="page" type="radio" value="home" checked="checked"/> \n            <%= messages("home_page") %> <br/>        \n        <input name="page" type="radio" value="login" /> \n            <%= messages("login_page") %> <br/>        \n        <input name="page" type="radio" value="search" /> \n            <%= messages("search_page") %>         \n    </div>\n    <div class="buttons-dlg">\n        <input id="restoreSaveButton" type="submit" value="OK" />\n        <input id="restoreCancelButton" type="button" value="<%= messages("cancel") %>" />\n    </div>\n  </form>\n</div>\n\n<div id="file-upload" title="<%= messages("folder.upload_file") %>" style="display:none">\n    <form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\n        <%= messages("file_upload") %>:\n        <input type="hidden" name="fileType" value="resource" />\n        <input type="hidden" name="folderId" />\n        <input type="file" name="uploadFile" multiple="true" />\n        <div class="buttons-dlg">\n            <input type="submit" value="<%= messages("send") %>" />\n            <input id="fileUploadCancelButton" type="button" \n                value="<%= messages("cancel") %>" />\n        </div>\n    </form>\n</div>\n\n'}),define("view/page/ContentView",["text!template/page/content.html","view/page/context","view/page/version","view/page/breadcrumbs","jquery.form"],function(a,b,c,d){function n(){b.loadData=o,b.editMode=b.pageId!="",$("#restore-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(o),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),c.initVersionDialog(),$("#autosave").change(A),$("#language").change(D),$("#saveContinueContentButton").click(function(){t(!0)}),$("#pageForm").submit(function(){return t(!1),!1}),$("#contentPreviewButton").click(B),$("#approveButton").click(F),$("#restoreButton").click(N),$("#contentCancelButton").click(C),$("ul.ui-tabs-nav li:nth-child(2)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#restoreForm").submit(function(){return P(),!1}),$("#restoreCancelButton").click(O),$("#resetCacheButton").click(S),$("#file-upload").dialog({width:400,autoOpen:!1}),$("#upload").ajaxForm({beforeSubmit:X,success:W}),$("#fileUploadCancelButton").click(V)}function o(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,m=!b.pageRequest.config.enableCkeditor||b.pageRequest.page.wikiProcessing||!b.page.enableCkeditor;var c=b.pageRequest.page.wikiProcessing?' <a href="http://en.wikipedia.org/wiki/Help:Wiki_markup" target="blank">Wiki syntax</a>':"";m?$("#ckedit").text(messages("page.edit_ckeditor")).click(R):$("#ckedit").text(messages("page.edit_textarea")).click(Q),$("#editorButtons").append(c),r(),q(),d.breadcrumbsShow()},b.pageId,b.pageParentUrl)}function p(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,b.editMode=b.pageId!=null,q()},b.pageId,b.pageParentUrl)}function q(){b.pageId=b.page.id==null?"":String(b.page.id),b.pageParentUrl=b.page.parentUrl,c.loadVersions(),K(),s(),G(),E()}function r(){var a=b.pageRequest.languages;g={};var c="";$.each(a.list,function(a,b){g[b.code]=b,c+='<option value="'+b.code+'" '+">"+b.title+"</option>"}),$("#language").html(c)}function s(){var a=b.pageParentUrl=="/"?"":"/";b.page.parentUrl==""||b.page.parentUrl==null?($("#friendlyUrl").hide(),$("#friendlyUrl").val(""),$("#parentFriendlyUrl").html("/")):($("#friendlyUrl").show(),$("#friendlyUrl").val(b.page.pageFriendlyURL),$("#parentFriendlyUrl").html(b.page.parentFriendlyURL+a)),b.pageRequest.children.list.length>0&&($("#parentFriendlyUrl").hide(),$("#friendlyUrl").hide(),$("#friendlyUrlSpan").html(b.page.friendlyURL)),$("#pageState").html(b.page.stateString=="EDIT"?messages("edit"):messages("approved")),$("#pageCreateDate").html(b.page.createDateTimeString),$("#pageModDate").html(b.page.modDateTimeString),$("#pageCreateUser").html(b.page.createUserEmail),$("#pageModUser").html(b.page.modUserEmail),b.page.id!=null?($(".pageTab").show(),$(".childrenTab").show(),$(".commentsTab").show(),$(".securityTab").show(),$("#pagePreview").show(),$("#versions").show()):($(".pageTab").hide(),$(".childrenTab").hide(),$(".commentsTab").hide(),$(".securityTab").hide(),$("#pagePreview").hide(),$("#versions").hide()),H(),T()}function t(a){var c=Vosao.javaMap({id:b.pageId,friendlyUrl:$("#parentFriendlyUrl").text()+$("#friendlyUrl").val(),titles:M(),content:x(),approve:String($("#approveOnPageSave:checked, #approveOnContentSave:checked").size()>0),languageCode:b.currentLanguage});Vosao.jsonrpc.pageService.savePage(function(b){b.result=="success"?(Vosao.info(messages("page.success_save")),a?p():location.href="#pages"):Vosao.showServiceMessages(b)},c)}function u(){b.editMode&&j==""&&(j=setInterval(v,Vosao.AUTOSAVE_TIMEOUT*1e3))}function v(){t(!0)}function w(){j!=""&&(clearInterval(j),j="")}function x(){if(!b.editMode)return"";if(b.page.simple)return m?$("#pcontent").val():h.getData();if(b.page.structured){var a='<?xml version="1.0" encoding="utf-8"?>\n<content>\n';return $.each(b.pageRequest.structureFields.list,function(b,c){if(c.type=="TEXT"||c.type=="DATE"||c.type=="RESOURCE")a+="<"+c.name+">"+$("#field"+c.name).val()+"</"+c.name+">\n";if(c.type=="TEXTAREA"){var d="";m?d=$("#field"+c.name).val():d=k[c.name].getData(),a+="<"+c.name+"><![CDATA["+d.replace("]]>","]]]")+"]]></"+c.name+">\n"}}),a+"</content>"}}function y(a){b.page.simple&&(m?$("#pcontent").val(a):h.setData(a));if(b.page.structured){var c=$.xmlDOM(a,function(b){a&&Vosao.error(messages("page.parsing_error")+" "+b)});$.each(b.pageRequest.structureFields.list,function(a,b){(b.type=="TEXT"||b.type=="DATE"||b.type=="RESOURCE")&&$(c).find(b.name).each(function(){$("#field"+b.name).val($(this).text())}),b.type=="TEXTAREA"&&(m?$(c).find(b.name).each(function(){$("#field"+b.name).val($(this).text())}):$(c).find(b.name).each(function(){k[b.name].setData($(this).text())}))})}}function z(){return e[b.currentLanguage]!=x()}function A(){$("#autosave:checked").length>0?u():w()}function B(){var a=b.page.friendlyURL+"?language="+b.currentLanguage+"&version="+b.page.version;window.open(a,"preview")}function C(){location.href="#pages"}function D(){!z()||confirm(messages("are_you_sure_changes_lost"))?(b.currentLanguage=$("#language").val(),e[b.currentLanguage]==undefined&&(e[b.currentLanguage]=""),y(e[b.currentLanguage]),$("#titleLocal").val(L())):$("#language").val(b.currentLanguage)}function E(){if(b.pageRequest.contents!=null){var a=b.pageRequest.contents;e={},$.each(a.list,function(a,b){e[b.languageCode]=b.content}),b.currentLanguage||(g[Vosao.ENGLISH_CODE]!=undefined?b.currentLanguage=Vosao.ENGLISH_CODE:b.currentLanguage=a.list[0].languageCode),$("#language").val(b.currentLanguage),y(e[b.currentLanguage]),$("#titleLocal").val(L())}else y("")}function F(){Vosao.jsonrpc.pageService.approve(function(a){Vosao.showServiceMessages(a),o()},b.pageId)}function G(){var a=b.pageRequest.pagePermission;a.publishGranted?($("#approveButton").show(),$("#approveOnPageSaveDiv").show(),$("#approveOnContentSaveDiv").show()):($("#approveButton").hide(),$("#approveOnPageSaveDiv").hide(),$("#approveOnContentSaveDiv").hide()),a.changeGranted?($("#pageSaveButton").show(),$("#saveContinueContentButton").show(),$("#saveContentButton").show()):($("#pageSaveButton").hide(),$("#saveContinueContentButton").hide(),$("#saveContentButton").hide()),a.admin&&b.editMode?$(".securityTab").show():$(".securityTab").hide(),T()}function H(){$.each(CKEDITOR.instances,function(a,b){CKEDITOR.remove(b)}),b.page.simple&&($("#page-content").html('<textarea id="pcontent" rows="20" cols="80"></textarea>'),m||(h=CKEDITOR.replace("pcontent",{height:350,width:"auto",filebrowserUploadUrl:"/cms/upload",filebrowserBrowseUrl:"fileBrowser.html",toolbar:"Vosao"})));if(b.page.structured){var a="";$.each(b.pageRequest.structureFields.list,function(b,c){a+='<div><div class="label">'+c.title+":</div>",c.type=="TEXT"&&(a+='<input id="field'+c.name+'" size="30"/>'),c.type=="TEXTAREA"&&(a+='<textarea cols="80" rows="20" id="field'+c.name+'"></textarea>'),c.type=="DATE"&&(a+='<input id="field'+c.name+'" class="datepicker" size="8" />'),c.type=="RESOURCE"&&(a+='<input id="field'+c.name+'" size="60"/> '+'<a class="browse" data-name="field'+c.name+'">'+messages("browse")+"</a>"+' <a class="upload" data-name="field'+c.name+'">'+messages("upload")+"</a>"),a+="</div>"}),$("#page-content").html(a),$("#page-content .browse").click(function(){I($(this).attr("data-name"))}),$("#page-content .upload").click(function(){U($(this).attr("data-name"))}),$("#page-content").css("float","left"),$(".datepicker").datepicker({dateFormat:"dd.mm.yy"}),k={},m||$.each(b.pageRequest.structureFields.list,function(a,b){if(b.type=="TEXTAREA"&&k[b.name]==undefined){var c=CKEDITOR.replace("field"+b.name,{height:150,width:"auto",filebrowserUploadUrl:"/cms/upload",filebrowserBrowseUrl:"fileBrowser.html",toolbar:"Vosao"});k[b.name]=c}})}}function I(a){l=a,$.cookie("fileBrowserPath","/page"+b.page.friendlyURL,{path:"/",expires:10}),window.open("fileBrowser.html?mode=page")}function J(a){$("#"+l).val(a)}function K(){f=b.page.titles.map}function L(){return f[b.currentLanguage]==undefined?"":f[b.currentLanguage]}function M(){if(!b.editMode)return"{"+Vosao.ENGLISH_CODE+':"'+$("#title").val()+'"}';f[b.currentLanguage]=$("#titleLocal").val();var a="{",c=0;return $.each(f,function(b,d){var e=c++==0?"":",";a+=e+b+':"'+d+'"'}),a+"}"}function N(){$("#restore-dialog").dialog("open")}function O(){$("#restore-dialog").dialog("close")}function P(){var a=$("input[name=page]:checked").val();Vosao.jsonrpc.pageService.restore(function(a){Vosao.showServiceMessages(a),a.result=="success"&&($("#restore-dialog").dialog("close"),o())},b.pageId,a,b.currentLanguage)}function Q(){m=!0,$("#ckedit").text(messages("page.edit_ckeditor")).click(R),H(),y(e[b.currentLanguage])}function R(){m=!1,$("#ckedit").text(messages("page.edit_textarea")).click(Q),H(),y(e[b.currentLanguage])}function S(){b.editMode&&Vosao.jsonrpc.pageService.resetCache(function(a){Vosao.showServiceMessages(a)},b.page.friendlyURL)}function T(){b.page.friendlyURL.endsWith("/_default")&&(b.isDefault=!0,$(".securityTab, .commentsTab, .childrenTab, #approveOnContentSaveDiv, #contentPreviewButton, #versions, #resetCacheButton, #restoreButton, #approveButton, #friendlyUrlDiv").hide())}function U(a){l=a,$("#file-upload input[name=folderId]").val(b.pageRequest.folderId),$("#file-upload").dialog("open")}function V(){$("#file-upload").dialog("close")}function W(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?Vosao.info(messages("folder.file_success_upload")):Vosao.error(messages("folder.error_during_upload")+" "+d),$("#file-upload").dialog("close")}function X(a,c,d){var e=Vosao.getFileName($("#file-upload input[name=uploadFile]").val()),f="/file/page"+b.page.friendlyURL+"/"+e;$("#"+l).val(f)}console.log("Loading ContentView.js");var e=null,f=null,g=null,h=null,i="",j="",k=null,l="",m=!1;return Backbone.View.extend({el:$("#tab-1"),tmpl:_.template(a),render:function(){this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),n()},remove:function(){this.el.html(""),$("#restore-dialog, #file-upload").dialog("destroy").remove()},setResource:function(a){J(a)}})}),define("text!template/page/index.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<form id="pageForm">\r\n\r\n<div id="titleDiv" class="form-row">\r\n    <label><%= messages("title") %></label>\r\n    <input id="title" type="text" class="form-title" size="40" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.friendly_url") %></label>\r\n    <span id="parentFriendlyUrl"></span>\r\n    <input id="friendlyUrl" type="text" />\r\n    <span id="friendlyUrlSpan"></span>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("restful") %></label>\r\n    <input id="restful" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("template") %></label>\r\n    <select id="templates"></select>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.publication_date") %></label>\r\n    <input id="publishDate" type="text" class="datepicker" size="9"/>\r\n    <input id="publishTime" type="text" size="5"/>\r\n    -\r\n    <input id="endPublishDate" type="text" class="datepicker" size="9"/>\r\n    <input id="endPublishTime" type="text" size="5"/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("enable_comments") %></label>\r\n    <input id="commentsEnabled" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.include_search") %></label>\r\n    <input id="searchable" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.velocity_processing") %></label>\r\n    <input id="velocityProcessing" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.wiki_processing") %></label>\r\n    <input id="wikiProcessing" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("config.enable_ckeditor") %></label>\r\n    <input id="enableCkeditor" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.skip_postprocessing") %></label>\r\n    <input id="skipPostProcessing" type="checkbox" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.cache_enabled") %></label>\r\n    <input id="cached" type="checkbox" />\r\n</div>\r\n<div id="dependenciesDiv" class="form-row">\r\n    <label><%= messages("cache_dependencies") %></label>\r\n    <input id="dependencies" type="text" class="form-title" size="60" />\r\n</div>\r\n\r\n<div class="form-row">\r\n    <label><%= messages("page.type") %></label>\r\n    <select id="pageType">\r\n        <option value="SIMPLE"><%= messages("simple") %></option>\r\n        <option value="STRUCTURED"><%= messages("structured") %></option>\r\n    </select>\r\n</div>\r\n\r\n<div id="structuredControls">\r\n<div class="form-row">\r\n    <label><%= messages("structure") %></label>\r\n    <select id="structure"></select>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.structure_template") %></label>\r\n    <select id="structureTemplate"></select>\r\n</div>\r\n</div>\r\n\r\n<div id="tagsDiv" class="form-row">\r\n    <label><%= messages("tags") %></label>\r\n    <a id="addTag" href="#"><%= messages("add_tag") %></a>\r\n    <span id="tags"></span>\r\n</div>\r\n\r\n<div class="form-row">\r\n    <a id="metadata" href="#"><%= messages("page.metadata") %></a>\r\n</div>\r\n<div id="meta" style="display:none">\r\n<div class="form-row">\r\n    <label><%= messages("page.meta_keywords") %></label>\r\n    <textarea id="keywords" rows="5" cols="80"></textarea>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.meta_description") %></label>\r\n    <textarea id="description" rows="5" cols="80"></textarea>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("page.head_content") %></label>\r\n    <textarea id="headHtml" rows="5" cols="80"></textarea>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("content_type") %></label>\r\n    <input id="contentType" type="text" class="form-title" />\r\n</div>\r\n</div>\r\n\r\n<div class="buttons">\r\n    <div id="approveOnPageSaveDiv" class="checkboxes">\r\n        <input id="approveOnPageSave" type="checkbox"> \r\n            <label for="approveOnPageSave"><%= messages("page.approve_save") %></label>\r\n    </div> \r\n    <input id="pageSaveButton" type="submit" \r\n        value="<%= messages("save") %>" />\r\n    <input id="pagePreview" type="button" \r\n        value="<%= messages("preview") %>" />\r\n    <input id="pageCancelButton" type="button" \r\n        value="<%= messages("cancel") %>" />\r\n</div>    \r\n\r\n</form>\r\n\r\n<div id="tag-dialog" style="display:none" title="<%= messages("select_tag") %>">\r\n    <ul id="tagTree"></ul>\r\n</div>\r\n\r\n\r\n'}),define("view/page/IndexView",["text!template/page/index.html","view/page/context","view/page/version","view/page/breadcrumbs","jquery.treeview"],function(a,b,c,d){function f(){b.loadData=g,b.editMode=b.pageId!="",$("#tag-dialog").dialog({width:400,autoOpen:!1}),$(".datepicker").datepicker({dateFormat:"dd.mm.yy"}),Vosao.initJSONRpc(g),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),c.initVersionDialog(),$("#title").change(p),$("#pageType").change(q),$("#structure").change(w),$("#pageForm").submit(function(){return o(),!1}),$("#pagePreview").click(r),$("#pageCancelButton").click(s),$("#approveButton").click(t),$("ul.ui-tabs-nav li:nth-child(1)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#metadata").click(function(){$("#meta").toggle()}),$("#addTag").click(A),$("#cached").click(function(){$("#dependenciesDiv").toggle()})}function g(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,k(),v(),j(),d.breadcrumbsShow()},b.pageId,b.pageParentUrl)}function h(){b.page!=null&&b.page.friendlyURL.endsWith("/_default")&&(b.isDefault=!0,$(".securityTab, .commentsTab, .childrenTab, #approveOnPageSaveDiv, #pagePreview, #versions, #tagsDiv").hide(),$("#title, #friendlyUrl").attr("disabled",!0))}function i(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,b.editMode=b.pageId!=null,j()},b.pageId,b.pageParentUrl)}function j(){b.editMode?(b.pageId=String(b.page.id),b.pageParentUrl=b.page.parentUrl,c.loadVersions(),y(),z(),F()):b.pages[1]=b.page,l(),u()}function k(){var a=b.pageRequest.templates,c="";$.each(a.list,function(a,b){c+='<option value="'+b.id+'">'+b.title+"</option>"}),$("#templates").html(c),b.page.id!=null?$("#templates").val(b.page.template):$("#templates").val($.cookie("page_template"))}function l(){var a=b.pageParentUrl=="/"?"":"/";$("#title").val(b.page.title),$("#titleDiv").hide(),b.page.parentUrl==""||b.page.parentUrl==null?($("#friendlyUrl").hide(),$("#friendlyUrl").val(""),$("#parentFriendlyUrl").html("/")):($("#friendlyUrl").show(),$("#friendlyUrl").val(b.page.pageFriendlyURL),$("#parentFriendlyUrl").html(b.page.parentFriendlyURL+a)),b.pageRequest.children.list.length>0&&($("#parentFriendlyUrl").hide(),$("#friendlyUrl").hide(),$("#friendlyUrlSpan").html(b.page.friendlyURL)),$("#pageType").val(b.page.pageTypeString),$("#publishDate").val(b.page.publishDateString),$("#publishTime").val(b.page.publishTimeString),$("#endPublishDate").val(b.page.endPublishDateString),$("#endPublishTime").val(b.page.endPublishTimeString),$("#commentsEnabled").each(function(){this.checked=b.page.commentsEnabled}),$("#searchable").each(function(){this.checked=b.page.searchable}),$("#velocityProcessing").each(function(){this.checked=b.page.velocityProcessing}),$("#wikiProcessing").each(function(){this.checked=b.page.wikiProcessing}),$("#enableCkeditor").each(function(){this.checked=b.page.enableCkeditor}),$("#skipPostProcessing").each(function(){this.checked=b.page.skipPostProcessing}),$("#cached").each(function(){this.checked=b.page.cached}),$("#restful").each(function(){this.checked=b.page.restful}),$("#templates").val(b.page.template),$("#pageState").html(b.page.stateString=="EDIT"?messages("edit"):messages("approved")),$("#pageCreateDate").html(b.page.createDateTimeString),$("#pageModDate").html(b.page.modDateTimeString),$("#pageCreateUser").html(b.page.createUserEmail),$("#pageModUser").html(b.page.modUserEmail),$("#keywords").val(b.page.keywords),$("#description").val(b.page.description),$("#headHtml").val(b.page.headHtml),$("#dependencies").val(b.pageRequest.dependencies),$("#contentType").val(b.page.contentType),b.page.cached?$("#dependenciesDiv").show():$("#dependenciesDiv").hide(),b.page.id!=null?($(".contentTab").show(),$(".childrenTab").show(),$(".commentsTab").show(),$(".securityTab").show(),$("#pagePreview").show(),$("#versions").show(),$("#tagsDiv").show()):($(".contentTab").hide(),$(".childrenTab").hide(),$(".commentsTab").hide(),$(".securityTab").hide(),$("#pagePreview").hide(),$("#versions").hide(),$("#tagsDiv").hide()),h(),q()}function m(){return Vosao.strip($("#publishDate").val())+" "+Vosao.strip($("#publishTime").val())+":00"}function n(){return $("#endPublishDate").val()?Vosao.strip($("#endPublishDate").val())+" "+Vosao.strip($("#endPublishTime").val())+":00":""}function o(){var a=Vosao.javaMap({id:b.pageId,titles:x(),friendlyUrl:$("#parentFriendlyUrl").text()+$("#friendlyUrl").val(),publishDate:m(),endPublishDate:n(),commentsEnabled:String($("#commentsEnabled:checked").size()>0),searchable:String($("#searchable:checked").size()>0),velocityProcessing:String($("#velocityProcessing:checked").size()>0),wikiProcessing:String($("#wikiProcessing:checked").size()>0),enableCkeditor:String($("#enableCkeditor:checked").size()>0),skipPostProcessing:String($("#skipPostProcessing:checked").size()>0),cached:String($("#cached:checked").size()>0),restful:String($("#restful:checked").size()>0),template:$("#templates option:selected").val(),approve:String($("#approveOnPageSave:checked, #approveOnContentSave:checked").size()>0),pageType:$("#pageType").val(),structureId:$("#structure").val(),structureTemplateId:$("#structureTemplate").val(),keywords:$("#keywords").val(),description:$("#description").val(),dependencies:$("#dependencies").val(),contentType:$("#contentType").val(),headHtml:$("#headHtml").val()});$.cookie("page_template",a.map.template,{path:"/",expires:10}),Vosao.jsonrpc.pageService.savePage(function(a){a.result=="success"?(b.editMode&&(location.href="#pages"),b.pageId=a.message,Vosao.info(messages("page.success_save")),location.href="#page/content/"+b.pageId):Vosao.showServiceMessages(a)},a)}function p(){if(b.editMode)return;var a=$("#friendlyUrl").val(),c=$("#title").val();a==""&&$("#friendlyUrl").val(Vosao.urlFromTitle(c))}function q(){$("#pageType").val()=="SIMPLE"&&$("#structuredControls").hide(),$("#pageType").val()=="STRUCTURED"&&($("#structuredControls").show(),b.page!=null&&$("#structure").val(b.page.structureId),w())}function r(){var a=b.page.friendlyURL+"?language="+b.currentLanguage+"&version="+b.page.version;window.open(a,"preview")}function s(){location.href="#pages"}function t(){Vosao.jsonrpc.pageService.approve(function(a){Vosao.showServiceMessages(a),i()},b.pageId)}function u(){var a=b.pageRequest.pagePermission;a.publishGranted?($("#approveButton").show(),$("#approveOnPageSaveDiv").show()):($("#approveButton").hide(),$("#approveOnPageSaveDiv").hide()),a.changeGranted?$("#pageSaveButton").show():$("#pageSaveButton").hide(),a.admin&&b.editMode?$(".securityTab").show():$(".securityTab").hide(),h()}function v(){var a="";$.each(b.pageRequest.structures.list,function(b,c){var d=b==0?'selected="selected"':"";a+="<option "+d+' value="'+c.id+'">'+c.title+"</option>"}),$("#structure").html(a)}function w(){var a=$("#structure").val(),c="";Vosao.jsonrpc.structureTemplateService.selectByStructure(function(a){var c="";$.each(a.list,function(a,b){var d=a==0?'selected="selected"':"";c+="<option "+d+' value="'+b.id+'">'+b.title+"</option>"}),$("#structureTemplate").html(c),b.page!=null&&$("#structureTemplate").val(b.page.structureTemplateId)},a)}function x(){if(!b.editMode)return'{en:"'+$("#title").val()+'"}'}function y(){var a=b.pageRequest.languages;languages={};var c="";$.each(a.list,function(a,b){languages[b.code]=b})}function z(){if(b.editMode){var a=b.pageRequest.contents,c={};b.pageRequest.pagePermission.allLanguages?c=languages:$.each(b.pageRequest.pagePermission.languagesList.list,function(a,b){c[b]=languages[b]}),c[Vosao.ENGLISH_CODE]!=undefined?b.currentLanguage=Vosao.ENGLISH_CODE:b.currentLanguage=a.list[0].languageCode}}function A(){Vosao.jsonrpc.tagService.getTree(function(a){$("#tagTree").html(B(a.list)),$("#tagTree li > a").click(function(){var a=$(this).attr("data-id");a&&D(a)}),$("#tagTree").treeview({animated:"fast",collapsed:!0,unique:!0,persist:"cookie",cookieId:"tagTree"}),$("#tag-dialog").dialog("open")})}function B(a){var b="";return $.each(a,function(a,c){b+=C(c)}),b}function C(a){var b='<li><a data-id="'+a.entity.id+'">'+a.entity.name+"</a>";return a.children.list.length>0&&(b+="<ul>",$.each(a.children.list,function(a,c){b+=C(c)}),b+="</ul>"),b+"</li>"}function D(a){Vosao.jsonrpc.tagService.addTag(function(a){Vosao.showServiceMessages(a),$("#tag-dialog").dialog("close"),E()},b.page.friendlyURL,a)}function E(){Vosao.jsonrpc.pageService.getPageTags(function(a){b.pageRequest.tags=a,F()},b.page.friendlyURL)}function F(){var a="";$.each(b.pageRequest.tags.list,function(b,c){a+='<span class="tag">'+c.name+' <a data-id="'+c.id+'"><img src="/static/images/02_x.png"/></a></span>'}),$("#tags").html(a),$("#tags .tag > a").click(function(){var a=$(this).attr("data-id");a&&G(a)})}function G(a){Vosao.jsonrpc.tagService.removeTag(function(a){Vosao.showServiceMessages(a),E()},b.page.friendlyURL,a)}console.log("Loading IndexView.js");var e=null;return Backbone.View.extend({css:"/static/css/jquery.treeview.css",el:$("#tab-1"),tmpl:_.template(a),render:function(){Vosao.addCSSFile(this.css),this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),f()},remove:function(){$("#tag-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/page/children.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="children"> </div>\r\n<div class="buttons">\r\n    <input id="addChildButton" type="button" value="<%= messages("add_child_page") %>" />\r\n    <input id="deleteChildButton" type="button" value="<%= messages("delete_pages") %>" />\r\n    <input id="defaultSettingsButton" type="button" value="<%= messages("default_settings") %>" />\r\n</div>    \r\n\r\n<div id="page-dialog" style="display:none" title="<%= messages("pages.new_page") %>">\r\n  <form id="pageForm">\r\n    <div class="form-row">\r\n        <label><%= messages("pages.page_title") %></label>\r\n        <input id="title"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("pages.page_url") %></label>\r\n        <span id="parentURL"></span> <input id="url"/>\r\n    </div>\r\n    <div id="pageMessages"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n'}),define("view/page/ChildrenView",["text!template/page/children.html","view/page/context","view/page/version","view/page/breadcrumbs"],function(a,b,c,d){function g(){b.loadData=h,$("#page-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(h),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),c.initVersionDialog(),$("#addChildButton").click(m),$("#deleteChildButton").click(n),$("#defaultSettingsButton").click(s),$("ul.ui-tabs-nav li:nth-child(3)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#cancelDlgButton").click(t),$("#pageForm").submit(function(){return w(),!1}),$("#title").change(u)}function h(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,j(),d.breadcrumbsShow()},b.pageId,b.pageParentUrl)}function i(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,b.editMode=b.pageId!=null,j()},b.pageId,b.pageParentUrl)}function j(){b.editMode?(pageId=String(b.page.id),pageParentUrl=b.page.parentUrl,l(),c.loadVersions(),c.showAuditInfo()):pages[1]=b.page,o()}function k(){Vosao.jsonrpc.pageService.getChildren(function(a){b.pageRequest.children=a,l()},b.page.friendlyURL)}function l(){f=b.pageRequest.children.list;var a='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th><th>"+messages("page.friendly_url")+"</th><th></th></tr>";$.each(f,function(b,c){a+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td><a href="#page/content/'+c.id+'">'+c.title+"</a></td><td>"+c.friendlyURL+'</td>\t\t\t<td><a class="pageup" data-n="'+b+'"><img src="/static/images/02_up.png"/></a>\t        <a class="pagedown" data-n="'+b+'"><img src="/static/images/02_down.png"/></a>\t        </td></tr>'}),$("#children").html(a+"</table>"),$("#children tr:even").addClass("even"),$("a.pageup").click(function(){p(Number($(this).attr("data-n")))}),$("a.pagedown").click(function(){q(Number($(this).attr("data-n")))})}function m(){$("#ui-dialog-title-page-dialog").text(messages("pages.new_page")),e=b.page.friendlyURL=="/"?"":b.page.friendlyURL,$("#page-dialog").dialog("open"),$("#parentURL").html(e+"/"),$("#title").val(""),$("#url").val(""),$("#title").focus()}function n(){var a=[];$("#children input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.pageService.deletePages(function(a){Vosao.showServiceMessages(a),k()},Vosao.javaList(a))}function o(){var a=b.pageRequest.pagePermission;a.changeGranted?($("#addChildButton").show(),$("#deleteChildButton").show()):($("#addChildButton").hide(),$("#deleteChildButton").hide()),a.admin&&b.editMode?$(".securityTab").show():$(".securityTab").hide()}function p(a){a-1>=0&&(Vosao.jsonrpc.pageService.moveUp(function(a){},f[a].id),f[a].sortIndex--,f[a-1].sortIndex++,r(a,a-1),k())}function q(a){a+1<f.length&&(Vosao.jsonrpc.pageService.moveDown(function(a){},f[a].id),f[a+1].sortIndex--,f[a].sortIndex++,r(a,a+1),k())}function r(a,b){var c=f[b];f[b]=f[a],f[a]=c}function s(){Vosao.jsonrpc.pageService.getPageDefaultSettings(function(a){location.href="#page/"+a.id},b.page.friendlyURL)}function t(){$("#page-dialog").dialog("close")}function u(){var a=$("#url").val(),b=$("#title").val();a==""&&$("#url").val(Vosao.urlFromTitle(b))}function v(a){if(a.title=="")return messages("title_is_empty");if(a.title.indexOf(",")!=-1)return messages("pages.coma_not_allowed");if(a.url=="")return messages("pages.url_is_empty");if(a.url.indexOf("/")!=-1)return messages("pages.slash_not_allowed")}function w(){var a={id:"",title:$("#title").val(),url:$("#url").val(),friendlyUrl:e+"/"+$("#url").val()},b=v(a);b?x(b):Vosao.jsonrpc.pageService.savePage(function(a){a.result=="success"?(Vosao.info(messages("pages.success_created")),$("#page-dialog").dialog("close"),location.href="#page/content/"+a.message):x(a.message)},Vosao.javaMap(a))}function x(a){Vosao.errorMessage("#pageMessages",a)}console.log("Loading ChildrenView.js");var e=null,f=null;return Backbone.View.extend({css:"/static/css/children.css",el:$("#tab-1"),tmpl:_.template(a),render:function(){Vosao.addCSSFile(this.css),this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),g()},remove:function(){$("#page-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/page/comments.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="comments"> </div>\r\n<div class="buttons">\r\n    <input id="enableCommentsButton" type="button" \r\n        value="<%= messages("enable_comments") %>" />\r\n    <input id="disableCommentsButton" type="button" \r\n        value="<%= messages("disable_comments") %>" />\r\n    <input id="deleteCommentsButton" type="button" \r\n        value="<%= messages("delete_comments") %>" />\r\n</div>    \r\n'}),define("view/page/CommentsView",["text!template/page/comments.html","view/page/context","view/page/version","view/page/breadcrumbs"],function(a,b,c,d){function e(){b.loadData=f,b.editMode=b.pageId!="",Vosao.initJSONRpc(f),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),c.initVersionDialog(),$("#enableCommentsButton").click(j),$("#disableCommentsButton").click(k),$("#deleteCommentsButton").click(l),$("ul.ui-tabs-nav li:nth-child(4)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function f(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,h(),d.breadcrumbsShow()},b.pageId,b.pageParentUrl)}function g(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,b.editMode=b.pageId!=null,h()},b.pageId,b.pageParentUrl)}function h(){b.editMode?(b.pageId=String(b.page.id),b.pageParentUrl=b.page.parentUrl,c.loadVersions(),i(),c.showAuditInfo()):b.pages[1]=b.page,m()}function i(){var a=b.pageRequest.comments,c='<table class="form-table"><tr><th></th><th>'+messages("state")+"</th><th>"+messages("name")+"</th><th>"+messages("content")+"</th></tr>";$.each(a.list,function(a,b){var d=b.disabled?messages("disabled"):messages("enabled");c+='<tr><td><input type="checkbox" value="'+b.id+'"/></td><td>'+d+"</a></td><td>"+b.name+"</td><td>"+b.content+"</td></tr>"}),$("#comments").html(c+"</table>"),$("#comments tr:even").addClass("even")}function j(){var a=[];$("#comments input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}Vosao.jsonrpc.commentService.enableComments(function(a){Vosao.showServiceMessages(a),f()},Vosao.javaList(a))}function k(){var a=[];$("#comments input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}Vosao.jsonrpc.commentService.disableComments(function(a){Vosao.showServiceMessages(a),f()},Vosao.javaList(a))}function l(){var a=[];$("#comments input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.commentService.deleteComments(function(a){Vosao.showServiceMessages(a),f()},Vosao.javaList(a))}function m(){var a=b.pageRequest.pagePermission;a.changeGranted?($("#enableCommentsButton").show(),$("#disableCommentsButton").show(),$("#deleteCommentsButton").show()):($("#enableCommentsButton").hide(),$("#disableCommentsButton").hide(),$("#deleteCommentsButton").hide()),a.admin&&b.editMode?$(".securityTab").show():$(".securityTab").hide()}return console.log("Loading CommentsView.js"),Backbone.View.extend({el:$("#tab-1"),tmpl:_.template(a),render:function(){this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),e()},remove:function(){this.el.html("")}})}),define("text!template/page/security.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n  \r\n<div id="permissions"> </div>\r\n<div class="buttons">\r\n    <input id="addPermissionButton" type="button" \r\n        value="<%= messages("add_permission") %>" />\r\n    <input id="deletePermissionButton" type="button" \r\n        value="<%= messages("delete_permission") %>" />\r\n</div>    \r\n\r\n<div id="permission-dialog" style="display:none" title="<%= messages("permission_details") %>">\r\n  <form id="permissionForm">\r\n    <div class="form-row">\r\n        <label><%= messages("group") %></label>\r\n        <select id="groupSelect"></select>\r\n        <span id="groupName"></span>        \r\n    </div>\r\n    <div id="permissionList" class="form-row">\r\n        <fieldset>\r\n            <legend><%= messages("permission") %></legend>\r\n            <input type="radio" name="permission" value="DENIED"/> <%= messages("denied") %> <br />\r\n            <input type="radio" name="permission" value="READ" /> <%= messages("read") %> <br />\r\n            <input type="radio" name="permission" value="WRITE" /> <%= messages("read_write") %> <br />\r\n            <input type="radio" name="permission" value="PUBLISH" /> <%= messages("read_write_publish") %> <br />\r\n            <input type="radio" name="permission" value="ADMIN" /> <%= messages("read_write_publish_grant") %> <br />\r\n        </fieldset>        \r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("page.all_languages") %></label>\r\n        <input id="allLanguages" type="checkbox" checked="checked" />\r\n    </div>    \r\n    <div id ="permLanguages" class="form-row" style="display:none"> </div>\r\n    <div class="buttons-dlg">\r\n        <input id="permissionSaveButton" type="submit" \r\n            value="<%= messages("save") %>" />\r\n        <input id="permissionCancelButton" type="button" \r\n            value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n'}),define("view/page/SecurityView",["text!template/page/security.html","view/page/context","view/page/version","view/page/breadcrumbs"],function(a,b,c,d){function i(){b.loadData=j,b.editMode=b.pageId!="",Vosao.initJSONRpc(j),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),c.initVersionDialog(),$("#permission-dialog").dialog({width:400,autoOpen:!1}),$("#addPermissionButton").click(v),$("#deletePermissionButton").click(w),$("#permissionForm").submit(function(){return u(),!1}),$("#permissionCancelButton").click(x),$("#allLanguages").change(y),$("ul.ui-tabs-nav li:nth-child(5)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function j(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,m(),l(),d.breadcrumbsShow()},b.pageId,b.pageParentUrl)}function k(){Vosao.jsonrpc.pageService.getPageRequest(function(a){b.pageRequest=a,b.page=b.pageRequest.page,b.editMode=b.pageId!=null,l()},b.pageId,b.pageParentUrl)}function l(){b.editMode?(b.pageId=String(b.page.id),b.pageParentUrl=b.page.parentUrl,c.loadVersions(),p(),q()):b.pages[1]=b.page,z()}function m(){var a=b.pageRequest.languages;h={};var c="";$.each(a.list,function(a,b){h[b.code]=b}),r()}function n(a){if(a=="DENIED")return messages("denied");if(a=="READ")return messages("read");if(a=="WRITE")return messages("read_write");if(a=="PUBLISH")return messages("read_write_publish");if(a=="ADMIN")return messages("read_write_publish_grant")}function o(){Vosao.jsonrpc.contentPermissionService.selectByUrl(function(a){b.pageRequest.permissions=a,p()},b.page.friendlyURL)}function p(){var a=b.pageRequest.permissions;f=Vosao.idMap(a.list);var c='<table class="form-table"><tr><th></th><th>'+messages("group")+"</th><th>"+messages("permission")+"</th><th>"+messages("languages")+"</th></tr>";$.each(f,function(a,b){var d="",e=b.group.name;b.inherited||(d='<input type="checkbox" value="'+b.id+'">',e='<a data-id="'+b.id+'"> '+b.group.name+"</a>");var f=b.allLanguages?messages("page.all_languages"):b.languages;c+="<tr><td>"+d+"</td><td>"+e+"</td><td>"+n(b.permission)+"</td><td>"+f+"</td></tr>"}),$("#permissions").html(c+"</table>"),$("#permissions tr:even").addClass("even"),$("#permissions a").click(function(){var a=$(this).attr("data-id");a&&s(a)})}function q(){var a=b.pageRequest.groups;g=Vosao.idMap(a.list);var c="";$.each(g,function(a,b){c+='<option value="'+b.id+'">'+b.name+"</option>"}),$("#groupSelect").html(c)}function r(){var a="<fieldset><legend>"+messages("languages")+"</legend>";$.each(h,function(b,c){a+='<input type="checkbox" value="'+c.code+'" /> '+c.title+"<br />"}),$("#permLanguages").html(a+"</fieldset>")}function s(a){e=f[a],t(),$("#permission-dialog").dialog("open")}function t(){$("#permission-dialog input[type=radio]").removeAttr("checked"),$("#allLanguages").attr("checked","checked"),$("#permLanguages").hide();if(e==null)$("#permission-dialog input[value=READ]").attr("checked","checked"),$("#groupSelect").show(),$("#groupName").hide();else{$("#permissionList input[value="+e.permission+"]").attr("checked","checked"),$("#groupSelect").hide(),$("#groupName").show(),$("#groupName").text(e.group.name);if(!e.allLanguages){$("#allLanguages").removeAttr("checked"),$("#permLanguages").show();var a=e.languages.split(",");$("#permLanguages input").removeAttr("checked"),$.each(a,function(a,b){$("#permLanguages input[value="+b+"]").attr("checked","checked")})}}}function u(){var a="";$("#permLanguages input:checked").each(function(){a+=(a==""?"":",")+this.value});var c={url:b.page.friendlyURL,groupId:e==null?$("#groupSelect").val():String(e.group.id),permission:$("#permissionList input:checked")[0].value,languages:$("#allLanguages")[0].checked?"":a};Vosao.jsonrpc.contentPermissionService.save(function(a){Vosao.showServiceMessages(a),$("#permission-dialog").dialog("close"),a.result=="success"&&o()},Vosao.javaMap(c))}function v(){e=null,t(),$("#permission-dialog").dialog("open")}function w(){var a=[];$("#permissions input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.contentPermissionService.remove(function(a){Vosao.showServiceMessages(a),o()},Vosao.javaList(a))}function x(){$("#permission-dialog").dialog("close")}function y(){this.checked?$("#permLanguages").hide():$("#permLanguages").show()}function z(){var a=b.pageRequest.pagePermission;a.admin&&b.editMode?$(".securityTab").show():$(".securityTab").hide()}console.log("Loading SecurityView.js");var e=null,f=null,g=null,h={};return Backbone.View.extend({el:$("#tab-1"),tmpl:_.template(a),render:function(){this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),i()},remove:function(){$("#permission-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/page/attributes.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="attributes"> </div>\r\n<div class="buttons">\r\n    <input id="addButton" type="button" \r\n        value="<%= messages("add_attribute") %>" />\r\n    <input id="deleteButton" type="button" \r\n        value="<%= messages("delete_attribute") %>" />\r\n</div>    \r\n\r\n<div id="attribute-dialog" style="display:none" title="<%= messages("attribute") %>">\r\n  <form id="attributeForm">\r\n    <div class="form-row">\r\n        <label><%= messages("name") %></label>\r\n        <input id="name" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("title") %></label>\r\n        <input id="title" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("default_value") %></label>\r\n        <input id="defaultValue" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("inherited") %></label>\r\n        <input type="checkbox" id="inherited" />\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<div id="attrValue-dialog" style="display:none" title="<%= messages("attribute") %>">\r\n  <form id="attrValueForm">\r\n    <div class="form-row">\r\n        <label><%= messages("name") %></label>\r\n        <span id="attrName" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("language") %></label>\r\n        <select id="language"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("value") %></label>\r\n        <input id="value" type="text"/>\r\n    </div>\r\n    <div id="applyChildren" class="form-row">\r\n        <label><%= messages("page.apply_children") %></label>\r\n        <input type="checkbox" id="attrInherited" />\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveValueButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelValueButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>'}),define("view/page/AttributesView",["text!template/page/attributes.html","view/page/context","view/page/version","view/page/breadcrumbs"],function(attributesHtml,ctx,version,breadcrumbs){function postRender(){ctx.loadData=loadData,ctx.editMode=ctx.pageId!="",$("#attribute-dialog").dialog({width:430,autoOpen:!1}),$("#attrValue-dialog").dialog({width:430,autoOpen:!1}),Vosao.initJSONRpc(loadData),$("a.button").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}),version.initVersionDialog(),$("#addButton").click(onAdd),$("#cancelButton").click(function(){$("#attribute-dialog").dialog("close")}),$("#cancelValueButton").click(function(){$("#attrValue-dialog").dialog("close")}),$("#attributeForm").submit(function(){return onSave(),!1}),$("#attrValueForm").submit(function(){return onSaveValue(),!1}),$("#deleteButton").click(onDelete),$("#language").change(onLanguageChange),$("ul.ui-tabs-nav li:nth-child(7)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function loadData(){Vosao.jsonrpc.pageService.getPageRequest(function(a){ctx.pageRequest=a,ctx.page=ctx.pageRequest.page,loadPage(),breadcrumbs.breadcrumbsShow()},ctx.pageId,ctx.pageParentUrl)}function callLoadPage(){Vosao.jsonrpc.pageService.getPageRequest(function(a){ctx.pageRequest=a,ctx.page=ctx.pageRequest.page,ctx.editMode=ctx.pageId!=null,loadPage()},ctx.pageId,ctx.pageParentUrl)}function loadPage(){ctx.editMode?(ctx.pageId=String(ctx.page.id),ctx.pageParentUrl=ctx.page.parentUrl,version.loadVersions(),loadLanguages(),version.showAuditInfo(),attrValues=ctx.page.attributes?eval("("+ctx.page.attributes+")"):{},loadAttributes()):ctx.pages[1]=ctx.page,loadPagePermission()}function loadLanguages(){var a=ctx.pageRequest.languages;languages={};var b="";$.each(a.list,function(a,c){languages[c.code]=c,b+='<option value="'+c.code+'" '+">"+c.title+"</option>"}),$("#language").html(b),$("#language").val(Vosao.ENGLISH_CODE)}function loadPagePermission(){var a=ctx.pageRequest.pagePermission;a.changeGranted?($("#enableCommentsButton").show(),$("#disableCommentsButton").show(),$("#deleteCommentsButton").show()):($("#enableCommentsButton").hide(),$("#disableCommentsButton").hide(),$("#deleteCommentsButton").hide()),a.admin&&ctx.editMode?$(".securityTab").show():$(".securityTab").hide()}function loadAttributes(){Vosao.jsonrpc.pageAttributeService.getByPage(function(a){attributes=a.list,showAttributes()},ctx.page.friendlyURL)}function showAttributes(){var a='<table class="form-table"><tr><th></th><th>'+messages("name")+"</th><th>"+messages("value")+"</th><th>"+messages("inherited")+"</th></tr>";$.each(attributes,function(b,c){attributesMap[c.name]=c;var d=c.inherited?messages("inherited"):"";a+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td><a data-name="'+c.name+'">'+c.name+"</a></td><td>"+getAttributeValue(c.name,Vosao.ENGLISH_CODE)+"</td><td>"+d+"</td></tr>"}),$("#attributes").html(a+"</table>"),$("#attributes tr:even").addClass("even"),$("#attributes a").click(function(){var a=$(this).attr("data-name");a&&onEditValue(a)})}function onAdd(){$("#name").val(""),$("#title").val(""),$("#defaultValue").val(""),$("#inherited").each(function(){this.checked=!1}),$("#attribute-dialog").dialog("open")}function onDelete(){var a=[];$("#attributes input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.pageAttributeService.remove(function(a){Vosao.showServiceMessages(a),loadData()},Vosao.javaList(a),ctx.page.id)}function onSave(){var a={id:attrDef==null?"":String(attrDef.id),url:ctx.page.friendlyURL,name:$("#name").val(),title:$("#title").val(),inherited:String($("#inherited:checked").size()>0),defaultValue:$("#defaultValue").val()};Vosao.jsonrpc.pageAttributeService.save(function(b){b.result=="success"?(Vosao.info(messages("page.success_save")),$("#attribute-dialog").dialog("close"),loadData(),a.inherited=$("#inherited:checked").size()>0,attributesMap[a.name]=a,a.inherited&&a.defaultValue?loadData():onEditValue(a.name)):Vosao.showServiceMessages(b)},Vosao.javaMap(a))}function getAttributeValue(a,b){return attrValues[a]&&attrValues[a][b]?attrValues[a][b]:""}function onEditValue(a){$("#attrValue-dialog").dialog("open"),$("#attrName").html(a),$("#attrInherited").each(function(){this.checked=!1}),attributesMap[a].inherited?$("#applyChildren").show():$("#applyChildren").hide();var b=getAttributeValue(a,$("#language").val());!b&&attributesMap[a].defaultValue&&confirm(messages("page.use_default_value"))&&(b=attributesMap[a].defaultValue),$("#value").val(b),$("#language").val(Vosao.ENGLISH_CODE)}function checkPageAttrValue(a,b){attrValues[a]==undefined&&(attrValues[a]={}),attrValues[a][b]==undefined&&(attrValues[a][b]="")}function setPageAttrValue(a,b,c){checkPageAttrValue(a,b),attrValues[a][b]=c}function getPageAttrValue(a,b){return checkPageAttrValue(a,b),attrValues[a][b]}function onLanguageChange(){var a=$("#attrName").text(),b=$("#language").val(),c=getPageAttrValue(a,b);!c&&attributesMap[a].defaultValue&&confirm(messages("page.use_default_value"))&&(c=attributesMap[a].defaultValue),$("#value").val(c)}function onSaveValue(){var a=$("#attrName").text(),b=$("#language").val(),c=$("#value").val();setPageAttrValue(a,b,c),Vosao.jsonrpc.pageService.saveAttribute(function(a){a.result=="success"?($("#attrValue-dialog").dialog("close"),Vosao.info(messages("success")),loadData()):Vosao.showServiceMessages(a)},ctx.page.id,a,c,b,$("#attrInherited:checked").size()>0)}console.log("Loading AttributesView.js");var attrDef=null,attributes=null,attributesMap={},attrValues={},languages=null;return Backbone.View.extend({el:$("#tab-1"),tmpl:_.template(attributesHtml),render:function(){this.el=$("#tab-1"),this.el.html(this.tmpl({messages:messages})),postRender()},remove:function(){$("#attribute-dialog, #attrValue-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("view/page/PageRouter",["view/page/context","view/page/ContentView","view/page/IndexView","view/page/ChildrenView","view/page/CommentsView","view/page/SecurityView","view/page/AttributesView"],function(a,b,c,d,e,f,g){return console.log("Loading PageRouter.js"),Backbone.Router.extend({pageView:null,currentView:null,contentView:new b,indexView:new c,childrenView:new d,commentsView:new e,securityView:new f,attributesView:new g,initialize:function(a){this.pageView=a.view},show:function(a){Vosao.app.currentView!=this.pageView&&Vosao.app.show(this.pageView),this.currentView&&(this.currentView.remove(),this.currentView=null),$("ul.ui-tabs-nav li").removeClass("ui-state-active").removeClass("ui-tabs-selected").addClass("ui-state-default"),a.render(),this.currentView=a},routes:{"page/children/:id":"children","page/comments/:id":"comments","page/security/:id":"security","page/attributes/:id":"attributes","page/resources/:id":"resources"},showCmd:function(b){b=="editContent"&&this.editContent(a.pageId),b=="editPage"&&this.editPage(a.pageId)},editContent:function(b){a.pageId=b,this.show(this.contentView)},editPage:function(b){a.pageId=b,this.show(this.indexView)},children:function(b){a.pageId=b,this.show(this.childrenView)},comments:function(b){a.pageId=b,this.show(this.commentsView)},security:function(b){a.pageId=b,this.show(this.securityView)},attributes:function(b){a.pageId=b,this.show(this.attributesView)},resources:function(b){Vosao.jsonrpc.pageService.getPageRequest(function(c){a.pageRequest=c,a.pageId=b,a.page=a.pageRequest.page,Vosao.jsonrpc.folderService.createFolderByPath(function(b){jQuery.cookie("folderReturnPath","#page/content/"+a.pageId,{path:"/",expires:10}),location.href="#folder/"+b.id},"/page"+a.page.friendlyURL)},b,"")}})}),define("view/page/PageView",["text!template/page/page.html","view/page/PageRouter","view/page/context"],function(a,b,c){return console.log("Loading PageView.js"),Backbone.View.extend({css:"/static/css/page.css",el:$("#content"),tmpl:_.template(a),viewCmd:null,router:null,initialize:function(){this.router=new b({view:this})},render:function(){Vosao.addCSSFile(this.css),this.el.html(this.tmpl({messages:messages,id:c.pageId})),$("#version-dialog").dialog({width:400,autoOpen:!1}),this.router.showCmd(this.viewCmd)},remove:function(){this.router.currentView&&this.router.currentView.remove(),$("#version-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)},editContent:function(a){c.pageId=a,this.viewCmd="editContent"},editPage:function(a){c.pageId=a,this.viewCmd="editPage"},setResource:function(a){this.router.contentView.setResource(a)}})}),define("text!template/profile.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n\r\n    <ul>\r\n        <li><a href="#tab-1"><%= messages("profile.title") %></a></li>\r\n    </ul>\r\n    <div id="tab-1">\r\n\r\n        <div class="form-row">\r\n            <label><%= messages("profile.username") %></label>\r\n            <input id="name" type="text" />\r\n        </div>\r\n\r\n        <div class="form-row">\r\n            <label><%= messages("profile.user_email") %></label>\r\n            <input id="email" type="text" disabled="disabled"/>\r\n        </div>\r\n\r\n        <div class="form-row">\r\n            <label><%= messages("password") %></label>\r\n            <input id="password1" type="password" />\r\n        </div>\r\n        <div class="form-row">\r\n            <label><%= messages("profile.retype_password") %></label>\r\n            <input id="password2" type="password" />\r\n        </div>\r\n\r\n        <div class="form-row">\r\n            <label><%= messages("profile.timezone") %></label>\r\n            <select id="timezone"></select>\r\n        </div>\r\n\r\n        <div class="buttons">\r\n            <input id="saveButton" type="button" value="<%= messages("save") %>" />\r\n        </div>\r\n\r\n    </div>\r\n\r\n</div>\r\n\r\n'}),define("view/ProfileView",["text!template/profile.html"],function(a){function d(){$("#tabs").tabs(),Vosao.initJSONRpc(e),$("#saveButton").click(h)}function e(){Vosao.jsonrpc.userService.getTimezones(function(a){c=a.list,i(),f()})}function f(){Vosao.jsonrpc.userService.getLoggedIn(function(a){b=a,$("#name").val(b.name),$("#email").val(b.email),$("#password1").val(""),$("#password2").val(""),$("#timezone").val(b.timezone)})}function g(){var a=$("#password1").val(),b=$("#password2").val();return a||b?a==b?!0:!1:!0}function h(){var a="";if(g())a=$("#password1").val();else{Vosao.error(messages("profile.password_dont_match"));return}var c={id:String(b.id),name:$("#name").val(),timezone:$("#timezone").val(),password:a};Vosao.jsonrpc.userService.save(function(a){Vosao.showServiceMessages(a)},Vosao.javaMap(c))}function i(){var a="";$.each(c,function(b,c){a+='<option value="'+c+'">'+c+"</option>"}),$("#timezone").html(a)}console.log("Loading ProfileView.js");var b=null,c=null;return Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),d()},remove:function(){this.el.html("")}})}),define("text!template/plugins/index.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="main-panel">\r\n    <div>\r\n        <img src="/static/images/config.png" />\r\n        <a href="#plugins/config"><%= messages("plugins.config") %></a>\r\n        <p><%= messages("plugins.config_info") %></p>\r\n    </div>\r\n    <div>\r\n        <img src="/static/images/form.png" />\r\n        <a href="#plugins/forms"><%= messages("forms") %></a>\r\n        <p><%= messages("plugins.forms_info") %></p>\r\n    </div>\r\n    <div>\r\n        <img src="/static/images/seo_urls.png" />\r\n        <a href="#plugins/seo-urls"><%= messages("plugins.seo_urls") %></a>\r\n        <p><%= messages("plugins.seo_urls_info") %></p>\r\n    </div>\r\n</div>\r\n\r\n'}),define("view/plugins/PluginsView",["text!template/plugins/index.html"],function(a){return console.log("Loading PluginsView.js"),Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages}))},remove:function(){this.el.html("")}})}),define("text!template/plugins/config.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("plugins") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n    <div id="plugins"></div>\r\n    <div class="buttons">\r\n        <input id="installButton" type="button" value="<%= messages("install_update") %>" />\r\n    </div>\r\n</div>\r\n\r\n</div>\r\n\r\n<div id="import-dialog" title="<%= messages("install") %>" style="display:none">\r\n<form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\r\n    <%= messages("file_upload") %>:\r\n    <input type="hidden" name="fileType" value="plugin" />\r\n    <input type="file" name="uploadFile" />\r\n    <div class="buttons-dlg">\r\n        <input type="submit" value="<%= messages("send") %>" />\r\n        <input id="importCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>    \r\n</form>\r\n</div>\r\n\r\n<div id="afterUpload-dialog" style="display:none" title="<%= messages("status_window") %>">\r\n    <p class="message"></p>\r\n    <div class="buttons-dlg">\r\n        <input id="okButton" type="button" value="OK" />\r\n    </div>\r\n</div>\r\n\r\n'}),define("view/plugins/ConfigView",["text!template/plugins/config.html","jquery.form"],function(a){function c(){$("#tabs").tabs(),$("#import-dialog").dialog({width:400,autoOpen:!1}),$("#afterUpload-dialog").dialog({autoOpen:!1}),Vosao.initJSONRpc(d),$("#upload").ajaxForm(i),$("#installButton").click(g),$("#importCancelButton").click(h),$("#okButton").click(j)}function d(){e()}function e(){Vosao.jsonrpc.pluginService.select(function(a){b=a.list,f()})}function f(){var a='<table class="form-table"><th>'+messages("title")+"</th>\t       <th>"+messages("name")+"</th><th>"+messages("version")+"</th><th>"+messages("description")+"</th><th>"+messages("website")+"</th><th>"+messages("state")+"</th><th></th></tr>";$.each(b,function(b,c){var d="#plugin/"+c.id;c.configURL&&(d="/file/plugins/"+c.name+"/"+c.configURL);var e=c.disabled?messages("disabled"):messages("enabled"),f=c.disabled?Vosao.message(c.title):'<a href="'+d+'">'+Vosao.message(c.title)+"</a>";a+="<tr><td>"+f+"</td>"+"<td>"+c.name+"</td>"+"<td>"+c.version+"</td>"+"<td>"+Vosao.message(c.description)+"</td>"+"<td>"+c.website+"</td>"+"<td>"+e+"</td>"+'<td><a title="Uninstall" class="removeLink" data-index="'+b+')">\t            <img src="/static/images/02_x.png"/></a></td></tr>'}),$("#plugins").html(a+"</table>"),$("#plugins tr:even").addClass("even"),$("#plugins .removeLink").click(function(){k(Number($(this).attr("data-index")))})}function g(){$("#import-dialog").dialog("open")}function h(){$("#import-dialog").dialog("close")}function i(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?d=messages("plugins.success_install"):d=messages("error")+". "+d,$("#import-dialog").dialog("close"),$("#afterUpload-dialog .message").text(d),$("#afterUpload-dialog").dialog("open")}function j(){$("#afterUpload-dialog").dialog("close"),d()}function k(a){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.pluginService.remove(function(c){Vosao.showServiceMessages(c),c.result=="success"&&(b.splice(a,1),f())},b[a].id)}console.log("Loading ConfigView.js");var b="";return Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),c()},remove:function(){$("#import-dialog, #afterUpload-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/plugins/forms.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("forms") %></a></li>\r\n    <li><a href="#tab-2"><%= messages("config") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n    <div id="forms"> </div>\r\n    <div class="buttons">\r\n        <input id="addButton" type="button" value="<%= messages("add") %>" />\r\n        <input id="deleteButton" type="button" value="<%= messages("delete") %>" />\r\n    </div>\r\n</div>\r\n\r\n<div id="tab-2">\r\n\r\n<div class="form-row">\r\n    <label><%= messages("forms.form_template") %></label>\r\n    <div>\r\n        <a id="editFormTemplateLink" ><%= messages("edit") %></a> \r\n        <a id="restoreFormTemplateLink" ><%= messages("restore_default") %></a>\r\n    </div>\r\n    <div>\r\n        <textarea id="formTemplate" rows="20" cols="80" \r\n            style="display:none"></textarea>\r\n    </div>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("forms.letter_template") %></label>\r\n    <div>\r\n        <a id="editFormLetterLink" ><%= messages("edit") %></a> \r\n        <a id="restoreFormLetterLink" ><%= messages("restore_default") %></a>\r\n    </div>\r\n    <div>\r\n        <textarea id="letterTemplate" rows="20" cols="80" \r\n            style="display:none"></textarea>\r\n    </div>\r\n</div>\r\n<div class="buttons">\r\n    <input id="saveButton" type="button" value="<%= messages("save") %>" />\r\n</div>\r\n</div>\r\n\r\n</div>\r\n\r\n'}),define("view/plugins/FormsView",["text!template/plugins/forms.html"],function(a){function c(){$("#tabs").tabs(),Vosao.initJSONRpc(d),$("#addButton").click(f),$("#deleteButton").click(g),$("#editFormTemplateLink").click(function(){$("#formTemplate").toggle()}),$("#restoreFormTemplateLink").click(j),$("#editFormLetterLink").click(function(){$("#letterTemplate").toggle()}),$("#restoreFormLetterLink").click(k),$("#saveButton").click(i)}function d(){e(),h()}function e(){Vosao.jsonrpc.formService.select(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th><th>"+messages("name")+"</th><th>"+messages("email")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td><a href="#plugins/form/'+c.id+'">'+c.title+"</a></td><td>"+c.name+"</td><td>"+c.email+"</td></tr>"}),$("#forms").html(b+"</table>"),$("#forms tr:even").addClass("even")})}function f(){location.href="#plugins/form"}function g(){var a=[];$("#forms input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.formService.deleteForm(function(a){Vosao.showServiceMessages(a),e()},Vosao.javaList(a))}function h(){Vosao.jsonrpc.formService.getFormConfig(function(a){b=a,$("#formTemplate").val(a.formTemplate),$("#letterTemplate").val(a.letterTemplate)})}function i(){var a=Vosao.javaMap({formTemplate:$("#formTemplate").val(),letterTemplate:$("#letterTemplate").val()});Vosao.jsonrpc.formService.saveFormConfig(function(a){Vosao.showServiceMessages(a)},a)}function j(){Vosao.jsonrpc.formService.restoreFormTemplate(function(a){Vosao.showServiceMessages(a),h()})}function k(){Vosao.jsonrpc.formService.restoreFormLetter(function(a){Vosao.showServiceMessages(a),h()})}console.log("Loading FormsView.js");var b="";return Backbone.View.extend({el:$("#content"),render:function(){this.el.html(_.template(a,{messages:messages})),c()},remove:function(){this.el.html("")}})}),define("text!template/plugins/form.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("form") %></a></li>\r\n    <li class="fieldsTab"><a href="#tab-2"><%= messages("fields") %></a></li>\r\n    <li class="dataTab"><a href="#tab-3"><%= messages("saved_data") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n<form id="form">\r\n<div class="form-row">\r\n    <label><%= messages("title") %></label>\r\n    <input id="title" type="text" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("form.unique_name") %></label>\r\n    <input id="name" type="text" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("form.email") %></label>\r\n    <input id="email" type="text" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("letter_subject") %></label>\r\n    <input id="letterSubject" type="text" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("form.send_title") %></label>\r\n    <input id="sendButtonTitle" type="text"/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("form.reset_title") %></label>\r\n    <input id="resetButtonTitle" type="text"/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("form.show_reset") %></label>\r\n    <input id="showResetButton" type="checkbox"/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("enable_captcha") %></label>\r\n    <input id="enableCaptcha" type="checkbox"/>\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("enable_save") %></label>\r\n    <input id="enableSave" type="checkbox"/>\r\n</div>\r\n\r\n<div class="buttons">\r\n    <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n    <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\r\n</div>\r\n</form>\r\n</div>\r\n\r\n<div id="tab-2" class="fieldsTab">\r\n    <div id="fieldsTable"> </div>\r\n    <div class="buttons">\r\n        <input id="addFieldButton" type="button" value="<%= messages("add_field") %>" />\r\n        <input id="deleteFieldButton" type="button" value="<%= messages("delete_fields") %>" />\r\n    </div>    \r\n</div>\r\n\r\n<div id="tab-3" class="dataTab">\r\n    <div id="dataTable"></div>\r\n    <div class="buttons">\r\n        <input id="deleteDataButton" type="button" value="<%= messages("delete") %>" />\r\n    </div>    \r\n</div>\r\n\r\n</div>\r\n\r\n<div id="field-dialog" style="display:none" title="<%= messages("form.field_details") %>">\r\n<form id="fieldForm">\r\n    <div id="field-messages" class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("title") %></label>\r\n        <input type="text" name="field.title" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("form.unique_name") %></label>\r\n        <input type="text" name="field.name" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("form.field_type") %></label>\r\n        <select id="fieldType" name="field.fieldType">\r\n            <option value="TEXT">Text</option>\r\n            <option value="CHECKBOX">Checkbox</option>\r\n            <option value="RADIO">Radiobox</option>\r\n            <option value="PASSWORD">Password</option>\r\n            <option value="LISTBOX">Listbox</option>\r\n            <option value="FILE">File upload</option>\r\n        </select>\r\n    </div>\r\n    <div class="form-row" id="field-width">\r\n        <label><%= messages("form.width_chars") %></label>\r\n        <input type="text" name="field.width" />\r\n    </div>\r\n    <div class="form-row" id="field-height">\r\n        <label><%= messages("form.height_chars") %></label>\r\n        <input type="text" name="field.height" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("mandatory") %></label>\r\n        <input type="checkbox" name="field.mandatory" />\r\n    </div>\r\n    <div class="form-row" id="field-values">\r\n        <label><%= messages("values") %></label>\r\n        <textarea name="field.values"></textarea>\r\n    </div>\r\n    <div class="form-row" id="field-defaultValue">\r\n        <label><%= messages("default_value") %></label>\r\n        <input type="text" name="field.defaultValue"/>\r\n    </div>\r\n    <div id="regexDiv">\r\n    <div class="form-row" id="field-defaultValue">\r\n        <label><%= messages("form.regex_code") %></label>\r\n        <input type="text" name="field.regex"/>\r\n    </div>\r\n    <div class="form-row" id="field-defaultValue">\r\n        <label><%= messages("form.regex_message") %></label>\r\n        <select id="language"></select> \r\n        <input type="text" name="field.regexMessage"/>\r\n    </div>\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveAndAddButton" type="submit" value="<%= messages("save_add") %>" />\r\n        <input id="fieldSaveButton" type="button" value="<%= messages("save") %>" />\r\n        <input id="fieldCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n</form>\r\n</div>\r\n\r\n<div id="formData-dialog" style="display:none" title="<%= messages("form.form_data") %>">\r\n<form id="formDataForm">\r\n    <div id="formData"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="formDataSendButton" type="button" value="<%= messages("send") %>" />\r\n        <input id="formDataCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n</form>\r\n</div>\r\n'}),define("view/plugins/FormView",["text!template/plugins/form.html"],function(a){function l(){e=b!="",$("#tabs").tabs(),$("#field-dialog").dialog({width:500,autoOpen:!1}),$("#formData-dialog").dialog({width:500,autoOpen:!1}),Vosao.initJSONRpc(m),$("#title").change(J),$("#language").change(Q),$('input[name="field.regexMessage"]').change(P),$("#form").submit(function(){return H(),!1}),$("#cancelButton").click(I),$("#addFieldButton").click(r),$("#deleteFieldButton").click(E),$("#fieldType").change(u),$("#fieldForm").submit(function(){return F(),!1}),$("#fieldSaveButton").click(function(){t(!0)}),$("#fieldCancelButton").click(s),$('input[name="field.title"]').change(K),$("#deleteDataButton").click(V),$("#formDataCancelButton").click(function(){$("#formData-dialog").dialog("close")}),$("#formDataSendButton").click(X)}function m(){G(),o(),n()}function n(){Vosao.jsonrpc.languageService.select(function(a){var b="";$.each(a.list,function(a,c){d[c.code]=c,b+='<option value="'+c.code+'">'+c.title+"</option>"}),$("#language").html(b)})}function o(){if(b=="")return;Vosao.jsonrpc.fieldService.getByForm(function(a,b){g=a.list,p()},b)}function p(){var a='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th><th>"+messages("name")+"</th><th>"+messages("type")+"</th><th></th></tr>";$.each(g,function(b,c){a+='<tr>\t\t\t\t<td><input type="checkbox" name="item'+b+'" value="'+c.id+'"/></td>\t\t\t\t<td><a class="fieldEdit" data-id="'+c.id+'">'+c.title+"</a></td>\t\t\t\t<td>"+c.name+"</td>\t\t\t\t<td>"+q(c.fieldType)+'</td>\t\t\t\t<td><a class="fieldUp" data-index="'+b+'"><img src="/static/images/02_up.png"/></a>\t\t\t\t    <a class="fieldDown" data-index="'+b+'"><img src="/static/images/02_down.png"/></a>\t\t\t\t</td>\t\t\t\t</tr>'}),$("#fieldsTable").html(a+"</table>"),$("#fieldsTable tr:even").addClass("even"),$("#fieldsTable .fieldEdit").click(function(){D($(this).attr("data-id"))}),$("#fieldsTable .fieldUp").click(function(){L($(this).attr("data-index"))}),$("#fieldsTable .fieldDown").click(function(){M($(this).attr("data-index"))})}function q(a){return a=="TEXT"?"Text":a=="CHECKBOX"?"Checkbox":a=="RADIO"?"Radiobox":a=="PASSWORD"?"Password":a=="LISTBOX"?"Listbox":a=="FILE"?"File upload":"undefined"}function r(){f=null,w(),$("#field-dialog").dialog("open")}function s(){$("#field-dialog").dialog("close")}function t(a){var b=x(),c=y(b);c.length==0?Vosao.jsonrpc.fieldService.updateField(function(b,c){b.result=="success"?(a&&$("#field-dialog").dialog("close"),o()):A(b.messages.list)},b):A(c)}function u(){v()}function v(){var a=$('select[name="field.fieldType"]').val();a=="TEXT"&&($("#field-values").hide(),$("#field-height").show(),$("#field-width").show(),$("#field-defaultValue").show(),$("#regexDiv").show()),a=="LISTBOX"&&($("#field-values").show(),$("#field-height").hide(),$("#field-width").hide(),$("#field-defaultValue").hide(),$("#regexDiv").hide()),a=="CHECKBOX"&&($("#field-values").show(),$("#field-height").hide(),$("#field-width").hide(),$("#field-defaultValue").hide(),$("#regexDiv").hide()),a=="RADIO"&&($("#field-values").show(),$("#field-height").hide(),$("#field-width").hide(),$("#field-defaultValue").hide(),$("#regexDiv").hide()),a=="PASSWORD"&&($("#field-values").hide(),$("#field-height").hide(),$("#field-width").show(),$("#field-defaultValue").hide(),$("#regexDiv").hide()),a=="FILE"&&($("#field-values").hide(),$("#field-height").hide(),$("#field-width").hide(),$("#field-defaultValue").hide(),$("#regexDiv").hide())}function w(){f==null?(i={},$('input[name="field.name"]').val(""),$('input[name="field.title"]').val(""),$('select[name="field.fieldType"]').val("TEXT"),$('textarea[name="field.values"]').val(""),$('input[name="field.defaultValue"]').val(""),$('input[name="field.height"]').val("1"),$('input[name="field.width"]').val("20"),$('input[name="field.mandatory"]')[0].checked=!1,$('input[name="field.regex"]').val(""),$('input[name="field.regexMessage"]').val("")):($('input[name="field.name"]').val(f.name),$('input[name="field.title"]').val(f.title),$('select[name="field.fieldType"]').val(f.fieldType),$('textarea[name="field.values"]').val(f.values),$('input[name="field.defaultValue"]').val(f.defaultValue),$('input[name="field.height"]').val(f.height),$('input[name="field.width"]').val(f.width),$('input[name="field.mandatory"]')[0].checked=f.optional,$('input[name="field.regex"]').val(f.regex),$('input[name="field.regexMessage"]').val(O())),v(),C()}function x(){var a=f!=null?f.index:g==null?0:g.length;return Vosao.javaMap({id:f!=null?String(f.id):null,formId:b,name:$('input[name="field.name"]').val(),title:$('input[name="field.title"]').val(),fieldType:$('select[name="field.fieldType"]').val(),values:$('textarea[name="field.values"]').val(),defaultValue:$('input[name="field.defaultValue"]').val(),height:$('input[name="field.height"]').val(),width:$('input[name="field.width"]').val(),index:String(a),regex:$('input[name="field.regex"]').val(),regexMessage:R(),mandatory:String($('input[name="field.mandatory"]:checked').size()>0)})}function y(a){var b=new Array;a.map.name==""&&b.push(messages("name_is_empty")),a.map.title==""&&b.push(messages("title_is_empty"));var c=Number(a.map.height);a.map.fieldType=="TEXT"&&c<=0&&b.push(messages("form.height_zero_error"));var d=Number(a.map.width);return a.map.fieldType=="TEXT"&&d<=0&&b.push(messages("form.width_zero_error")),b}function z(a){Vosao.infoMessage("#field-messages",a)}function A(a){Vosao.errorMessages("#field-messages",a)}function B(a){Vosao.errorMessage("#field-messages",a)}function C(){$("#field-messages").html("")}function D(a){C(),Vosao.jsonrpc.fieldService.getById(function(a){f=a,S(),w(),$("#field-dialog").dialog("open")},a)}function E(){var a=new Array;$("input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.fieldService.remove(function(b){b.result=="success"?(Vosao.info(a.length+" "+messages("form.success_field_delete")+"."),o()):Vosao.showServiceMessages(b)},Vosao.javaList(a))}function F(){t(!1),r()}function G(){Vosao.jsonrpc.formService.getForm(function(a){c=a,T(),a!=null?($("#title").val(a.title),$("#name").val(a.name),$("#email").val(a.email),$("#letterSubject").val(a.letterSubject),$("#sendButtonTitle").val(a.sendButtonTitle),$("#resetButtonTitle").val(a.resetButtonTitle),$("#showResetButton").each(function(){this.checked=a.showResetButton}),$("#enableCaptcha").each(function(){this.checked=a.enableCaptcha}),$("#enableSave").each(function(){this.checked=a.enableSave}),$(".fieldsTab").show()):($("#title").val(""),$("#name").val(""),$("#email").val(""),$("#letterSubject").val(""),$("#sendButtonTitle").val(""),$("#resetButtonTitle").val(""),$("#showResetButton").each(function(){this.checked=!1}),$("#enableCaptcha").each(function(){this.checked=!1}),$("#enableSave").each(function(){this.checked=!1}),$(".fieldsTab").hide())},b)}function H(){var a=Vosao.javaMap({id:b,title:$("#title").val(),name:$("#name").val(),email:$("#email").val(),letterSubject:$("#letterSubject").val(),sendButtonTitle:$("#sendButtonTitle").val(),resetButtonTitle:$("#resetButtonTitle").val(),showResetButton:String($("#showResetButton:checked").size()>0),enableCaptcha:String($("#enableCaptcha:checked").size()>0),enableSave:String($("#enableSave:checked").size()>0)});Vosao.jsonrpc.formService.saveForm(function(a){a.result=="success"?e?location.href="#plugins/forms":(b=a.message,e=!0,m(),Vosao.info(messages("form.success_create"))):Vosao.showServiceMessages(a)},a)}function I(){location.href="#plugins/forms"}function J(){if(e)return;var a=$("#name").val(),b=$("#title").val();a==""&&$("#name").val(Vosao.urlFromTitle(b))}function K(){if(f!=null)return;var a=$('input[name="field.name"]').val(),b=$('input[name="field.title"]').val();a==""&&$('input[name="field.name"]').val(Vosao.urlFromTitle(b))}function L(a){a-1>=0&&(Vosao.jsonrpc.fieldService.moveUp(function(a){},b,g[a].id),g[a].index--,g[a-1].index++,N(a,a-1),p())}function M(a){a+1<g.length&&(Vosao.jsonrpc.fieldService.moveDown(function(a){},b,g[a].id),g[a+1].index--,g[a].index++,N(a,a+1),p())}function N(a,b){var c=g[b];g[b]=g[a],g[a]=c}function O(){return i[$("#language").val()]?i[$("#language").val()]:""}function P(){i[$("#language").val()]=$('input[name="field.regexMessage"]').val()}function Q(){$('input[name="field.regexMessage"]').val(i[$("#language").val()])}function R(){var a="",b=0;return $.each(i,function(c,d){a+=(b++==0?"":"::")+c+d}),a}function S(){f.regexMessage?$.each(f.regexMessage.split("::"),function(a,b){var c=b.substr(0,2),d=b.substr(2);i[c]=d}):i={}}function T(){c==null?(j=[],U()):Vosao.jsonrpc.formService.getFormData(function(a){j=a.list,U()},c.id)}function U(){var a='<table class="form-table"><tr><th></th><th>'+messages("ip_address")+"</th><th>"+messages("date")+"</th></tr>";$.each(j,function(b,c){a+='<tr><td><input type="checkbox" name="item'+b+'" value="'+c.id+'"/></td><td>'+c.ipAddress+"</td>"+'<td><a class="showForm" data-index="'+b+'">'+(new Date(c.modDate.time)).toLocaleString()+"</a></td></tr>"}),$("#dataTable").html(a+"</table>"),$("#dataTable tr:even").addClass("even"),$("#dataTable a.showForm").click(function(){W($(this).attr("data-index"))})}function V(){var a=new Array;$("#dataTable input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.formService.removeData(function(b){b.result=="success"?(Vosao.info(a.length+" "+messages("form.success_records_delete")+"."),m()):Vosao.showServiceMessages(b)},Vosao.javaList(a))}function W(a){k=a;var b=j[a],c='<table class="form-table"><tr><th>'+messages("name")+"</th><th>"+messages("value")+"</th></tr>";$.each(b.values.map,function(a,b){var d=b;if(d.indexOf("/file/form")==0){var e=d.split("/"),f=e[e.length-1];d='<a href="'+d+'">'+f+"</a>"}c+="<tr><td>"+a+"</td><td>"+d+"</td></tr>"}),$("#formData").html(c+"</table>"),$("#formData tr:even").addClass("even"),$("#formData-dialog").dialog("open")}function X(){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.formService.sendFormLetter(function(a){Vosao.showServiceMessages(a)},j[k].id)}console.log("Loading FormView.js");var b="",c=null,d={},e=b!="",f=null,g=null,h=null,i={},j=null,k=0;return Backbone.View.extend({css:"/static/css/form.css",el:$("#content"),tmpl:_.template(a),render:function(){Vosao.addCSSFile(this.css),this.el.html(this.tmpl({messages:messages})),l()},remove:function(){$("#field-dialog, #formData-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)},setId:function(a){b=a}})}),define("text!template/plugins/seo-urls.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("plugins.seo_urls") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n\r\n<div id="urls"><img src="/static/images/ajax-loader.gif" /></div>\r\n\r\n<div class="buttons">\r\n    <input id="addButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n\r\n<div id="url-dialog" style="display:none" title="<%= messages("seo_urls.details") %>">\r\n  <form id="seoForm">\r\n    <div id="url-messages" class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("seo_urls.from_link") %></label>\r\n        <input id="fromLink" type="text" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("seo_urls.to_link") %></label>\r\n        <input id="toLink" type="text" />\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveAndAddButton" type="button" value="<%= messages("save_add") %>" />\r\n        <input id="saveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n</div>\r\n\r\n</div>\r\n'}),define("view/plugins/SeoUrlsView",["text!template/plugins/seo-urls.html"],function(a){function c(){$("#url-dialog").dialog({width:500,autoOpen:!1}),Vosao.initJSONRpc(d),$("#tabs").tabs(),$("#addButton").click(f),$("#removeButton").click(h),$("#saveAndAddButton").click(i),$("#seoForm").submit(function(){return k(!0),!1}),$("#cancelDlgButton").click(l)}function d(){Vosao.jsonrpc.seoUrlService.select(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("from")+"</th><th>"+messages("to")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td><a data-id="'+c.id+'">'+c.fromLink+"</a></td><td>"+c.toLink+"</td></tr>"}),$("#urls").html(b+"</table>"),$("#urls tr:even").addClass("even"),$("#urls a").click(function(){e($(this).attr("data-id"))})})}function e(a){m(),Vosao.jsonrpc.seoUrlService.getById(function(a){b=a,g(),$("#url-dialog").dialog("open")},a)}function f(){b=null,g(),$("#url-dialog").dialog("open")}function g(){m(),b==null?($("#fromLink").val(""),$("#toLink").val("")):($("#fromLink").val(b.fromLink),$("#toLink").val(b.toLink))}function h(){var a=new Array;$("#urls input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.seoUrlService.remove(function(a){Vosao.showServiceMessages(a),d()},Vosao.javaList(a))}function i(){k(!1,!0)}function j(a){var b=new Array;return a.fromLink==""&&b.push(messages("seo_urls.from_link_empty")),a.toLink==""&&b.push(messages("seo_urls.to_link_empty")),b}function k(a,c){var e={id:b!=null?String(b.id):"",fromLink:$("#fromLink").val(),toLink:$("#toLink").val()},g=j(e);g.length==0?Vosao.jsonrpc.seoUrlService.save(function(b){b.result=="success"?(a&&$("#url-dialog").dialog("close"),d(),c&&f()):n(b.messages.list)},Vosao.javaMap(e)):n(g)}function l(){$("#url-dialog").dialog("close")}function m(){$("#url-messages").html("")}function n(a){Vosao.errorMessages("#url-messages",a)}console.log("Loading SeoUrlsView.js");var b=null;return Backbone.View.extend({css:"/static/css/form.css",el:$("#content"),render:function(){Vosao.addCSSFile(this.css),this.el.html(_.template(a,{messages:messages})),c()},remove:function(){$("#url-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/config/config.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">\r\n\r\n<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config"><%= messages("config.title") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/comments"><%= messages("comments") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/languages"><%= messages("languages") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/messages"><%= messages("message_bundle") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/users"><%= messages("users") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/groups"><%= messages("groups") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/tags"><%= messages("tags") %></a>\r\n    </li>\r\n    <li class="ui-corner-top ui-state-default">\r\n        <a href="#config/attributes"><%= messages("attributes") %></a>\r\n    </li>\r\n</ul>\r\n\r\n<div id="tab-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div>\r\n\r\n</div>\r\n\r\n<div id="import-dialog" title="<%= messages("config.import_site") %>" style="display:none">\r\n<form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\r\n    <%= messages("file_upload") %>:\r\n    <input type="hidden" name="fileType" value="import" />\r\n    <input type="file" name="uploadFile" />\r\n    <div class="buttons-dlg">\r\n        <input type="submit" value="<%= messages("send") %>" />\r\n        <input id="importCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>    \r\n</form>\r\n</div>\r\n\r\n<div id="afterUpload-dialog" style="display:none" title="<%= messages("status_window") %>">\r\n  <form id="okForm">\r\n    <p class="message"></p>\r\n    <div class="buttons-dlg">\r\n        <input id="okButton" type="submit" value="OK" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<div id="export-dialog" style="display:none" title="<%= messages("export_window") %>">\r\n  <form id="exportForm">\r\n    <div class="form-row">\r\n    <input type="radio" name="exportType" value="full" />\r\n        <%= messages("config.full_export") %> <br/>\r\n    <input type="radio" name="exportType" value="site" checked="checked"/>\r\n        <%= messages("config.export_site") %> <br/>\r\n    <input type="radio" name="exportType" value="resources"/>\r\n        <%= messages("resources") %> <br/>\r\n    </div>\r\n    <div id="exportInfo" class="form-row"></div>    \r\n    <div id="timer" class="form-row"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="exportDialogButton" type="submit" value="<%= messages("export") %>" />\r\n        <input id="exportCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<div id="stat-dialog" style="display:none" title="<%= messages("stat") %>">\r\n    <div class="form-row">\r\n    \t<label><%= messages("pages") %>:</label>\r\n    \t<span id="statPages"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("stat.page_permissions") %>:</label>\r\n    \t<span id="statPagePermissions"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("structures") %>:</label>\r\n    \t<span id="statStructures"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("stat.structure_templates") %>:</label>\r\n    \t<span id="statStructureTemplates"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("templates") %>:</label>\r\n    \t<span id="statTemplates"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("folders") %>:</label>\r\n    \t<span id="statFolders"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("stat.folder_permissions") %>:</label>\r\n    \t<span id="statFolderPermissions"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("files") %>:</label>\r\n    \t<span id="statFiles"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("languages") %>:</label>\r\n    \t<span id="statLanguages"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("messages") %>:</label>\r\n    \t<span id="statMessages"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("users") %>:</label>\r\n    \t<span id="statUsers"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("groups") %>:</label>\r\n    \t<span id="statGroups"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><%= messages("tags") %>:</label>\r\n    \t<span id="statTags"></span>\r\n    </div>\r\n    <div class="form-row">\r\n    \t<label><b><%= messages("stat.total") %>:</b></label>\r\n    \t<span id="statTotal" style="font-weight:bold;"></span>\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="statOKButton" type="button" value="OK" />\r\n    </div>\r\n</div>\r\n'}),define("text!template/config/index.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n  <form id="configForm">\r\n    <div class="form-row">\r\n        <label><%= messages("config.db_version") %></label>\r\n        <span id="version" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label>Google Analytics ID</label>\r\n        <input id="googleAnalyticsId" type="text" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.site_owner_email") %></label>\r\n        <input id="siteEmail" type="text" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("site_domain") %></label>\r\n        <input id="siteDomain" type="text" />\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.enable_recaptcha") %></label>\r\n        <input id="enableRecaptcha" type="checkbox" />\r\n    </div>\r\n    <div id="recaptcha">\r\n        <div class="form-row">\r\n            <label><%= messages("config.recaptcha_public_key") %></label>\r\n            <input id="recaptchaPublicKey" type="text" size="40"/>\r\n        </div>\r\n        <div class="form-row">\r\n            <label><%= messages("config.recaptcha_private_key") %></label>\r\n            <input id="recaptchaPrivateKey" type="text" size="40"/>\r\n        </div>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.edit_extension") %></label>\r\n        <input id="editExt" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.login_url") %></label>\r\n        <input id="siteUserLoginUrl" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.404_url") %></label>\r\n        <input id="site404Url" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.enable_ckeditor") %></label>\r\n        <input id="enableCkeditor" type="checkbox" />\r\n    </div>\r\n    <div class="form-row">\r\n         <label><%= messages("profile.timezone") %></label>\r\n         <select id="timezone"></select>\r\n    </div>    \r\n    <div class="form-row">\r\n        <label><%= messages("page.select_language") %>:</label> \r\n        <select id="language"></select>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.enable_picasa") %></label>\r\n        <input id="enablePicasa" type="checkbox" />\r\n    </div>\r\n    <div id="picasa">\r\n        <div class="form-row">\r\n            <label>Picasa <%= messages("user_email") %></label>\r\n            <input id="picasaUser" type="text" />\r\n        </div>\r\n        <div class="form-row">\r\n            <label>Picasa <%= messages("password") %></label>\r\n            <input id="picasaPassword" type="password" />\r\n        </div>\r\n    </div>\r\n    <div class="buttons">\r\n        <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="exportButton" type="button" value="<%= messages("export") %>" />\r\n        <input id="importButton" type="button" value="<%= messages("import") %>" />\r\n        <input id="reindexButton" type="button" value="<%= messages("config.create_search_index") %>" />\r\n        <input id="resetButton" type="button" value="<%= messages("reset") %>" />\r\n        <input id="loadDefaultSiteButton" type="button" value="<%= messages("config.load_default_site") %>" />\r\n        <input id="cacheResetButton" type="button" value="<%= messages("config.cache_reset") %>" />\r\n        <input id="statButton" type="button" value="<%= messages("stat") %>" />\r\n    </div>\r\n  </form>\r\n'}),define("view/config/IndexView",["text!template/config/index.html"],function(a){function j(){$("#upload").ajaxForm(r),Vosao.initJSONRpc(k),$("#enableRecaptcha").click(p),$("#configForm").submit(function(){return x(),!1}),$("#exportButton").click(y),$("#importButton").click(s),$("#importCancelButton").click(t),$("#resetButton").click(D),$("#cacheResetButton").click(F),$("#reindexButton").click(E),$("#loadDefaultSiteButton").click(G),$("#okForm").submit(function(){return u(),!1}),$("#exportForm").submit(function(){return A(),!1}),$("#exportCancelButton").click(z),$("ul.ui-tabs-nav li:nth-child(1)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#enablePicasa").click(q),$("#statButton").click(H),$("#statOKButton").click(I)}function k(){v(),l(),m()}function l(){Vosao.jsonrpc.userService.getTimezones(function(a){h=a.list,n()})}function m(){Vosao.jsonrpc.languageService.select(function(a){i=a.list,o()})}function n(){var a="";$.each(h,function(b,c){a+='<option value="'+c+'">'+c+"</option>"}),$("#timezone").html(a),$("#timezone").val(b.defaultTimezone)}function o(){var a="";$.each(i,function(b,c){a+='<option value="'+c.code+'" '+">"+c.title+"</option>"}),$("#language").html(a),$("#language").val(b.defaultLanguage)}function p(){var a=$("#enableRecaptcha:checked").size()>0;a?$("#recaptcha").show():$("#recaptcha").hide()}function q(){var a=$("#enablePicasa:checked").size()>0;a?$("#picasa").show():$("#picasa").hide()}function r(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?d=messages("config.saved_for_import"):d=messages("error")+". "+d,$("#import-dialog").dialog("close"),$("#afterUpload-dialog .message").text(d),$("#afterUpload-dialog").dialog("open")}function s(){$("#import-dialog").dialog("open")}function t(){$("#import-dialog").dialog("close")}function u(){k()}function v(){Vosao.jsonrpc.configService.getConfig(function(a){b=a,w()})}function w(){$("#version").html(b.version),$("#googleAnalyticsId").val(b.googleAnalyticsId),$("#siteEmail").val(b.siteEmail),$("#siteDomain").val(b.siteDomain),$("#enableRecaptcha").each(function(){this.checked=b.enableRecaptcha}),$("#recaptchaPublicKey").val(b.recaptchaPublicKey),$("#recaptchaPrivateKey").val(b.recaptchaPrivateKey),p(),$("#editExt").val(b.editExt),$("#siteUserLoginUrl").val(b.siteUserLoginUrl),$("#site404Url").val(b.site404Url),$("#enablePicasa").each(function(){this.checked=b.enablePicasa}),$("#enableCkeditor").each(function(){this.checked=b.enableCkeditor}),$("#picasaUser").val(b.picasaUser),$("#picasaPassword").val(b.picasaPassword),q()}function x(){var a=Vosao.javaMap({googleAnalyticsId:$("#googleAnalyticsId").val(),siteEmail:$("#siteEmail").val(),siteDomain:$("#siteDomain").val(),enableRecaptcha:String($("#enableRecaptcha:checked").size()>0),recaptchaPublicKey:$("#recaptchaPublicKey").val(),recaptchaPrivateKey:$("#recaptchaPrivateKey").val(),enablePicasa:String($("#enablePicasa:checked").size()>0),enableCkeditor:String($("#enableCkeditor:checked").size()>0),picasaUser:$("#picasaUser").val(),picasaPassword:$("#picasaPassword").val(),editExt:$("#editExt").val(),defaultTimezone:$("#timezone").val(),defaultLanguage:$("#language").val(),siteUserLoginUrl:$("#siteUserLoginUrl").val(),site404Url:$("#site404Url").val()});Vosao.jsonrpc.configService.saveConfig(function(a){Vosao.showServiceMessages(a)},a)}function y(){$("#export-dialog").dialog("open")}function z(){$("#export-dialog").dialog("close"),clearInterval(c),clearInterval(d)}function A(){$("#exportDialogButton").attr("disabled",!0),e=0,C(),g=$("input[name=exportType]:checked").val(),Vosao.jsonrpc.configService.startExportTask(function(a){a.result=="success"?(f=a.message,Vosao.infoMessage("#exportInfo",messages("creating_export_file")),c=setInterval(B,1e4),d=setInterval(C,1e3)):Vosao.showServiceMessages(a)},g)}function B(){Vosao.jsonrpc.configService.isExportTaskFinished(function(a){a&&(clearInterval(c),clearInterval(d),$("#export-dialog").dialog("close"),$("#exportDialogButton").attr("disabled",!1),location.href="/file/tmp/"+f)},g)}function C(){$("#timer").html(e++ +" sec.")}function D(){confirm(messages("config.reset_warning1"))&&confirm(messages("config.reset_warning2"))&&Vosao.jsonrpc.configService.reset(function(a){Vosao.showServiceMessages(a),a.result=="success"&&(location.href="/")})}function E(){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.configService.reindex(function(a){Vosao.showServiceMessages(a)})}function F(){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.configService.cacheReset(function(a){Vosao.showServiceMessages(a)})}function G(){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.configService.loadDefaultSite(function(a){Vosao.showServiceMessages(a)})}function H(){Vosao.jsonrpc.configService.getSiteStat(function(a){$("#statPages").text(a.pages),$("#statPagePermissions").text(a.pagePermissions),$("#statStructures").text(a.structures),$("#statStructureTemplates").text(a.structureTemplates),$("#statTemplates").text(a.templates),$("#statFolders").text(a.folders),$("#statFolderPermissions").text(a.folderPermissions),$("#statFiles").text(a.files),$("#statLanguages").text(a.languages),$("#statMessages").text(a.messages),$("#statUsers").text(a.users),$("#statGroups").text(a.groups),$("#statTags").text(a.tags),$("#statTotal").text(a.total),$("#stat-dialog").dialog("open")})}function I(){$("#stat-dialog").dialog("close")}console.log("Loading IndexView.js");var b="",c=null,d=null,e=0,f=null,g=null,h=null,i=null;return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),j()},remove:function(){this.el.html("")}})}),define("text!template/config/comments.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n  <form id="commentsForm">\r\n    <div class="form-row">\r\n        <label><%= messages("config.comments_email") %></label>\r\n        <input id="commentsEmail" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.comments_template") %></label>\r\n        <textarea id="commentsTemplate" cols="80" rows="20"></textarea>\r\n    </div>\r\n    <div class="buttons">\r\n        <input id="commentsSaveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="restoreButton" type="button" value="<%= messages("restore_default") %>" />\r\n    </div>\r\n  </form>\r\n'}),define("view/config/CommentsView",["text!template/config/comments.html"],function(a){function c(){Vosao.initJSONRpc(d),$("#commentsForm").submit(function(){return g(),!1}),$("#restoreButton").click(h),$("ul.ui-tabs-nav li:nth-child(2)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function d(){e()}function e(){Vosao.jsonrpc.configService.getConfig(function(a){b=a,f()})}function f(){$("#commentsEmail").val(b.commentsEmail),$("#commentsTemplate").val(b.commentsTemplate)}function g(){var a=Vosao.javaMap({commentsEmail:$("#commentsEmail").val(),commentsTemplate:$("#commentsTemplate").val()});Vosao.jsonrpc.configService.saveConfig(function(a){Vosao.showServiceMessages(a)},a)}function h(){Vosao.jsonrpc.configService.restoreCommentsTemplate(function(a){Vosao.showServiceMessages(a),e()})}console.log("Loading CommentsView.js");var b="";return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),c()},remove:function(){this.el.html("")}})}),define("text!template/config/languages.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="languages"> </div>\r\n<div class="buttons">\r\n    <input id="addLanguageButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeLanguageButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n\r\n<div id="language-dialog" style="display:none" title="<%= messages("config.site_language") %>">\r\n  <form id="languageForm">\r\n    <div class="messages"> </div>\r\n    <div id="languageSelection" style="padding-bottom: 10px;">\r\n        <input id="selectFromListRadio" type="radio" name="select" \r\n            checked="checked" /> <%= messages("select_from_list") %>\r\n        <input id="notInListRadio" type="radio" name="select" />\r\n            <%= messages("config.not_in_list") %> \r\n    </div>        \r\n    <div id="listed-language">\r\n        <select id="selectLanguage"></select>\r\n    </div>\r\n    <div id="not-listed-language" style="display:none">\r\n    <div class="form-row">\r\n        <label><%= messages("language") %> <a href="http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt">iso639</a> 2 letter code</label>\r\n        <input id="languageCode" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("title") %></label>\r\n        <input id="languageTitle" type="text"/>\r\n    </div>\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="languageSaveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="languageCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n'}),define("view/config/LanguagesView",["text!template/config/languages.html"],function(a){function d(){$("#language-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(e),q(),$("#selectFromListRadio").click(function(){r(!0)}),$("#notInListRadio").click(function(){r(!1)}),$("#languageForm").submit(function(){return l(),!1}),$("#selectLanguage").change(s),$("#languageCancelButton").click(m),$("#addLanguageButton").click(f),$("#removeLanguageButton").click(g),$("ul.ui-tabs-nav li:nth-child(3)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function e(){n()}function f(){b=null,$("#language-dialog").dialog("open"),$("#languageSelection").show(),$("#listed-language").show(),$("#not-listed-language").hide(),$("#language-dialog .messages").html("")}function g(){var a=[];$("#languages input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.languageService.remove(function(a){Vosao.info(a.message),n()},Vosao.javaList(a))}function h(a){Vosao.infoMessage("#language-dialog .messages",a)}function i(a){Vosao.errorMessage("#language-dialog .messages",a)}function j(a){Vosao.errorMessages("#language-dialog .messages",a)}function k(a){var b=[];return a.code==""&&b.push(messages("config.code_is_empty")),a.title==""&&b.push(messages("title_is_empty")),b}function l(){var a={id:b!=null?String(b.id):"",code:$("#languageCode").val(),title:$("#languageTitle").val()},c=k(a);c.length==0?Vosao.jsonrpc.languageService.save(function(a){a.result=="success"?($("#language-dialog").dialog("close"),n()):j(a.messages.list)},Vosao.javaMap(a)):j(c)}function m(){$("#language-dialog").dialog("close")}function n(){Vosao.jsonrpc.languageService.select(function(a){c=a.list;var b='<table class="form-table"><tr><th></th><th>'+messages("code")+"</th><th>"+messages("title")+"</th></tr>";$.each(a.list,function(a,c){b+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td>'+c.code+'</td><td>\t                <a data-id="'+c.id+'">'+c.title+"</a></td></tr>"}),$("#languages").html(b+"</table>"),$("#languages tr:even").addClass("even"),$("#languages a").click(function(){var a=$(this).attr("data-id");a&&o(a)})})}function o(a){Vosao.jsonrpc.languageService.getById(function(a){b=a,$("#languageCode").val(a.code),$("#languageTitle").val(a.title),$("#language-dialog").dialog("open"),$("#languageSelection").hide(),$("#listed-language").hide(),$("#not-listed-language").show(),$("#language-dialog .messages").html("")},a)}function q(){var a="";for(var b in p)a+='<option value="'+b+'">'+p[b]+"</option>\n";$("#selectLanguage").html(a),$("#selectLanguage").val("ru"),s()}function r(a){a?($("#listed-language").show(),$("#not-listed-language").hide()):($("#listed-language").hide(),$("#not-listed-language").show())}function s(){var a=$("#selectLanguage").val();$("#languageCode").val(a),$("#languageTitle").val(p[a])}console.log("Loading LanguagesView.js");var b=null,c=null,p={aa:"Afar",ab:"Abkhazian",af:"Afrikaans",am:"Amharic",ar:"Arabic",as:"Assamese",ay:"Aymara",az:"Azerbaijani",ba:"Bashkir",be:"Byelorussian",bg:"Bulgarian",bh:"Bihari",bi:"Bislama",bn:"Bengali; Bangla",bo:"Tibetan",br:"Breton",bs:"Bosnian",ca:"Catalan",co:"Corsican",cs:"Czech",cy:"Welsh",da:"Danish",de:"German",dz:"Bhutani",el:"Greek",en:"English",eo:"Esperanto",es:"Spanish",et:"Estonian",eu:"Basque",fa:"Persian",fi:"Finnish",fj:"Fiji",fo:"Faroese",fr:"French",fy:"Frisian",ga:"Irish",gd:"Scots Gaelic",gl:"Galician",gn:"Guarani",gu:"Gujarati",ha:"Hausa",he:"Hebrew (formerly iw)",hi:"Hindi",hr:"Croatian",hu:"Hungarian",hy:"Armenian",ia:"Interlingua",id:"Indonesian (formerly in)",ie:"Interlingue",ik:"Inupiak",is:"Icelandic",it:"Italian",iu:"Inuktitut",ja:"Japanese",jw:"Javanese",ka:"Georgian",kk:"Kazakh",kl:"Greenlandic",km:"Cambodian",kn:"Kannada",ko:"Korean",ks:"Kashmiri",ku:"Kurdish",ky:"Kirghiz",la:"Latin",ln:"Lingala",lo:"Laothian",lt:"Lithuanian",lv:"Latvian, Lettish",mg:"Malagasy",mi:"Maori",mk:"Macedonian",ml:"Malayalam",mn:"Mongolian",mo:"Moldavian",mr:"Marathi",ms:"Malay",mt:"Maltese",my:"Burmese",na:"Nauru",ne:"Nepali",nl:"Dutch",no:"Norwegian",oc:"Occitan",om:"(Afan) Oromo",or:"Oriya",pa:"Punjabi",pl:"Polish",ps:"Pashto, Pushto",pt:"Portuguese",qu:"Quechua",rm:"Rhaeto-Romance",rn:"Kirundi",ro:"Romanian",ru:"Russian",rw:"Kinyarwanda",sa:"Sanskrit",sd:"Sindhi",sg:"Sangho",sh:"Serbo-Croatian",si:"Sinhalese",sk:"Slovak",sl:"Slovenian",sm:"Samoan",sn:"Shona",so:"Somali",sq:"Albanian",sr:"Serbian",ss:"Siswati",st:"Sesotho",su:"Sundanese",sv:"Swedish",sw:"Swahili",ta:"Tamil",te:"Telugu",tg:"Tajik",th:"Thai",ti:"Tigrinya",tk:"Turkmen",tl:"Tagalog",tn:"Setswana",to:"Tonga",tr:"Turkish",ts:"Tsonga",tt:"Tatar",tw:"Twi",ug:"Uighur",uk:"Ukrainian",ur:"Urdu",uz:"Uzbek",vi:"Vietnamese",vo:"Volapuk",wo:"Wolof",xh:"Xhosa",yi:"Yiddish (formerly ji)",yo:"Yoruba",za:"Zhuang",zh:"Chinese",zu:"Zulu"};return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),d()},remove:function(){$("#language-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/config/messages.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="messageBundle"> </div>\r\n<div class="buttons">\r\n    <input id="addMessageButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeMessageButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n\r\n<div id="message-dialog" style="display:none" title="<%= messages("config.localized_message") %>">\r\n  <form id="messageForm">\r\n    <div class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.message_code") %></label>\r\n        <input id="messageCode" type="text"/>\r\n    </div>\r\n    <div id="messagesInput"> </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveMessageDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelMessageDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n'}),define("view/config/MessagesView",["text!template/config/messages.html"],function(a){function c(){$("#message-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(d),$("#addMessageButton").click(f),$("#removeMessageButton").click(g),$("#messageForm").submit(function(){return j(),!1}),$("#cancelMessageDlgButton").click(k),$("ul.ui-tabs-nav li:nth-child(4)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function d(){e()}function e(){Vosao.jsonrpc.languageService.select(function(a){b=a.list,h()})}function f(){n();var a="";$.each(b,function(b,c){a+='<div class="form-row"><label>'+c.title+'</label><input type="text" id="message_'+c.code+'" /></div>'}),$("#messageCode").val(""),$("#messagesInput").html(a),$("#message-dialog").dialog("open")}function g(){var a=[];$("#messageBundle input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.messageService.remove(function(a){Vosao.info(a.message),h()},Vosao.javaList(a))}function h(){Vosao.jsonrpc.messageService.select(function(a){var c='<table class="form-table"><tr><th></th><th>'+messages("code")+"</th>";$.each(b,function(a,b){c+="<th>"+b.title+"</th>"}),c+="</tr>",$.each(a.list,function(a,d){c+='<tr><td><input type="checkbox" value="'+d.code+'"/></td>\t                <td><a data-code="'+d.code+'">'+d.code+"</a></td>",$.each(b,function(a,b){c+="<td>"+d.values.map[b.code]+"</td>"}),c+="</tr>"}),$("#messageBundle").html(c+"</table>"),$("#messageBundle tr:even").addClass("even"),$("#messageBundle td a").click(function(){var a=$(this).attr("data-code");a&&i(a)})})}function i(a){Vosao.jsonrpc.messageService.selectByCode(function(b){f(),$("#messageCode").val(a),$.each(b.list,function(a,b){$("#message_"+b.languageCode).val(b.value)})},a)}function j(){var a={code:$("#messageCode").val()};$.each(b,function(b,c){a[c.code]=$("#message_"+c.code).val()}),Vosao.jsonrpc.messageService.save(function(a){a.result=="success"?(h(),$("#message-dialog").dialog("close")):m(a.messages.list)},Vosao.javaMap(a))}function k(){$("#message-dialog").dialog("close")}function l(a){Vosao.errorMessage("#message-dialog .messages",a)}function m(a){Vosao.errorMessages("#message-dialog .messages",a)}function n(){$("#message-dialog .messages").html()}console.log("Loading MessagesView.js");var b=null;return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),c()},remove:function(){$("#message-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/config/users.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2010 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="users"> </div>\r\n<div class="buttons">\r\n    <input id="addUserButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeUserButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n\r\n<div id="user-dialog" style="display:none" title="<%= messages("config.user_details") %>">\r\n  <form id="userForm">\r\n    <div class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("user_name") %></label>\r\n        <input id="userName" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("user_email") %></label>\r\n        <input id="userEmail" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("user_role") %></label>\r\n        <select id="userRole">\r\n            <option value="SITE_USER" selected="selected"><%= messages("site_user") %></option>\r\n            <option value="USER"><%= messages("user") %></option>\r\n            <option value="ADMIN"><%= messages("administrator") %></option>\r\n        </select>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("password") %></label>\r\n        <input id="userPassword1" type="password"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("retype_password") %></label>\r\n        <input id="userPassword2" type="password"/>\r\n    </div>\r\n    <div class="form-row">\r\n         <label><%= messages("profile.timezone") %></label>\r\n         <select id="timezone"></select>\r\n    </div>    \r\n    <div class="buttons-dlg">\r\n        <input id="userSaveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="userDisableDlgButton" type="button" value="<%= messages("disable") %>" />\r\n        <input id="userCancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n'}),define("view/config/UsersView",["text!template/config/users.html"],function(a){function d(){$("#user-dialog").dialog({width:500,autoOpen:!1}),Vosao.initJSONRpc(e),$("#addUserButton").click(f),$("#removeUserButton").click(g),$("#userForm").submit(function(){return m(),!1}),$("#userCancelDlgButton").click(n),$("#userDisableDlgButton").click(q),$("ul.ui-tabs-nav li:nth-child(5)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function e(){Vosao.jsonrpc.userService.getTimezones(function(a){timezones=a.list,r(),h()})}function f(){b=null,k(),$("#user-dialog").dialog("open")}function g(){var a=[];$("#users input:checked").each(function(){a.push(String(this.value))});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.userService.remove(function(a){Vosao.info(a.message),h()},Vosao.javaList(a))}function h(){Vosao.jsonrpc.userService.select(function(a){var b='<table class="form-table"><tr><th></th><th>'+messages("name")+"</th><th>"+messages("email")+"</th><th>"+messages("role")+"</th><th>"+messages("access")+"</th></tr>";$.each(a.list,function(a,c){var d=c.disabled?messages("disabled"):messages("enabled");b+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td>'+c.name+'</td><td>\t                <a data-id="'+c.id+'">'+c.email+"</a></td><td>"+i(c.role)+"</td>"+"<td>"+d+"</td></tr>"}),$("#users").html(b+"</table>"),$("#users tr:even").addClass("even"),$("#users a").click(function(){var a=$(this).attr("data-id");a&&j(a)})})}function i(a){if(a=="ADMIN")return messages("administrator");if(a=="USER")return messages("user");if(a=="SITE_USER")return messages("site_user")}function j(a){Vosao.jsonrpc.userService.getById(function(a){b=a,k(),$("#user-dialog").dialog("open")},a)}function k(){b==null?($("#userName").val(""),$("#userEmail").val(""),$("#userEmail").removeAttr("disabled"),$("#userRole").val(""),$("#userDisableDlgButton").hide()):($("#userName").val(b.name),$("#userEmail").val(b.email),$("#userEmail").attr("disabled",!0),$("#userRole").val(b.roleString),$("#timezone").val(b.timezone),$("#userDisableDlgButton").val(b.disabled?messages("enable"):messages("disable")).show()),$("#userPassword1").val(""),$("#userPassword2").val(""),$("#user-dialog .messages").html("")}function l(a){var b=[];return a.email==""&&b.push(messages("email_is_empty")),a.password1!=a.password2&&b.push(messages("config.passwords_dont_match")),b}function m(){var a={id:b!=null?String(b.id):"",name:$("#userName").val(),email:$("#userEmail").val(),role:$("#userRole").val(),timezone:$("#timezone").val(),password:$("#userPassword1").val(),password1:$("#userPassword1").val(),password2:$("#userPassword2").val()},c=l(a);c.length==0?Vosao.jsonrpc.userService.save(function(a){a.result=="success"?($("#user-dialog").dialog("close"),Vosao.info(a.message),h()):p(a.messages.list)},Vosao.javaMap(a)):p(c)}function n(){$("#user-dialog").dialog("close")}function o(a){Vosao.errorMessage("#user-dialog .messages",a)}function p(a){Vosao.errorMessages("#user-dialog .messages",a)}function q(){Vosao.jsonrpc.userService.disable(function(a){$("#user-dialog").dialog("close"),Vosao.showServiceMessages(a),h()},b.id,!b.disabled)}function r(){var a="";$.each(timezones,function(b,c){a+='<option value="'+c+'">'+c+"</option>"}),$("#timezone").html(a)}console.log("Loading UsersView.js");var b=null,c=null;return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),d()},remove:function(){$("#user-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/config/groups.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="groups"> </div>\r\n<div class="buttons">\r\n    <input id="addGroupButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeGroupButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n\r\n<div id="group-dialog" style="display:none" title="<%= messages("config.group_details") %>">\r\n  <form id="groupForm">\r\n    <div class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.group_name") %></label>\r\n        <input id="groupName" type="text"/>\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="groupSaveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="groupCancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n<div id="user-group-dialog" style="display:none" title="<%= messages("config.group_users") %>">\r\n  <form id="userGroupForm">\r\n    <div id="groupUsers"> </div>\r\n    <div class="buttons-dlg">\r\n        <input id="userGroupSaveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="userGroupCancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n'}),define("view/config/GroupsView",["text!template/config/groups.html"],function(a){function e(){$("#group-dialog").dialog({width:460,autoOpen:!1}),$("#user-group-dialog").dialog({width:300,autoOpen:!1}),Vosao.initJSONRpc(f),$("#addGroupButton").click(h),$("#removeGroupButton").click(i),$("#groupForm").submit(function(){return m(),!1}),$("#groupCancelDlgButton").click(n),$("#userGroupForm").submit(function(){return s(),!1}),$("#userGroupCancelDlgButton").click(r),$("ul.ui-tabs-nav li:nth-child(6)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default")}function f(){g()}function g(){Vosao.jsonrpc.groupService.select(function(a){c=Vosao.idMap(a.list);var b='<table class="form-table"><tr><th></th><th>'+messages("name")+"</th><th>"+messages("users")+"</th></tr>";$.each(a.list,function(a,c){if(c.name=="guests")return;var d=messages("add_users");c.users.list.length>0&&(d="",$.each(c.users.list,function(a,b){d+=(a==0?"":", ")+b.name}));var e='<a class="groupEdit" data-id="'+c.id+'">'+c.name+"</a>",f='<a class="userGroupEdit" data-id="'+c.id+'">'+d+"</a>";b+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td>'+e+"</td><td>"+f+"</td></tr>"}),$("#groups").html(b+"</table>"),$("#groups tr:even").addClass("even"),$("#groups .groupEdit").click(function(){j($(this).attr("data-id"))}),$("#groups .userGroupEdit").click(function(){q($(this).attr("data-id"))})})}function h(){b=null,k(),$("#group-dialog").dialog("open")}function i(){var a=[];$("#groups input:checked").each(function(){a.push(String(this.value))});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.groupService.remove(function(a){Vosao.info(a.message),g()},Vosao.javaList(a))}function j(a){Vosao.jsonrpc.groupService.getById(function(a){b=a,k(),$("#group-dialog").dialog("open")},a)}function k(){b==null?$("#groupName").val(""):$("#groupName").val(b.name),$("#group-dialog .messages").html("")}function l(a){var b=[];return a.name==""&&b.push(messages("name_is_empty")),b}function m(){var a={id:b!=null?String(b.id):"",name:$("#groupName").val()},c=l(a);c.length==0?Vosao.jsonrpc.groupService.save(function(a){a.result=="success"?($("#group-dialog").dialog("close"),Vosao.info(a.message),g()):p(a.messages.list)},Vosao.javaMap(a)):p(c)}function n(){$("#group-dialog").dialog("close")}function o(a){Vosao.errorMessage("#group-dialog .messages",a)}function p(a){Vosao.errorMessages("#group-dialog .messages",a)}function q(a){b=c[a],Vosao.jsonrpc.userService.select(function(a){d=Vosao.idMap(a.list);var c=Vosao.idMap(b.users.list),e="";$.each(d,function(a,b){var d="";c[b.id]!=undefined&&(d='checked = "checked"'),e+='<div class="form-row"><input type="checkbox" '+d+' value="'+b.id+'"> '+b.name+"</div>"}),$("#groupUsers").html(e),$("#user-group-dialog").dialog("open")})}function r(){$("#user-group-dialog").dialog("close")}function s(){var a=[];$("#user-group-dialog input:checked").each(function(){a.push(this.value)}),Vosao.jsonrpc.groupService.setGroupUsers(function(a){Vosao.showServiceMessages(a),$("#user-group-dialog").dialog("close"),g()},b.id,Vosao.javaList(a))}console.log("Loading GroupsView.js");var b=null,c=null,d=null;return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),e()},remove:function(){$("#group-dialog").dialog("destroy").remove(),$("#user-group-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("text!template/config/tags.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n\r\n<ul id="tags"></ul>\r\n<div class="buttons">\r\n    <input id="addButton" type="button" value="<%= messages("add") %>" />\r\n</div>\r\n\r\n<div id="tag-dialog" style="display:none" title="<%= messages("config.tag_details") %>">\r\n  <form id="tagForm">\r\n    <div class="messages"> </div>\r\n    <div class="form-row">\r\n        <label><%= messages("title") %></label>\r\n        <input id="title" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("config.tag_name") %></label>\r\n        <input id="tagName" type="text"/>\r\n    </div>\r\n    <div id="pages"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="tagSaveDlgButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="tagDeleteDlgButton" type="button" value="<%= messages("delete") %>" />\r\n        <input id="tagCancelDlgButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n'}),define("view/config/TagsView",["text!template/config/tags.html","jquery.treeview"],function(a){function f(){$("#tag-dialog").dialog({width:460,autoOpen:!1}),Vosao.initJSONRpc(g),$("#addButton").click(function(){h("")}),$("#tagForm").submit(function(){return q(),!1}),$("#tagCancelDlgButton").click(r),$("#tagDeleteDlgButton").click(u),$("ul.ui-tabs-nav li:nth-child(7)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#title").change(w)}function g(){i()}function h(a){c=a,b=null,m(),$("#tag-dialog").dialog("open")}function i(){Vosao.jsonrpc.tagService.getTree(function(a){$("#tags").html(j(a.list)),$("#tags .tagEdit").click(function(){l($(this).attr("data-id"))}),$("#tags .addTag").click(function(){h($(this).attr("data-id"))}),$("#tags").treeview({animated:"fast",collapsed:!0,unique:!0,persist:"cookie",cookieId:"tagTree"})})}function j(a){var b="";return $.each(a,function(a,c){b+=k(c)}),b}function k(a){var b='<li><a class="tagEdit" data-id="'+a.entity.id+'">'+a.entity.name+'</a> <a class="addTag" title="'+messages("add_child")+'" data-id="'+a.entity.id+'">+</a>';return a.children.list.length>0&&(b+="<ul>",$.each(a.children.list,function(a,c){b+=k(c)}),b+="</ul>"),b+"</li>"}function l(a){Vosao.jsonrpc.tagService.getById(function(a){b=a,c=b.parent,m(),$("#tag-dialog").dialog("open")},a)}function m(){b==null?($("#tagName").val(""),$("#title").val(""),$("#pages").html("")):($("#tagName").val(b.name),$("#title").val(b.title),n()),$("#tag-dialog .messages").html("")}function n(){Vosao.jsonrpc.tagService.getPages(function(a){e=a.list,o()},b.id)}function o(){$("#pages").html("");if(e.length>0){var a="";$.each(e,function(b,c){a+='<span class="tag">'+c.title+' <a data-id="'+b+'"><img src="/static/images/02_x.png" /></a></span>'}),$("#pages").html(a),$("#pages a").click(function(){v($(this).attr("data-id"))})}}function p(a){var b=[];return a.name==""&&b.push(messages("config.tag_is_empty")),b}function q(){var a={id:b!=null?String(b.id):"",parent:c==null?"":String(c),name:$("#tagName").val(),title:$("#title").val()},d=p(a);d.length==0?Vosao.jsonrpc.tagService.save(function(a){a.result=="success"?($("#tag-dialog").dialog("close"),Vosao.info(a.message),i()):s(a.message)},Vosao.javaMap(a)):t(d)}function r(){$("#tag-dialog").dialog("close")}function s(a){Vosao.errorMessage("#tag-dialog .messages",a)}function t(a){Vosao.errorMessages("#tag-dialog .messages",a)}function u(){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.tagService.remove(function(a){Vosao.showServiceMessages(a),$("#tag-dialog").dialog("close"),i()},b.id)}function v(a){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.tagService.removeTag(function(b){Vosao.showServiceMessages(b),e.splice(a,1),o()},e[a].friendlyURL,b.id)}function w(){if(b!=null)return;var a=$("#tagName").val(),c=$("#title").val();a==""&&$("#tagName").val(Vosao.urlFromTitle(c))}console.log("Loading TagsView.js");var b=null,c=null,d=null,e=null;return Backbone.View.extend({css:"/static/css/jquery.treeview.css",el:$("#tab-1"),render:function(){Vosao.addCSSFile(this.css),this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),f()},remove:function(){$("#tag-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/config/attributes.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="attributes"></div>\r\n  \r\n<div class="buttons">\r\n    <input id="addButton" type="button" value="<%= messages("add") %>" />\r\n    <input id="removeButton" type="button" value="<%= messages("remove") %>" />\r\n</div>\r\n  \r\n<div id="attribute-dialog" style="display:none" title="<%= messages(\'attribute\') %>">\r\n  <form id="attributeForm">\r\n    <div class="form-row">\r\n        <label><%= messages("name") %></label>\r\n        <input id="name" type="text"/>\r\n    </div>\r\n    <div class="form-row">\r\n        <label><%= messages("value") %></label>\r\n        <input id="value" type="text" size="40"/>\r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>'}),define("view/config/AttributesView",["text!template/config/attributes.html"],function(a){function c(){$("ul.ui-tabs-nav li:nth-child(8)").addClass("ui-state-active").addClass("ui-tabs-selected").removeClass("ui-state-default"),$("#attribute-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(d),$("#addButton").click(g),$("#cancelButton").click(function(){$("#attribute-dialog").dialog("close")}),$("#attributeForm").submit(function(){return i(),!1}),$("#removeButton").click(j)}function d(){e()}function e(){Vosao.jsonrpc.configService.getConfig(function(a){b=a,f()})}function f(){var a='<table class="form-table"><tr><th></th><th>'+messages("name")+"</th><th>"+messages("value")+"</th></tr>";$.each(b.attributes.map,function(b,c){a+='<tr><td><input type="checkbox" value="'+b+'"/></td>'+'<td><a data-name="'+b+'">'+b+"</a></td>"+"<td>"+c+"</td></tr>"}),$("#attributes").html(a+"</table>"),$("#attributes tr:even").addClass("even"),$("#attributes a").click(function(){h($(this).attr("data-name"))})}function g(){$("#attribute-dialog").dialog("open"),$("#name").val(""),$("#value").val("")}function h(a){$("#attribute-dialog").dialog("open"),$("#name").val(a),$("#value").val(b.attributes.map[a])}function i(){var a=$("#name").val(),b=$("#value").val();Vosao.jsonrpc.configService.saveAttribute(function(a){Vosao.showServiceMessages(a),$("#attribute-dialog").dialog("close"),d()},a,b)}function j(){var a=[];$("#attributes input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.configService.removeAttributes(function(a){Vosao.info(a.message),d()},Vosao.javaList(a))}console.log("Loading AttributesView.js");var b="";return Backbone.View.extend({el:$("#tab-1"),render:function(){this.el=$("#tab-1"),this.el.html(_.template(a,{messages:messages})),c()},remove:function(){$("#attribute-dialog").dialog("destroy").remove(),this.el.html("")}})}),define("view/config/ConfigRouter",["view/config/IndexView","view/config/CommentsView","view/config/LanguagesView","view/config/MessagesView","view/config/UsersView","view/config/GroupsView","view/config/TagsView","view/config/AttributesView"],function(a,b,c,d,e,f,g,h){return console.log("Loading ConfigRouter.js"),Backbone.Router.extend({configView:null,currentView:null,indexView:new a,commentsView:new b,languagesView:new c,messagesView:new d,usersView:new e,groupsView:new f,tagsView:new g,attributesView:new h,initialize:function(a){this.configView=a.view},show:function(a){Vosao.app.currentView!=this.configView&&Vosao.app.show(this.configView),this.currentView&&(this.currentView.remove(),this.currentView=null),$("ul.ui-tabs-nav li").removeClass("ui-state-active").removeClass("ui-tabs-selected").addClass("ui-state-default"),a.render(),this.currentView=a},routes:{"config/comments":"comments","config/languages":"languages","config/messages":"messages","config/users":"users","config/groups":"groups","config/tags":"tags","config/attributes":"attributes"},index:function(){this.show(this.indexView)},comments:function(){this.show(this.commentsView)},languages:function(){this.show(this.languagesView)},messages:function(){this.show(this.messagesView)},users:function(){this.show(this.usersView)},groups:function(){this.show(this.groupsView)},tags:function(){this.show(this.tagsView)},attributes:function(){this.show(this.attributesView)}})}),define("view/config/ConfigView",["text!template/config/config.html","view/config/ConfigRouter","jquery.form"],function(a,b){return console.log("Loading ConfigView.js"),Backbone.View.extend({css:"/static/css/config.css",el:$("#content"),tmpl:_.template(a),viewCmd:null,router:null,initialize:function(){this.router=new b({view:this})},render:function(){Vosao.addCSSFile(this.css),this.el.html(this.tmpl({messages:messages})),$("#import-dialog").dialog({width:400,autoOpen:!1}),$("#export-dialog").dialog({width:400,autoOpen:!1}),$("#stat-dialog").dialog({width:400,autoOpen:!1}),$("#afterUpload-dialog").dialog({autoOpen:!1}),this.router.index()},remove:function(){this.router.currentView&&this.router.currentView.remove(),$("#import-dialog").dialog("destroy").remove(),$("#export-dialog").dialog("destroy").remove(),$("#stat-dialog").dialog("destroy").remove(),$("#afterUpload-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFile(this.css)}})}),define("text!template/folders.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="tabs">\r\n\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("folders") %></a></li>\r\n    <li><a href="#tab-2">Picasa</a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n    <p id="folder-location"></p>\r\n    <ul id="folders-tree"><img src="/static/images/ajax-loader.gif" /></ul>\r\n</div>\r\n\r\n<div id="tab-2">\r\n    <div id="albums"><img src="/static/images/ajax-loader.gif" /></div>\r\n    <div class="clear">\r\n        <a id="createAlbumLink"><%= messages("folders.create_album") %></a>\r\n    </div> \r\n    <div id="albumDetails">\r\n        <hr class="clear picasa-hr" />\r\n        <p class="album-name">\r\n            Album : <span id="album-location"></span>\r\n            <a id="deleteAlbumLink"><%= messages("folders.delete_album") %></a>\r\n        </p>\r\n        <div id="photos"></div>\r\n        <div class="clear">\r\n            <a id="uploadPhotoLink"><%= messages("folders.upload_image") %></a>\r\n        </div>\r\n    </div> \r\n    <div class="clear"></div>\r\n</div>\r\n\r\n</div>\r\n\r\n<div id="album-dialog" style="display:none" title="<%= messages("folders.new_album") %>">\r\n  <form id="albumForm">\r\n    <div class="form-row">\r\n        <label><%= messages("folders.album_title") %></label>\r\n        <input id="title"/>\r\n    </div>\r\n    <div id="albumMessages"></div>\r\n    <div class="buttons-dlg">\r\n        <input type="submit" value="<%= messages("save") %>" />\r\n        <input id="cancelAlbumButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>  \r\n</div>\r\n\r\n<div id="upload-dialog" style="display:none" title="<%= messages("folders.upload_image") %>">\r\n  <form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\r\n    <input type="hidden" name="fileType" value="picasa" />\r\n    <input type="hidden" name="albumId" />\r\n    <input type="file" name="uploadFile" />\r\n    <div class="buttons-dlg">\r\n        <input type="submit" value="<%= messages("upload") %>" />\r\n        <input id="uploadCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>    \r\n  </form>\r\n</div>\r\n\r\n'}),define("view/FoldersView",["text!template/folders.html","jquery.form","jquery.treeview"],function(a){function b(){Vosao.initJSONRpc(c),$("#tabs").tabs(),$.cookie("folderReturnPath",null,{path:"/",expires:10})}function c(){Vosao.jsonrpc.folderService.getTree(function(a){$("#folders-tree").html(d(a)),$("#folders-tree").treeview({animated:"fast",collapsed:!0,unique:!0,persist:"cookie",cookieId:"folderTree"})})}function d(a){var b='<li><a href="#folder/'+a.entity.id+'">'+a.entity.title+'</a> <a title="'+messages("add_child")+'" href="#addFolder/'+a.entity.id+'">+</a>';return a.children.list.length>0&&(b+="<ul>",$.each(a.children.list,function(a,c){b+=d(c)}),b+="</ul>"),b+"</li>"}function i(){$("#album-dialog").dialog({width:400,autoOpen:!1}),$("#upload-dialog").dialog({width:400,autoOpen:!1}),$("#upload").ajaxForm(v),Vosao.initJSONRpc(j),$("#createAlbumLink").click(q),$("#deleteAlbumLink").click(s),$("#uploadPhotoLink").click(u),$("#albumForm").submit(function(){return r(),!1}),$("#cancelAlbumButton").click(function(){$("#album-dialog").dialog("close")}),$("#uploadAlbumButton").click(function(){$("#upload-dialog").dialog("close")}),$("#uploadCancelButton").click(function(){$("#upload-dialog").dialog("close")})}function j(){Vosao.jsonrpc.configService.getConfig(function(a){e=a,e.enablePicasa?k():($("#albums").html(messages("folders.picasa_not_enabled")),$("#createAlbumLink").hide())})}function k(){Vosao.jsonrpc.picasaService.selectAlbums(function(a){f=a.list,l()})}function l(){var a="";$.each(f,function(b,c){var d="";$.each(c.categories.list,function(a,b){d+=b+" "}),a+='<a class="album" data-i="'+b+'">'+'<img src="/static/images/Photos.png" /><p>'+c.title+" "+d+"</p></a>"}),$("#albums").html(a),$("#albums a.album").click(function(){m($(this).attr("data-i"))})}function m(a){h=f[a],n()}function n(){$("#album-location").text(h.title),Vosao.jsonrpc.picasaService.selectPhotos(function(a){g=a.list,o()},h.id)}function o(){$("#albumDetails").show();var a="";$.each(g,function(b,c){var d="";$.each(c.categories.list,function(a,b){d+=b+" "}),a+='<div class="photo"><img class="remove" src="/static/images/02_x.png" data-i="'+b+'" />'+'<a data-i="'+b+'"><img src="'+c.thumbnailURL+'" />'+"<p>"+c.title+"<br/>"+d+"</p></a></div>"}),$("#photos").html(a),$("#photos img.remove").click(function(){t($(this).attr("data-i"))}),$("#photos a").click(function(){p($(this).attr("data-i"))})}function p(a){window.open(g[a].URL,"preview")}function q(){$("#album-dialog").dialog("open")}function r(){var a=$("#title").val();if(!a){Vosao.errorMessage("#albumMessages",messages("title_is_empty"));return}Vosao.jsonrpc.picasaService.addAlbum(function(a){a.result=="success"?($("#album-dialog").dialog("close"),k()):Vosao.errorMessage("#albumMessages",a.message)},a)}function s(){confirm(messages("folders.you_delete_album")+" "+h.title+". "+messages("are_you_sure"))&&Vosao.jsonrpc.picasaService.removeAlbum(function(a){a.result=="success"&&(k(),$("#albumDetails").hide()),Vosao.showServiceMessages(a)},h.id)}function t(a){photo=g[a],confirm(messages("folders.you_delete_photo")+" "+photo.title+". "+messages("are_you_sure"))&&Vosao.jsonrpc.picasaService.removePhoto(function(a){a.result=="success"&&n(),Vosao.showServiceMessages(a)},h.id,photo.id)}function u(){$("#upload-dialog input[name=albumId]").val(h.id),$("#upload-dialog").dialog("open")}function v(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?(Vosao.info("Success."),setTimeout(n,3e3)):(d=messages("error")+". "+d,Vosao.error(d)),$("#upload-dialog").dialog("close")}console.log("Loading FoldersView.js");var e=null,f=null,g=null,h=null;return Backbone.View.extend({css:["/static/css/jquery.treeview.css","/static/css/picasa.css"],el:$("#content"),tmpl:_.template(a),render:function(){Vosao.addCSSFiles(this.css),this.el.html(this.tmpl({messages:messages})),b(),i()},remove:function(){$("#album-dialog").dialog("destroy").remove(),$("#upload-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFiles(this.css)}})}),define("text!template/folder.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n<div id="breadcrumbs">\r\n    <span class="button ui-state-default ui-corner-all" style="padding:4px 10px;">\r\n        <a href="#folders"><%= messages("resources") %>:</a> /\r\n        <span id="crumbs"></span>\r\n    </span>\r\n</div>\r\n\r\n<div id="tabs" style="top:14px;">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("folder") %></a></li>\r\n    <li class="filesTab"><a href="#tab-2"><%= messages("files") %></a></li>\r\n    <li class="childrenTab"><a href="#tab-3"><%= messages("subfolders") %></a></li>\r\n    <li class="securityTab"><a href="#tab-4"><%= messages("security") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n<form id="folderForm">\r\n<div class="form-row">\r\n    <label><%= messages("title") %></label>\r\n    <input id="title" type="text" class="form-title" />\r\n</div>\r\n<div class="form-row">\r\n    <label><%= messages("folder.name_for_url") %></label>\r\n    <input id="name" type="text" class="form-url"/>\r\n</div>\r\n<div class="buttons">\r\n    <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n    <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    <input id="exportButton" type="button" value="<%= messages("export") %>" />\r\n</div>    \r\n</form>\r\n</div>\r\n\r\n<div id="tab-2" class="filesTab">\r\n    <div id="filesTable"> </div>\r\n    <div class="buttons">\r\n        <input id="createFileButton" type="button" \r\n            value="<%= messages("create_file") %>" />\r\n        <input id="uploadButton" type="button" \r\n            value="<%= messages("upload_file") %>" />\r\n        <input id="deleteFilesButton" type="button" \r\n            value="<%= messages("delete_files") %>" />\r\n        <input id="fileCancelButton" type="button" \r\n            value="<%= messages("cancel") %>" />\r\n    </div>\r\n</div>\r\n\r\n<div id="tab-3" class="childrenTab">\r\n    <div id="children"> </div>\r\n    <div class="buttons">\r\n        <input id="addChildButton" type="button" \r\n            value="<%= messages("folder.add_child_folder") %>" />\r\n        <input id="deleteFoldersButton" type="button" \r\n            value="<%= messages("folder.delete_folders") %>" />\r\n        <input id="folderCancelButton" type="button" \r\n            value="<%= messages("cancel") %>" />\r\n    </div>    \r\n</div>\r\n\r\n<div id="tab-4" class="securityTab">\r\n    <div id="permissions"> </div>\r\n    <div class="buttons">\r\n        <input id="addPermissionButton" type="button" \r\n            value="<%= messages("add_permission") %>" />\r\n        <input id="deletePermissionButton" type="button" \r\n            value="<%= messages("delete_permission") %>" />\r\n    </div>    \r\n</div>\r\n\r\n</div>\r\n\r\n<div id="file-upload" title="<%= messages("folder.upload_file") %>" style="display:none">\r\n\t<form id="upload" action="/cms/upload" method="post" enctype="multipart/form-data">\r\n    \t<%= messages("file_upload") %>:\r\n    \t<input type="hidden" name="fileType" value="resource" />\r\n    \t<input type="hidden" name="folderId" />\r\n    \t<input type="file" name="uploadFile" multiple="true" />\r\n\t    <div class="buttons-dlg">\r\n    \t    <input type="submit" value="<%= messages("send") %>" />\r\n        \t<input id="fileUploadCancelButton" type="button" \r\n            \tvalue="<%= messages("cancel") %>" />\r\n    \t</div>\r\n\t</form>\r\n</div>\r\n\r\n<div id="permission-dialog" style="display:none" title="<%= messages("permission_details") %>">\r\n<form id="permissionForm">\r\n    <div class="form-row">\r\n        <label><%= messages("group") %></label>\r\n        <select id="groupSelect"></select>\r\n        <span id="groupName"></span>        \r\n    </div>\r\n    <div id="permissionList" class="form-row">\r\n        <fieldset>\r\n            <legend><%= messages("permission") %></legend>\r\n            <input type="radio" name="permission" value="DENIED"/> <%= messages("denied") %> <br />\r\n            <input type="radio" name="permission" value="READ" /> <%= messages("read") %> <br />\r\n            <input type="radio" name="permission" value="WRITE" /> <%= messages("read_write") %> <br />\r\n        </fieldset>        \r\n    </div>\r\n    <div class="buttons-dlg">\r\n        <input id="permissionSaveButton" type="submit" value="<%= messages("save") %>" />\r\n        <input id="permissionCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n</form>\r\n</div>\r\n\r\n<div id="export-dialog" style="display:none" title="<%= messages("folder.export_window") %>">\r\n  <form id="exportForm">\r\n    <p><%= messages("folder.export_window_info") %></p>\r\n    <div id="exportInfo" class="form-row"></div>    \r\n    <div id="timer" class="form-row"></div>\r\n    <div class="buttons-dlg">\r\n        <input id="exportCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n'}),define("view/FolderView",["text!template/folder.html","jquery.form"],function(a){function m(){$("#export-dialog").dialog({width:400,autoOpen:!1}),$("#file-upload").dialog({width:400,autoOpen:!1}),$("#permission-dialog").dialog({width:400,autoOpen:!1}),f=b!="";var a=$("#tabs").tabs();Vosao.selectTabFromQueryParam(a),$("#upload").ajaxForm(s),Vosao.initJSONRpc(n),$("#title").change(y),$("#folderForm").submit(function(){return B(),!1}),$("#cancelButton").click(C),$("#exportButton").click(D),$("#exportCancelButton").click(U),$("#createFileButton").click(x),$("#uploadButton").click(q),$("#deleteFilesButton").click(w),$("#fileCancelButton").click(C),$("#addChildButton").click(G),$("#deleteFoldersButton").click(I),$("#folderCancelButton").click(C),$("#fileUploadCancelButton").click(r),$("#addPermissionButton").click(Q),$("#deletePermissionButton").click(R),$("#permissionForm").submit(function(){return P(),!1}),$("#permissionCancelButton").click(S),$("#file-upload input[name=folderId]").val(b)}function n(){Vosao.jsonrpc.folderService.getFolderRequest(function(a){g=a,o(),M(),V(),f?(K(g.permissions),A(),u(),$(".filesTab").show(),$(".childrenTab").show(),e.root?($("#saveButton").attr("disabled","disabled"),$("#title").attr("disabled","disabled"),$("#name").attr("disabled","disabled")):($("#saveButton").removeAttr("disabled"),$("#title").removeAttr("disabled"),$("#name").removeAttr("disabled"))):($(".filesTab").hide(),$(".childrenTab").hide())},b,c)}function o(){e=g.folder,f&&(c=String(e.parent)),p(),T()}function p(){f?($("#title").val(e.title),$("#name").val(e.name)):($("#title").val(""),$("#name").val(""))}function q(){$("#file-upload").dialog("open")}function r(){$("#file-upload").dialog("close")}function s(a){var b=a.split("::"),c=b[1],d=b[2];c=="success"?(Vosao.info(messages("folder.file_success_upload")),t()):Vosao.error(messages("folder.error_during_upload")+" "+d),$("#file-upload").dialog("close")}function t(){Vosao.jsonrpc.fileService.getByFolder(function(a){g.files=a,u()},b)}function u(){d=g.files;var a='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th><th>"+messages("filename")+"</th><th>"+messages("mimetype")+"</th><th>"+messages("size")+"</th></tr>";$.each(d.list,function(b,c){a+='<tr>\t<td><input type="checkbox" name="item'+b+'" value="'+c.id+'"/></td>\t<td><a href="#file/'+c.id+'">'+c.title+"</a></td>\t<td>"+c.filename+"</td>\t<td>"+c.mimeType+"</td>\t<td>"+c.size+" "+messages("bytes")+"</td></tr>"}),a+="</table>",$("#filesTable").html(a),$("#filesTable tr:even").addClass("even")}function v(){var a=[];return $("#filesTable input[@type=checkbox]:checked").each(function(){a.push(this.value)}),a}function w(){var a=Vosao.javaList(v());if(a.list.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.fileService.deleteFiles(function(a){a.result=="success"?(t(),Vosao.info(messages("folder.files_success_delete"))):Vosao.error(messages("folder.error_deleting_files")+" "+a.messsage)},a)}function x(){location.href="#addFile/"+b}function y(){if(f)return;var a=$("#name").val(),b=$("#title").val();a==""&&$("#name").val(Vosao.urlFromTitle(b))}function z(){Vosao.jsonrpc.folderService.getByParent(function(a){g.children=a,A()},b)}function A(){if(!f)return;var a='<table class="form-table"><tr><th></th><th>'+messages("title")+"</th><th>"+messages("name")+"</th></tr>";$.each(g.children.list,function(b,c){a+='<tr><td><input type="checkbox" value="'+c.id+'"/></td><td><a href="#folder/'+c.id+'">'+c.title+"</td><td>"+c.name+"</td></tr>"}),$("#children").html(a+"</table>"),$("#children tr:even").addClass("even")}function B(){var a=Vosao.javaMap({id:b,parent:c,name:$("#name").val(),title:$("#title").val()});Vosao.jsonrpc.folderService.saveFolder(function(a){a.result=="success"?(Vosao.info(messages("folder.success_save")),b==""&&(b=a.message,f=!0,$('#file-upload input[name="folderId"]').val(b),n())):Vosao.showServiceMessages(a)},a)}function C(){$.cookie("folderReturnPath")?location.href=$.cookie("folderReturnPath"):location.href="#folders"}function D(){k=0,F(),$("#export-dialog").dialog("open"),Vosao.jsonrpc.configService.startExportFolderTask(function(a){a.result=="success"?(l=a.message,Vosao.infoMessage("#exportInfo",messages("creating_export_file")),i=setInterval(E,1e4),j=setInterval(F,1e3)):Vosao.showServiceMessages(a)},e.id)}function E(){Vosao.jsonrpc.configService.isExportTaskFinished(function(a){a&&(clearInterval(i),clearInterval(j),$("#export-dialog").dialog("close"),$("#exportDialogButton").attr("disabled",!1),location.href="/file/tmp/"+l)},"folder")}function F(){$("#timer").html(k++ +" "+messages("sec")+".")}function G(){location.href="#addFolder/"+b}function H(){var a=[];return $("#children input[@type=checkbox]:checked").each(function(){a.push(this.value)}),a}function I(){var a=Vosao.javaList(H());if(a.list.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.folderService.deleteFolder(function(a){a.result=="success"?(z(),Vosao.info(messages("folder.success_delete"))):Vosao.error(messages("folder.error_deleting")+" "+a.messsage)},a)}function J(a){if(a=="DENIED")return messages("denied");if(a=="READ")return messages("read");if(a=="WRITE")return messages("read_write");if(a=="ADMIN")return messages("read_write_grant")}function K(a){h=Vosao.idMap(a.list);var b='<table class="form-table"><tr><th></th><th>'+messages("group")+"</th><th>"+messages("permission")+"</th></tr>";$.each(h,function(a,c){var d="",e=c.group.name;c.inherited||(d='<input type="checkbox" value="'+c.id+'">',e='<a data-id="'+c.id+'"> '+c.group.name+"</a>"),b+="<tr><td>"+d+"</td><td>"+e+"</td><td>"+J(c.permission)+"</td></tr>"}),$("#permissions").html(b+"</table>"),$("#permissions tr:even").addClass("even"),$("#permissions a").click(function(){N($(this).attr("data-id"))})}function L(){Vosao.jsonrpc.folderPermissionService.selectByFolder(function(a){K(a)},b)}function M(){var a=g.groups;groups=Vosao.idMap(a.list);var b="";$.each(groups,function(a,c){b+='<option value="'+c.id+'">'+c.name+"</option>"}),$("#groupSelect").html(b)}function N(a){permission=h[a],O(),$("#permission-dialog").dialog("open")}function O(){$("#permission-dialog input[type=radio]").removeAttr("checked"),permission==null?($("#permission-dialog input[value=READ]").attr("checked","checked"),$("#groupSelect").show(),$("#groupName").hide()):($("#permissionList input[value="+permission.permission+"]").attr("checked","checked"),$("#groupSelect").hide(),$("#groupName").show(),$("#groupName").text(permission.group.name))}function P(){var a={folderId:b,groupId:permission==null?$("#groupSelect").val():String(permission.group.id),permission:$("#permissionList input:checked")[0].value};Vosao.jsonrpc.folderPermissionService.save(function(a){Vosao.showServiceMessages(a),$("#permission-dialog").dialog("close"),a.result=="success"&&L()},Vosao.javaMap(a))}function Q(){permission=null,O(),$("#permission-dialog").dialog("open")}function R(){var a=[];$("#permissions input:checked").each(function(){a.push(this.value)});if(a.length==0){Vosao.info(messages("nothing_selected"));return}confirm(messages("are_you_sure"))&&Vosao.jsonrpc.folderPermissionService.remove(function(a){Vosao.showServiceMessages(a),L()},Vosao.javaList(a))}function S(){$("#permission-dialog").dialog("close")}function T(){var a=g.folderPermission;a.changeGranted?($("#saveButton").show(),$("#createFileButton").show(),$("#uploadButton").show(),$("#deleteFilesButton").show(),$("#addChildButton").show(),$("#deleteFoldersButton").show()):($("#saveButton").hide(),$("#createFileButton").hide(),$("#uploadButton").hide(),$("#deleteFilesButton").hide(),$("#addChildButton").hide(),$("#deleteFoldersButton").hide()),a.admin&&f?$(".securityTab").show():$(".securityTab").hide()}function U(){$("#export-dialog").dialog("close"),clearInterval(i),clearInterval(j)}function V(){var a="",b=g.parent;$.each(g.ancestors.list,function(b,c){var d=c.name=="/"?"file":c.name;a+='<a href="#folder/'+c.id+'">'+d+"</a> / "}),f?a+=" "+(e.name=="/"?"file":e.name):a+='<a href="#folder/'+b.id+'">'+b.name+"</a>",$("#crumbs").html(a)}console.log("Loading FolderView.js");var b=null,c=null,d="",e=null,f=b!="",g=null,h=null,i=null,j=null,k=0,l=null;return Backbone.View.extend({el:$("#content"),tmpl:_.template(a),render:function(){this.el.html(this.tmpl({messages:messages})),m()},remove:function(){$("#export-dialog").dialog("destroy").remove(),$("#file-upload").dialog("destroy").remove(),$("#permission-dialog").dialog("destroy").remove(),this.el.html("")},setFolderId:function(a){b=a},setFolderParentId:function(a){c=a}})}),define("text!template/file.html",[],function(){return'<%/*\r\n Vosao CMS. Simple CMS for Google App Engine.\r\n \r\n Copyright (C) 2009-2011 Vosao development team.\r\n\r\n This library is free software; you can redistribute it and/or\r\n modify it under the terms of the GNU Lesser General Public\r\n License as published by the Free Software Foundation; either\r\n version 2.1 of the License, or (at your option) any later version.\r\n\r\n This library is distributed in the hope that it will be useful,\r\n but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n Lesser General Public License for more details.\r\n\r\n You should have received a copy of the GNU Lesser General Public\r\n License along with this library; if not, write to the Free Software\r\n Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\r\n\r\n email: vosao.dev@gmail.com\r\n*/%>\r\n\r\n    <!-- script src="/static/js/ace/ace.js" type="text/javascript" charset="utf-8"></script> \r\n    <script src="/static/js/ace/theme-eclipse.js" type="text/javascript" charset="utf-8"></script> \r\n    <script src="/static/js/ace/mode-css.js" type="text/javascript" charset="utf-8"></script>\r\n    <script src="/static/js/ace/mode-html.js" type="text/javascript" charset="utf-8"></script>\r\n    <script src="/static/js/ace/mode-javascript.js" type="text/javascript" charset="utf-8"></script>\r\n    <script src="/static/js/ace/mode-xml.js" type="text/javascript" charset="utf-8"></script-->\r\n\r\n<div id="tabs">\r\n<ul>\r\n    <li><a href="#tab-1"><%= messages("file") %></a></li>\r\n    <li class="contentTab"><a href="#tab-2"><%= messages("content") %></a></li>\r\n</ul>\r\n\r\n<div id="tab-1">\r\n<form id="fileForm">\r\n\r\n<div style="float:left">\r\n <div class="form-row">\r\n    <label><%= messages("title") %></label>\r\n    <input id="title" type="text" />\r\n </div>\r\n <div class="form-row">\r\n    <label><%= messages("name") %></label>\r\n    <input id="name" type="text" />\r\n </div>\r\n \r\n<div id="fileEditDiv">\r\n <div class="form-row">\r\n    <label><%= messages("content_type") %></label>\r\n    <span id="mimeType"> </span>\r\n </div>\r\n <div class="form-row">\r\n    <label><%= messages("size") %></label>\r\n    <span id="size"> </span>\r\n </div>\r\n <div class="form-row">\r\n    <label><%= messages("external_link") %></label>\r\n    <span id="fileLink"> </span>\r\n </div>\r\n <div class="form-row">\r\n    <label> </label>\r\n    <span id="download"> </span>\r\n </div>\r\n </div>\r\n  \r\n <div class="buttons">\r\n    <input id="saveButton" type="submit" value="<%= messages("save") %>" />\r\n    <input id="cancelButton" type="button" value="<%= messages("cancel") %>" />\r\n </div>\r\n     \r\n</div>\r\n\r\n<div id="imageContent" style="float:left;margin-left: 20px;"> </div>\r\n<div style="clear:both"> </div>\r\n\r\n</form>\r\n</div>\r\n\r\n<div id="tab-2" class="contentTab">\r\n  <form id="contentForm">\r\n    <div class="form-row">\r\n        <span id="filename"></span>\r\n    </div>\r\n    <div>\r\n        <input id="autosave" type="checkbox" />\r\n            <label for="autosave"><%= messages("autosave") %></label>\r\n    </div>\r\n    <div class="form-row">\r\n        <pre id="ace"></pre>\r\n        <textarea id="content" rows="20" cols="80"></textarea>\r\n    </div>\r\n    <div class="buttons">\r\n        <input id="saveContentButton" type="submit" value="<%= messages("save_continue") %>" />\r\n        <input id="contentCancelButton" type="button" value="<%= messages("cancel") %>" />\r\n    </div>    \r\n  </form>\r\n</div>\r\n\r\n</div>\r\n\r\n'}),define("view/FileView",["text!template/file.html"],function(a){function i(){e=b!="",$("#tabs").tabs(),$("#tabs").bind("tabsselect",j),Vosao.initJSONRpc(o),$("#fileForm").submit(function(){return r(),!1}),$("#cancelButton").click(s),$("#autosave").change(n),$("#contentForm").submit(function(){return m(),!1}),$("#contentCancelButton").click(s)}function j(a,b){b.index==1?k():l()}function k(){b!="null"&&$("#autosave:checked").length>0&&f==""&&(f=setInterval(m,Vosao.AUTOSAVE_TIMEOUT*1e3))}function l(){f!=""&&(clearInterval(f),f="")}function m(){var a=h?$("#ace").text():$("textarea").val();Vosao.jsonrpc.fileService.updateContent(function(a){if(a.result=="success"){var b=new Date;Vosao.info(a.message+" "+b)}else Vosao.error(a.message)},b,a)}function n(){$("#autosave:checked").length>0?k():l()}function o(){Vosao.jsonrpc.fileService.getFile(function(a){d=a,e&&(c=d.folderId),q()},b)}function p(a,b){$("#ace").text(b),h=!0,g=ace.edit("ace"),g.setTheme("ace/theme/eclipse");var c=require("ace/mode/"+a).Mode;g.getSession().setMode(new c),$("#content").hide()}function q(){e?($("#filename").html(d.name),$("#title").val(d.title),$("#name").val(d.name),$("#fileEditDiv").show(),$("#mimeType").html(d.mimeType),$("#size").html(d.size),$("#fileLink").html(d.link),$("#download").html('<a href="'+d.link+'">'+messages("download")+"</a>"),d.textFile?($(".contentTab").show(),$("#content").val(d.content)):$(".contentTab").hide(),d.imageFile?$("#imageContent").html('<img src="'+d.link+'" />'):$("#imageContent").html("")):($("#filename").html(""),$("#title").val(""),$("#name").val(""),$("#fileEditDiv").hide(),$(".contentTab").hide(),$("#imageContent").html(""))}function r(){var a=Vosao.javaMap({id:b,folderId:String(c),title:$("#title").val(),name:$("#name").val()});Vosao.jsonrpc.fileService.saveFile(function(a){Vosao.showServiceMessages(a),a.result=="success"&&(location.href="#file/"+a.data)},a)}function s(){location.href="#folder/"+c}console.log("Loading FileView.js");var b=null,c=null,d="",e=b!="",f="",g=!0,h=!1;return Backbone.View.extend({css:"/static/css/file.css",el:$("#content"),tmpl:_.template(a),render:function(){Vosao.addCSSFile(this.css),this.el.html(this.tmpl({messages:messages})),i()},remove:function(){this.el.html(""),Vosao.removeCSSFile(this.css)},setFileId:function(a){b=a},setFolderId:function(a){c=a}})}),jQuery.cookie=function(a,b,c){if(typeof b=="undefined"){var i=null;if(document.cookie&&document.cookie!=""){var j=document.cookie.split(";");for(var k=0;k<j.length;k++){var l=jQuery.trim(j[k]);if(l.substring(0,a.length+1)==a+"="){i=decodeURIComponent(l.substring(a.length+1));break}}}return i}c=c||{},b===null&&(b="",c.expires=-1);var d="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var e;typeof c.expires=="number"?(e=new Date,e.setTime(e.getTime()+c.expires*24*60*60*1e3)):e=c.expires,d="; expires="+e.toUTCString()}var f=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"",h=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,f,g,h].join("")},define("jquery.cookie",function(){}),function(a){window.DOMParser==undefined&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b}),a.xmlDOM=function(b,c){try{var d=(new DOMParser).parseFromString(b,"text/xml");if(!a.isXMLDoc(d))throw"Unable to parse XML";var e=a("parsererror",d);if(e.length==1)throw"Error: "+a(d).text()}catch(f){var g=f.name==undefined?f:f.name+": "+f.message;return a.isFunction(c)?c(g):a(document).trigger("xmlParseError",[g]),a([])}return a(d)}}(jQuery),define("jquery.xmldom",function(){}),function(a){function m(b,c){throw a.extend(b,c),b}function n(a){var c=[];if(l.call(a)!==f)return b;for(var d=0,e=a.length;d<e;d++)c[d]=a[d].jqote_id;return c.length?c.sort().join(".").replace(/(\b\d+\b)\.(?:\1(\.|$))+/g,"$1$2"):b}function o(c,d){var e,g=[],d=d||j,i=l.call(c);if(i===h)return c.jqote_id?[c]:b;if(i!==f)return[a.jqotec(c,d)];if(i===f)for(var k=0,m=c.length;k<m;k++)return g.length?g:b}var b=!1,c="UndefinedTemplateError",d="TemplateCompilationError",e="TemplateExecutionError",f="[object Array]",g="[object String]",h="[object Function]",i=1,j="%",k=/^[^<]*(<[\w\W]+>)[^>]*$/,l=Object.prototype.toString;a.fn.extend({jqote:function(b,c){var b=l.call(b)===f?b:[b],d="";return this.each(function(e){var f=a.jqotec(this,c);for(var g=0;g<b.length;g++)d+=f.call(b[g],e,g,b,f)}),d}}),a.each({app:"append",pre:"prepend",sub:"html"},function(b,c){a.fn["jqote"+b]=function(d,e,f){var g,h,i=a.jqote(d,e,f),j=k.test(i)?a:function(b){return a(document.createTextNode(b))};return!(g=n(o(d)))||(h=new RegExp("(^|\\.)"+g.split(".").join("\\.(.*)?")+"(\\.|$)")),this.each(function(){var d=j(i);a(this)[c](d),(d[0].nodeType===3?a(this):d).trigger("jqote."+b,[d,h])})}}),a.extend({jqote:function(a,d,e){var g="",e=e||j,h=o(a);h===b&&m(new Error("Empty or undefined template passed to $.jqote"),{type:c}),d=l.call(d)!==f?[d]:d;for(var i=0,k=h.length;i<k;i++)for(var n=0;n<d.length;n++)g+=h[i].call(d[n],i,n,d,h[i]);return g},jqotec:function(b,f){var h,n,o,f=f||j,p=l.call(b);if(p===g&&k.test(b)){n=o=b;if(h=a.jqotecache[b])return h}else{n=p===g||b.nodeType?a(b):b instanceof jQuery?b:null,(!n[0]||!(o=n[0].innerHTML)&&!(o=n.text()))&&m(new Error("Empty or undefined template passed to $.jqotec"),{type:c});if(h=a.jqotecache[a.data(n[0],"jqote_id")])return h}var s="",t,u=o.replace(/\s*<!\[CDATA\[\s*|\s*\]\]>\s*|[\r\n\t]/g,"").split("<"+f).join(f+">").split(f+">");for(var v=0,w=u.length;v<w;v++)s+=u[v].charAt(0)!==""?"out+='"+u[v].replace(/(\\|["'])/g,"\\$1")+"'":u[v].charAt(1)==="="?";out+=("+u[v].substr(2)+");":u[v].charAt(1)==="!"?";out+=$.jqotenc(("+u[v].substr(2)+"));":";"+u[v].substr(1);s="try{"+('var out="";'+s+";return out;").split("out+='';").join("").split('var out="";out+=').join("var out=")+'}catch(e){e.type="'+e+'";e.args=arguments;e.template=arguments.callee.toString();throw e;}';try{var x=new Function("i, j, data, fn",s)}catch(n){m(n,{type:d})}return t=n instanceof jQuery?a.data(n[0],"jqote_id",i):n,a.jqotecache[t]=(x.jqote_id=i++,x)},jqotefn:function(c){var d=l.call(c),e=d===g&&k.test(c)?c:a.data(a(c)[0],"jqote_id");return a.jqotecache[e]||b},jqotetag:function(a){l.call(a)===g&&(j=a)},jqotenc:function(a){return a.toString().replace(/&(?!\w+;)/g,"&#38;").split("<").join("&#60;").split(">").join("&#62;").split('"').join("&#34;").split("'").join("&#39;")},jqotecache:{}}),a.event.special.jqote={add:function(a){var b,c=a.handler,d=a.data?l.call(a.data)!==f?[a.data]:a.data:[];a.namespace||(a.namespace="app.pre.sub");if(!d.length||!(b=n(o(d))))return;a.handler=function(a,d,e){return!e||e.test(b)?c.apply(this,[a,d]):null}}}}(jQuery),define("jquery.jquote2",function(){}),function(){function a(a){var b=a.currentTarget||a.srcElement,c;if(a.type==="load"||f.test(b.readyState)){a=b.getAttribute("data-requiremodule"),h[a]=!0;for(a=0;c=g[a];a++)if(h[c.name])c.req([c.name],c.onLoad);else break;a>0&&g.splice(0,a),setTimeout(function(){b.parentNode.removeChild(b)},15)}}function b(a){var b,c;a.setAttribute("data-orderloaded","loaded");for(a=0;c=j[a];a++)if((b=i[c])&&b.getAttribute("data-orderloaded")==="loaded")delete i[c],require.addScriptToDom(b);else break;a>0&&j.splice(0,a)}var c=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),d=c&&(c.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),e=c&&c.readyState==="uninitialized",f=/^(complete|loaded)$/,g=[],h={},i={},j=[],c=null;define("order",{version:"1.0.0",load:function(c,f,h,l){var p=f.nameToUrl(c,null);require.s.skipAsync[p]=!0,d||l.isBuild?f([c],h):e?(l=require.s.contexts._,!l.urlFetched[p]&&!l.loaded[c]&&(l.urlFetched[p]=!0,require.resourcesReady(!1),l.scriptCount+=1,p=require.attach(p,l,c,null,null,b),i[c]=p,j.push(c)),f([c],h)):f.specified(c)?f([c],h):(g.push({name:c,req:f,onLoad:h}),require.attach(p,null,c,a,"script/cache"))}})}();var escapeJSONString=function(){var a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(c){return a.lastIndex=0,a.test(c)?'"'+c.replace(a,function(a){var c=b[a];return typeof c=="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'}}();JSONRpcClient.prototype.createCallableProxy=function(a,b){var c,d,e,f,g;c=new JSONRPCCallableProxy(a,b);for(f in JSONRpcClient.knownClasses[b])c[f]=JSONRpcClient.bind(JSONRpcClient.knownClasses[b][f],c);return c},JSONRpcClient.knownClasses={},JSONRpcClient.Exception=function(a){var b;for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);this.trace&&(b=this.trace.match(/^([^:]*)/),b&&(this.name=b[0])),this.name||(this.name="JSONRpcClientException")},JSONRpcClient.Exception.CODE_REMOTE_EXCEPTION=490,JSONRpcClient.Exception.CODE_ERR_CLIENT=550,JSONRpcClient.Exception.CODE_ERR_PARSE=590,JSONRpcClient.Exception.CODE_ERR_NOMETHOD=591,JSONRpcClient.Exception.CODE_ERR_UNMARSHALL=592,JSONRpcClient.Exception.CODE_ERR_MARSHALL=593,JSONRpcClient.Exception.prototype=new Error,JSONRpcClient.Exception.prototype.toString=function(a,b){var c="";return this.name&&(c+=this.name),this.message&&(c+=": "+this.message),c.length==0&&(c="no exception information given"),c},JSONRpcClient.default_ex_handler=function(a){var b,c="";for(b in a)c+=b+"\t"+a[b]+"\n";alert(c)},JSONRpcClient.toplevel_ex_handler=JSONRpcClient.default_ex_handler,JSONRpcClient.profile_async=!1,JSONRpcClient.max_req_active=1,JSONRpcClient.requestId=1,JSONRpcClient.fixupCircRefs=!0,JSONRpcClient.fixupDuplicates=!0,JSONRpcClient.transformDates=!1,JSONRpcClient.transformDateWithoutHint=!1,JSONRpcClient.javaDateClasses={"java.util.Date":!0,"java.sql.Date":!0,"java.sql.Time":!0,"java.sql.Timestamp":!0},JSONRpcClient.bind=function(a,b){return function(){return a.apply(b,arguments)}},JSONRpcClient._createMethod=function(a,b){var c=function(){var c=[],d;for(var e=0;e<arguments.length;e++)c.push(arguments[e]);typeof c[0]=="function"&&(d=c.shift());var f=JSONRpcClient._makeRequest(this,b,c,this.objectID,d);return d?(JSONRpcClient.async_requests.push(f),JSONRpcClient.kick_async(),f.requestId):JSONRpcClient._sendRequest(a,f)};return c},JSONRpcClient.prototype.createObject=function(){var a=[],b=null,c,d,e;for(var f=0;f<arguments.length;f++)a.push(arguments[f]);return typeof a[0]=="function"&&(b=a.shift()),c=a[0]+".$constructor",d=a[1],e=JSONRpcClient._makeRequest(this,c,d,0,b),b===null?JSONRpcClient._sendRequest(this,e):(JSONRpcClient.async_requests.push(e),JSONRpcClient.kick_async(),e.requestId)},JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX=".ref",JSONRpcClient.prototype._addMethods=function(a,b){var c,d,e,f,g,h=[],i,j,k,l;for(var m=0;m<a.length;m++){d=this,e=a[m].split("."),k=a[m].indexOf("["),l=a[m].indexOf("]");if(a[m].substring(0,JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX.length)==JSONRpcClient.CALLABLE_REFERENCE_METHOD_PREFIX&&k!=-1&&l!=-1&&k<l)i=a[m].substring(k+1,l);else for(f=0;f<e.length-1;f++)c=e[f],d[c]?d=d[c]:(d[c]={},d=d[c]);c=e[e.length-1],i?(g=JSONRpcClient._createMethod(this,c),JSONRpcClient.knownClasses[i]||(JSONRpcClient.knownClasses[i]={}),JSONRpcClient.knownClasses[i][c]=g):(g=JSONRpcClient._createMethod(this,a[m]),!d[c]&&!b&&(d[c]=JSONRpcClient.bind(g,this)),h.push(g)),i=null}return h},JSONRpcClient._getCharsetFromHeaders=function(a){var b,c,d;try{b=a.getResponseHeader("Content-type"),c=b.split(/\s*;\s*/);for(d=0;d<c.length;d++)if(c[d].substring(0,8)=="charset=")return c[d].substring(8,c[d].length)}catch(e){}return"UTF-8"},JSONRpcClient.async_requests=[],JSONRpcClient.async_inflight={},JSONRpcClient.async_responses=[],JSONRpcClient.async_timeout=null,JSONRpcClient.num_req_active=0,JSONRpcClient._async_handler=function(){var a,b;JSONRpcClient.async_timeout=null;while(JSONRpcClient.async_responses.length>0){a=JSONRpcClient.async_responses.shift();if(a.canceled)continue;a.profile&&(a.profile.dispatch=new Date);try{a.cb(a.result,a.ex,a.profile)}catch(c){JSONRpcClient.toplevel_ex_handler(c)}}while(JSONRpcClient.async_requests.length>0&&JSONRpcClient.num_req_active<JSONRpcClient.max_req_active){b=JSONRpcClient.async_requests.shift();if(b.canceled)continue;JSONRpcClient._sendRequest(b.client,b)}},JSONRpcClient.kick_async=function(){JSONRpcClient.async_timeout||(JSONRpcClient.async_timeout=setTimeout(JSONRpcClient._async_handler,0))},JSONRpcClient.cancelRequest=function(a){if(JSONRpcClient.async_inflight[a])return JSONRpcClient.async_inflight[a].canceled=!0,!0;var b;for(b in JSONRpcClient.async_requests)if(JSONRpcClient.async_requests[b].requestId==a)return JSONRpcClient.async_requests[b].canceled=!0,!0;for(b in JSONRpcClient.async_responses)if(JSONRpcClient.async_responses[b].requestId==a)return JSONRpcClient.async_responses[b].canceled=!0,!0;return!1},JSONRpcClient._makeRequest=function(a,b,c,d,e){var f={};f.client=a,f.requestId=JSONRpcClient.requestId++;var g="{id:"+f.requestId+",method:";d&&d>0?g+='".obj['+d+"]."+b+'"':g+='"'+b+'"',e&&(f.cb=e),JSONRpcClient.profile_async&&(f.profile={submit:new Date});var h=toJSON(c);return g+=",params:"+h.json,h.fixups&&(g+=",fixups:"+toJSON(h.fixups).json),f.data=g+"}",f},JSONRpcClient._sendRequest=function(a,b){var c;b.profile&&(b.profile.start=new Date),c=JSONRpcClient.poolGetHTTPRequest(),JSONRpcClient.num_req_active++,c.open("POST",a.serverURL,!!b.cb,a.user,a.pass);try{c.setRequestHeader("Content-type","text/plain")}catch(d){}b.cb?c.onreadystatechange=function(){var d;if(c.readyState==4){c.onreadystatechange=function(){},d={cb:b.cb,result:null,ex:null},b.profile?(d.profile=b.profile,d.profile.end=new Date):d.profile=!1;try{d.result=a._handleResponse(c)}catch(e){d.ex=e}JSONRpcClient.async_inflight[b.requestId].canceled||JSONRpcClient.async_responses.push(d),delete JSONRpcClient.async_inflight[b.requestId],JSONRpcClient.kick_async()}}:c.onreadystatechange=function(){},JSONRpcClient.async_inflight[b.requestId]=b;try{c.send(b.data)}catch(d){throw JSONRpcClient.poolReturnHTTPRequest(c),JSONRpcClient.num_req_active--,new JSONRpcClient.Exception({code:JSONRpcClient.Exception.CODE_ERR_CLIENT,message:"Connection failed"})}return b.cb?null:(delete JSONRpcClient.async_inflight[b.requestId],a._handleResponse(c))},JSONRpcClient.prototype._handleResponse=function(a){this.charset||(this.charset=JSONRpcClient._getCharsetFromHeaders(a));var b,c,d;try{b=a.status,c=a.statusText,d=a.responseText}catch(e){throw JSONRpcClient.poolReturnHTTPRequest(a),JSONRpcClient.num_req_active--,JSONRpcClient.kick_async(),new JSONRpcClient.Exception({code:JSONRpcClient.Exception.CODE_ERR_CLIENT,message:"Connection failed"})}JSONRpcClient.poolReturnHTTPRequest(a),JSONRpcClient.num_req_active--;if(b!=200)throw new JSONRpcClient.Exception({code:b,message:c});return this.unmarshallResponse(d)},JSONRpcClient.prototype.unmarshallResponse=function(data){function applyFixups(a,b){function c(a,b){for(var c=0,d=b.length;c<d;c++)a=a[b[c]];return a}function d(a,b,c){var d=b.length-1;for(var e=0;e<d;e++)a=a[b[e]];a[b[d]]=c}for(var e=0,f=b.length;e<f;e++)d(a,b[e][0],c(a,b[e][1]))}function transformDate(a){function b(a,b){var c,d=0;if(a.hasOwnProperty(b)){for(c in a)if(a.hasOwnProperty(c)){d++;if(d>1)return}return!0}}var c,d;if(a&&typeof a=="object"){if(a.javaClass&&JSONRpcClient.javaDateClasses[a.javaClass])return d=new Date(a.time),a.javaClass!=="java.util.Date"&&(d.javaClass=a.javaClass),d;if(JSONRpcClient.transformDateWithoutHint&&b(a,"time"))return new Date(a.time);for(c in a)a.hasOwnProperty(c)&&(a[c]=transformDate(a[c]));return a}return a}var obj;try{eval("obj = "+data)}catch(e){throw new JSONRpcClient.Exception({code:550,message:"error parsing result"})}if(obj.error)throw new JSONRpcClient.Exception(obj.error);var r=obj.result,i,tmp;if(r){if(r.objectID&&r.JSONRPCType=="CallableReference")return this.createCallableProxy(r.objectID,r.javaClass);r=JSONRpcClient.extractCallableReferences(this,JSONRpcClient.transformDates?transformDate(r):r),obj.fixups&&applyFixups(r,obj.fixups)}return r},JSONRpcClient.extractCallableReferences=function(a,b){var c,d,e;for(c in b)typeof b[c]=="object"&&(d=JSONRpcClient.makeCallableReference(a,b[c]),d?b[c]=d:(d=JSONRpcClient.extractCallableReferences(a,b[c]),b[c]=d)),typeof c=="object"&&(d=JSONRpcClient.makeCallableReference(a,c),d?(e=b[c],delete b[c],b[d]=e):(d=JSONRpcClient.extractCallableReferences(a,c),e=b[c],delete b[c],b[d]=e));return b},JSONRpcClient.makeCallableReference=function(a,b){return b&&b.objectID&&b.javaClass&&b.JSONRPCType=="CallableReference"?a.createCallableProxy(b.objectID,b.javaClass):null},JSONRpcClient.http_spare=[],JSONRpcClient.http_max_spare=8,JSONRpcClient.poolGetHTTPRequest=function(){var a=JSONRpcClient.http_spare.pop();return a?a:JSONRpcClient.getHTTPRequest()},JSONRpcClient.poolReturnHTTPRequest=function(a){JSONRpcClient.http_spare.length<JSONRpcClient.http_max_spare?JSONRpcClient.http_spare.push(a):delete a},JSONRpcClient.msxmlNames=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","Microsoft.XMLHTTP"],JSONRpcClient.getHTTPRequest=function(){try{return JSONRpcClient.httpObjectName="XMLHttpRequest",new XMLHttpRequest}catch(a){}for(var b=0;b<JSONRpcClient.msxmlNames.length;b++)try{return JSONRpcClient.httpObjectName=JSONRpcClient.msxmlNames[b],new ActiveXObject(JSONRpcClient.msxmlNames[b])}catch(a){}throw JSONRpcClient.httpObjectName=null,new JSONRpcClient.Exception({code:0,message:"Can't create XMLHttpRequest object"})},define("jsonrpc",function(){});var Vosao={};Vosao.javaList=function(a){return{javaClass:"java.util.ArrayList",list:a}},Vosao.javaMap=function(a){return{javaClass:"java.util.HashMap",map:a}},Vosao.accents={"ÀÁÂÃÄÅ":"A","Æ":"AE","Ç":"C","ÈÉÊË":"E","ÌÍÎÏ":"I","Ð":"Th","Ñ":"N","ÒÓÔÕÖØ":"O","ÙÚÛÜ":"U","Ý":"Y","Þ":"Th","ß":"ss","àáâãäå":"a","æ":"ae","ç":"c","èéêë":"e","ìíîï":"i","ð":"o","ñ":"n","òóôõöø":"o","ùúûü":"u","ýÿ":"y","þ":"th"},Vosao.replaceAccents=function(a){return $.each(Vosao.accents,function(b,c){for(var d=0;d<b.length;d++)a=a.replace(b.charAt(d),c)}),a.toLowerCase()},Vosao.urlFromTitle=function(a){return Vosao.replaceAccents(a.toLowerCase()).replace(/\W/g,"-")},Vosao.nameFromTitle=function(a){return a.toLowerCase().replace(/\W/g,"_")},Vosao.isImage=function(a){var b=Vosao.getFileExt(a);return b.toLowerCase().match(/gif|jpg|jpeg|png|ico/)!=null},Vosao.getFileExt=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)},Vosao.getFileName=function(a){var b=a.lastIndexOf("\\");return b==-1&&(b=a.lastIndexOf("/")),b==-1?a:a.substring(b+1,a.length)},Vosao.formatDate=function(a){return $.datepicker.formatDate("dd.mm.yy",a)},Vosao.formatTime=function(a){return $.datepicker.formatDate("HH:MM",a)},Vosao.identifier_regex=/^[a-zA-Z_][a-zA-Z0-9_]*$/,Vosao.isValidIdentifier=function(a){return Vosao.identifier_regex.test(a)},Vosao.strip=function(a){var b=0;while(b<a.length&&a[b]==" ")b++;var c=a.substring(b);b=c.length-1;while(b>=0&&c[b]==" ")b--;return c.slice(0,b+1)},Vosao.getQueryParam=function(a){var b=window.location.search.match(new RegExp("(\\?|&)"+a+"(\\[\\])?=([^&]*)"));return Vosao.escapeHtml(b?b[3]:"")},Vosao.selectTabFromQueryParam=function(a){Vosao.getQueryParam("tab")&&a.tabs("select",Number(Vosao.getQueryParam("tab")))},Vosao.escapeHtml=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},Vosao.generateGUID=function(){function a(){return((1+Math.random())*65536|0).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},Vosao.jsonrpc="",Vosao.jsonrpcListeners=[],Vosao.jsonrpcSystemListeners=[],Vosao.jsonrpcInitialized=!1,Vosao.jsonrpcInitError=null,Vosao.createJSONRpc=function(){Vosao.jsonrpc=new JSONRpcClient(function(a,b){if(b)Vosao.jsonrpcInitError="Error during JSON-RPC initialization "+b+" "+b.message;else{while(Vosao.jsonrpcSystemListeners.length>0){var c=Vosao.jsonrpcSystemListeners.pop();c()}while(Vosao.jsonrpcListeners.length>0){var c=Vosao.jsonrpcListeners.pop();c()}}Vosao.jsonrpcInitialized=!0},"/json-rpc/")},Vosao.createJSONRpc(),Vosao.initJSONRpc=function(a){if(a==undefined)return;Vosao.jsonrpcInitialized?a():Vosao.jsonrpcListeners.push(a)},Vosao.initJSONRpcSystem=function(a){if(a==undefined)return;Vosao.jsonrpcInitialized?a():Vosao.jsonrpcSystemListeners.push(a)},Vosao.serviceFailed=function(a){return a!=null?(alert("JSON-RPC service fail "+a+" "+a.message),!0):!1},Vosao.changeLanguage=function(a){var b=location.href.replace("#",""),c=b.indexOf("language="),d=location.search.indexOf("?")==-1?"?":"&";if(c>0){var e=b.substr(c+1),f=e.indexOf("&");b=b.substr(0,c)+"language="+a,f>0&&(b+=e.substr(f+1)),b.indexOf("&")<0&&(d="")}else b=b+d+"language="+a;location.href=b},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},String.prototype.startsWith=function(a){return this.match("^"+a)==a},String.prototype.endsWith=function(a){return this.match(a+"$")==a},define("vosao",function(){}),Vosao==undefined&&alert(messages("vosao.namespace_error")),Vosao.AUTOSAVE_TIMEOUT=60,Vosao.ENGLISH_CODE="en",Vosao.info=function(a){Vosao.infoMessage("#wrapper .messages",a),$("#wrapper .messages").fadeIn(),setTimeout(function(){$("#wrapper .messages").fadeOut()},5e3)},Vosao.error=function(a){Vosao.errorMessage("#wrapper .messages",a),$("#wrapper .messages").fadeIn(),setTimeout(function(){$("#wrapper .messages").fadeOut()},3e4)},Vosao.infoMessage=function(a,b){$(a).html('<div class="ui-widget">\t\t<div class="ui-state-highlight ui-corner-all" style="padding: 0.5em 0.7em;margin: 4px;"><p>\t\t<span class="ui-icon ui-icon-info" style="float:left;margin-right:0.3em" />\t\t<strong>'+messages("vosao.hey")+"</strong> "+b+"</p></div></div>")},Vosao.errorMessage=function(a,b){$(a).html('<div class="ui-widget">\t\t<div class="ui-state-error ui-corner-all" style="padding: 0.5em 0.7em;margin: 4px;"><p>\t\t<span class="ui-icon ui-icon-alert" style="float:left;margin-right:0.3em" />\t\t<strong>'+messages("alert")+"!</strong> "+b+"</p></div></div>")},Vosao.errorMessages=function(a,b){var c="";$.each(b,function(a,b){c+=(a==0?"":"<br />")+b}),Vosao.errorMessage(a,c)},Vosao.showServiceMessages=function(a){a.result=="success"?(Vosao.info(a.message),a.messages.list.length>0&&$.each(a.messages.list,function(a,b){Vosao.info(b)})):(Vosao.error(a.message),a.messages.list.length>0&&$.each(a.messages.list,function(a,b){Vosao.error(b)}))},Vosao.idMap=function(a){var b={};return $.each(a,function(a,c){b[c.id]=c}),b},Vosao.message=function(a){return a.charAt(0)=="$"?messages(a.substr(1)):a},Vosao.addCSSFile=function(a){$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css" />')},Vosao.addCSSFiles=function(a){$.each(a,function(a,b){$("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')})},Vosao.removeCSSFile=function(a){$('head link[href="'+a+'"]').remove()},Vosao.removeCSSFiles=function(a){$.each(a,function(a,b){$('head link[href="'+b+'"]').remove()})},Vosao.clientId=Vosao.generateGUID(),Vosao.channel=null,Vosao.socket=null,Vosao.initChannel=function(a,b,c,d){Vosao.jsonrpc.channelApiFrontService.createToken(function(e){Vosao.channel=new goog.appengine.Channel(e),socket=Vosao.channel.open(),socket.onopen=a,socket.onmessage=b,socket.onerror=c,socket.onclose=d,Vosao.socket=socket},Vosao.clientId)},Vosao.sendChannelCommand=function(a,b){var c="&clientId="+Vosao.clientId;$.each(b,function(a,b){c+="&"+a+"="+b});var d=new XMLHttpRequest;d.open("POST","/_ah/channelCommand?cmd="+a+c,!0),d.send()},Vosao.changeLanguageCall=function(a){Vosao.jsonrpc.loginFrontService.setLanguage(function(a){location.reload()},a)},define("cms",function(){}),Vosao==undefined&&alert(messages("vosao.namespace_error")),Vosao.backServiceFailed=function(a){return a!=null?(Vosao.error(messages("vosao.cant_connect")+" "+a+" "+a.message+" "+a.code+" "+a.msg),!0):!1},Vosao.serviceHandler=function(a){return function(){var b=arguments[0],c=arguments;c[0]=function(a,c){$("#loading").hide();if(Vosao.backServiceFailed(c))return;b(a)},$("#loading").show(),a.apply(null,c)}},Vosao.setupJSONRpcHooks=function(){for(var a in Vosao.jsonrpc)if(a.indexOf("Service")!=-1&&a.indexOf("FrontService")==-1)for(var b in Vosao.jsonrpc[a])if(typeof Vosao.jsonrpc[a][b]=="function"){var c=Vosao.jsonrpc[a][b];Vosao.jsonrpc[a][b]=Vosao.serviceHandler(c)}},Vosao.initBackServices=function(){Vosao.setupJSONRpcHooks()},define("back-services",function(){}),Vosao.PageSearchComponent=function(div){function onSearch(){$(div+" #pageSearchResult").html(""),$(div+" #progress").html('<img src="/static/images/ajax-loader.gif" />');var a={};a.query=$(div+" input[name=query]").val(),a.published=$(div+" #publishedSearch:checked").size()>0,a.unpublished=$(div+" #unpublishedSearch:checked").size()>0,a.fromDate=$(div+" input[name=from]").val(),a.toDate=$(div+" input[name=to]").val(),Vosao.sendChannelCommand("pageSearch",a)}function onEnhancedSearch(){$(div+" #enhancedDiv").slideToggle();var a=messages("enhanced");$(div+" #enhancedSearch").text()==messages("enhanced")&&(a=messages("simple")),$(div+" #enhancedSearch").text(a)}function onChannelOpened(){$(div+" #search").toggle()}function onChannelMessage(message){var m=eval(message.data);if(m.end){$(div+" #progress").html("");return}var h='<div><a href="/cms/page/content.vm?id='+m.id+'">'+m.title+"</a> "+messages("version")+": "+m.version+"<br>"+m.content;$(div+" #pageSearchResult").append(h)}function onChannelError(a){Vosao.error(a.code+" "+a.description)}function onChannelClose(){}var h=messages("pages.search_pages")+' : <input name="query" type="text" /> '+'<input id="search" type="button" value="'+messages("search")+'"/> '+'<input id="clear" type="button" value="'+messages("clear")+'"/> '+'<span id="progress"></span> '+'<a id="enhancedSearch" href="#">'+messages("enhanced")+"</a>"+'<div id="enhancedDiv">'+' <div class="form-row">'+'  <input id="publishedSearch" type="checkbox" checked="checked"/>'+'   <label for="publishedSearch">'+messages("published")+"</label>"+'  <input id="unpublishedSearch" type="checkbox" checked="checked" />'+'   <label for="unpublishedSearch">'+messages("unpublished")+"</label><br/>"+" </div>"+' <div class="form-row">'+messages("change_date")+' <input class="datepicker" type="input" name="from" size="10"/> '+messages("to")+' <input class="datepicker" type="input" name="to" size="10"/>'+" </div>"+"</div>"+'<div id="pageSearchResult"></div>';return $(div).html(h),$(".datepicker").datepicker({dateFormat:"dd.mm.yy"}),$(div+" #search").click(onSearch),$(div+" #clear").click(function(){$(div+" #pageSearchResult").html(""),$(div+" input[name=query]").val("")}),$(div+" #enhancedSearch").click(onEnhancedSearch),$(div+" #search").hide(),Vosao.initChannel(onChannelOpened,onChannelMessage,onChannelError,onChannelClose),$(div+" input[name=query]").keypress(function(a){var b=a.keyCode?a.keyCode:a.which;if(b==13||b==10)onSearch(),a.preventDefault()}),this},define("view/pages/PageSearchComponent",function(){}),define("view/PagesView",["text!template/pages.html","jquery.treeview","order!view/pages/PageSearchComponent"],function(a){function h(){i(),k(),g=Vosao.PageSearchComponent("#pageSearch")}function i(){Vosao.jsonrpc.pageService.getTree(function(a){c=a,f&&s(a),$("#pages-tree").html(j(a)),$("#pages-tree").treeview({animated:"fast",collapsed:!0,unique:!0,persist:"cookie",cookieId:"pageTree"}),$(".content-link").each(function(){$(this).mouseover(function(a){$(".page_edit").hide(),$(a.target).siblings(".page_edit").show()})}),$("#pages-tree li").each(function(){$(this).hover(function(a){$(".page_edit").hide(),$("> .page_edit",a.target).show()},function(a){})})})}function j(a){var b=encodeURIComponent(a.entity.friendlyURL),c=e?a.entity.title:a.entity.pageFriendlyURL;c||(c="/");var d=a.entity.hasPublishedVersion?"published":"unpublished",f=messages(d),g=' <img src="/static/images/'+d+'.png" title="'+f+'" width="16px" />';a.entity.hasPublishedVersion||(g=' <a onclick="Vosao.app.pagesView.onPagePublish('+a.entity.id+')">'+'<img src="/static/images/'+d+'.png" title="'+f+'" width="16px" /></a>');var h="<li> "+g+' <a href="#page/content/'+a.entity.id+'" title="'+messages("page.edit_content")+'" class="content-link">'+c+"</a> "+'<span class="page_edit" style="display:none">'+'<a title="'+messages("add_child")+'" onclick="Vosao.app.pagesView.onPageAdd(\''+a.entity.friendlyURL+'\')"><img src="/static/images/add.png"/></a> '+'<a title="'+messages("remove")+'" onclick="Vosao.app.pagesView.onPageRemove(\''+a.entity.friendlyURL+"')\">"+'<img src="/static/images/02_x.png" /></a> '+'<a href="#page/'+a.entity.id+'" title="'+messages("page.edit_properties")+'">'+'<img src="/static/images/pencil.png" /></a> '+'<a onclick="Vosao.app.pagesView.onChangeTitle('+a.entity.id+')" title="'+messages("page.edit_url_title")+'">'+'<img src="/static/images/globe.png" /></a>'+"</span>";return a.children.list.length>0&&(h+="<ul>",$.each(a.children.list,function(a,b){h+=j(b)}),h+="</ul>"),h+"</li>"}function k(){Vosao.app.user.admin||$("#structuresTab").hide()}function l(a){if(a.title=="")return messages("title_is_empty");if(a.title.indexOf(",")!=-1)return messages("pages.coma_not_allowed");if(a.url=="")return messages("pages.url_is_empty");if(a.url.indexOf("/")!=-1)return messages("pages.slash_not_allowed")}function m(){var a={id:d==null?"":String(d.id),title:$("#title").val(),url:$("#url").val(),friendlyUrl:b+"/"+$("#url").val()},c=l(a);c?n(c):Vosao.jsonrpc.pageService.savePage(function(a){a.result=="success"?(Vosao.info(messages("pages.success_created")),$("#page-dialog").dialog("close"),h()):n(a.message)},Vosao.javaMap(a))}function n(a){Vosao.errorMessage("#pageMessages",a)}function o(a){return p(c,a)}function p(a,b){if(a.entity.id==b)return a;var c=null;return a.children.list.length>0&&$.each(a.children.list,function(a,d){var e=p(d,b);e!=null&&(c=e)}),c}function q(){e?$("#showTitle").html('<a href="#" onclick="Vosao.app.pagesView.onShowTitle(false)">'+messages("show_names")+"</a>"):$("#showTitle").html('<a href="#" onclick="Vosao.app.pagesView.onShowTitle(true)">'+messages("show_titles")+"</a>")}function r(){f?$("#invertOrder").html('<a href="#" onclick="Vosao.app.pagesView.onInvertOrder(false)">'+messages("restore_order")+"</a>"):$("#invertOrder").html('<a href="#" onclick="Vosao.app.pagesView.onInvertOrder(true)">'+messages("invert_order")+"</a>")}function s(a){a.children.list.reverse(),a.hasChildren&&$.each(a.children.list,function(a,b){s(b)})}var b=null,c=null,d=null,e=$.cookie("pages.showTitle")!="names",f=$.cookie("pages.invertOrder")=="true",g=null;return Backbone.View.extend({css:["/static/css/jquery.treeview.css","/static/css/pages.css"],el:$("#content"),events:{},initialize:function(){},render:function(){Vosao.addCSSFiles(this.css),this.el.html(_.template(a,{messages:messages})),$("#page-dialog").dialog({width:400,autoOpen:!1}),Vosao.initJSONRpc(h),$("#cancelDlgButton").click(function(){$("#page-dialog").dialog("close")}),$("#pageForm").submit(function(){return m(),!1}),$("#title").change(this.onTitleChange),q(),r()},remove:function(){$("#page-dialog").dialog("destroy").remove(),this.el.html(""),Vosao.removeCSSFiles(this.css)},onPageRemove:function(a){if(a=="/")return;confirm(messages("are_you_sure"))&&Vosao.jsonrpc.pageService.remove(function(a){Vosao.showServiceMessages(a),h()},a)},onPageAdd:function(a){$("#ui-dialog-title-page-dialog").text(messages("pages.new_page")),b=a=="/"?"":a,$("#page-dialog").dialog("open"),$("#parentURL").html(b+"/"),$("#title").val(""),$("#url").val(""),$("#url").removeAttr("disabled"),$("#title").focus(),d=null},onTitleChange:function(){var a=$("#url").val(),b=$("#title").val();a==""&&$("#url").val(Vosao.urlFromTitle(b))},onInvertOrder:function(a){f=a,r(),f?$.cookie("pages.invertOrder","true",{path:"/",expires:10}):$.cookie("pages.invertOrder","false",{path:"/",expires:10}),h()},onPagePublish:function(a){confirm(messages("are_you_sure"))&&Vosao.jsonrpc.pageService.approve(function(a){Vosao.showServiceMessages(a),h()},a)},onShowTitle:function(a){e=a,q(),e?$.cookie("pages.showTitle","titles",{path:"/",expires:10}):$.cookie("pages.showTitle","names",{path:"/",expires:10}),h()},onChangeTitle:function(a){var c=o(a);d=c.entity,$("#ui-dialog-title-page-dialog").text(messages("pages.change_page")),b=d.parentUrl=="/"?"":d.parentUrl,$("#page-dialog").dialog("open"),$("#parentURL").html(b+"/"),$("#title").val(d.title),$("#url").val(d.pageFriendlyURL),$("#url").attr("disabled",c.children.list.length>0),$("#title").focus()}})}),define("app",["view/LoginView","view/PagesView","view/IndexView","view/StructuresView","view/StructureView","view/StructureTemplateView","view/TemplatesView","view/TemplateView","view/page/PageView","view/ProfileView","view/plugins/PluginsView","view/plugins/ConfigView","view/plugins/FormsView","view/plugins/FormView","view/plugins/SeoUrlsView","view/config/ConfigView","view/FoldersView","view/FolderView","view/FileView","text!template/topbar.html","text!template/locale.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){return console.log("app.js"),Backbone.Router.extend({initialize:function(){this.bind("login",this.login,this),Vosao.loggedIn?this.login():this.currentView=this.loginView.render(),$("#loading").html(messages("loading")),$(".splash").hide(),$("#topbar, #wrapper").fadeIn()},currentView:null,indexView:new c,loginView:new a,pagesView:new b,structuresView:new d,structureView:new e,structureTemplateView:new f,templatesView:new g,templateView:new h,pageView:new i,profileView:new j,pluginsView:new k,pluginsConfigView:new l,pluginsFormsView:new m,pluginsFormView:new n,pluginsSeoUrlsView:new o,configView:new p,foldersView:new q,folderView:new r,fileView:new s,routes:{index:"index",pages:"pages","page/content/:id":"editContent","page/:id":"editPage",structures:"structures",structure:"addStructure","structure/:id":"editStructure","addStructureTemplate/:id":"addStructureTemplate","structureTemplate/:id":"structureTemplate",profile:"profile",logout:"logout",plugins:"plugins","plugins/config":"pluginsConfig","plugins/forms":"pluginsForms","plugins/form":"pluginsFormNew","plugins/form/:id":"pluginsFormEdit","plugins/seo-urls":"pluginsSeoUrls",templates:"templates",template:"createTemplate","template/:id":"editTemplate",config:"config",folders:"folders","folder/:id":"editFolder","addFolder/:id":"addFolder","file/:id":"editFile","addFile/:id":"addFile"},show:function(a){this.currentView&&(this.currentView.remove(),this.currentView=null),this.currentView=a,$("#content").hide(),a.render(),$("#content").fadeIn()},pages:function(){this.show(this.pagesView)},index:function(){this.show(this.indexView)},structures:function(){this.show(this.structuresView)},addStructure:function(){this.structureView.setId(""),this.show(this.structureView)},editStructure:function(a){this.structureView.setId(a),this.show(this.structureView)},addStructureTemplate:function(a){this.structureTemplateView.create(a),this.show(this.structureTemplateView)},structureTemplate:function(a){this.structureTemplateView.edit(a),this.show(this.structureTemplateView)},templates:function(){this.show(this.templatesView)},createTemplate:function(){this.templateView.create(),this.show(this.templateView)},editTemplate:function(a){this.templateView.edit(a),this.show(this.templateView)},editContent:function(a){this.pageView.editContent(a),this.show(this.pageView)},editPage:function(a){this.pageView.editPage(a),this.show(this.pageView)},profile:function(a){this.show(this.profileView)},plugins:function(){this.show(this.pluginsView)},pluginsConfig:function(){this.show(this.pluginsConfigView)},pluginsForms:function(){this.show(this.pluginsFormsView)},pluginsFormNew:function(){this.pluginsFormView.setId(""),this.show(this.pluginsFormView)},pluginsFormEdit:function(a){this.pluginsFormView.setId(a),this.show(this.pluginsFormView)},pluginsSeoUrls:function(){this.show(this.pluginsSeoUrlsView)},config:function(){this.show(this.configView)},folders:function(){this.show(this.foldersView)},editFolder:function(a){this.folderView.setFolderId(a),this.folderView.setFolderParentId(""),this.show(this.folderView)},addFolder:function(a){this.folderView.setFolderId(""),this.folderView.setFolderParentId(a),this.show(this.folderView)},editFile:function(a){this.fileView.setFileId(a),this.fileView.setFolderId(""),this.show(this.fileView)},addFile:function(a){this.fileView.setFileId(""),this.fileView.setFolderId(a),this.show(this.fileView)},logout:function(){Vosao.jsonrpc.loginFrontService.logout(function(a,b){if(Vosao.serviceFailed(b))return;a.result=="success"?location.href="/":Vosao.showServiceMessages(a)})},login:function(){Vosao.jsonrpcInitialized=!1,Vosao.createJSONRpc(),Vosao.initJSONRpcSystem(Vosao.initBackServices),Vosao.initJSONRpc(function(){Vosao.jsonrpc.userService.getLoggedIn(function(a){Vosao.app.user=a;var b=_.template(u,{messages:messages});$("#topbar").html(_.template(t,{locale:b,Vosao:Vosao,messages:messages})),$("#languageSelect").click(function(){$("#languageDiv").show(),setTimeout(function(){$("#languageDiv").hide()},5e3)}),Backbone.history.start()||Vosao.app.navigate("index",!0)})})}})}),console.log("main.js"),require.config({paths:{text:"libs/text",order:"libs/order","jquery.cookie":"/static/js/jquery.cookie","jquery-ui":"/static/js/jquery-ui","jquery.xmldom":"/static/js/jquery.xmldom","jquery.form":"/static/js/jquery.form","jquery.treeview":"/static/js/jquery.treeview","jquery.jquote2":"libs/jquery.jquote2.min",jsonrpc:"/static/js/jsonrpc",vosao:"/static/js/vosao",cms:"/static/js/cms",i18n:"/i18n","back-services":"/static/js/back-services"}}),require(["app","jquery.cookie","jquery-ui","jquery.xmldom","jquery.jquote2","order!i18n","order!jsonrpc","order!vosao","order!cms","order!back-services"],function(a){Vosao.initJSONRpc(function(){Vosao.jsonrpc.loginFrontService.getSystemProperties(function(b){Vosao.version=b.map.version,Vosao.fullVersion=b.map.fullVersion,Vosao.loggedIn=b.map.loggedIn==="true",Vosao.app=new a})})}),define("main",function(){})